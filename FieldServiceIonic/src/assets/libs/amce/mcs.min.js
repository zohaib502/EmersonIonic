!function(t,e,i,o,n,r,s){var a,u;!function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=70)}([function(t,e,i){"use strict";var o,n,r,s,a,u,c,l,h,d,p,f,y,g,m,v,_,b,O,A,E,w;Object.defineProperty(e,"__esModule",{value:!0}),(n=o||(o={})).ORACLE_MOBILE_DIAGNOSTIC_SESSION_ID="Oracle-Mobile-DIAGNOSTIC-SESSION-ID",n.ORACLE_MOBILE_DEVICE_ID="Oracle-Mobile-DEVICE-ID",n.ORACLE_MOBILE_CLIENT_REQUEST_TIME="Oracle-Mobile-CLIENT-REQUEST-TIME",n.ORACLE_MOBILE_ANALYTICS_APPLICATION_ID="Oracle-Mobile-Analytics-Application-Id",n.ORACLE_MOBILE_NAME="Oracle-Mobile-Name",n.ORACLE_MOBILE_CREATED_BY="Oracle-Mobile-Created-By",n.ORACLE_MOBILE_CREATED_ON="Oracle-Mobile-Created-On",n.ORACLE_MOBILE_MODIFIED_BY="Oracle-Mobile-Modified-By",n.ORACLE_MOBILE_MODIFIED_ON="Oracle-Mobile-Modified-On",n.ORACLE_MOBILE_SYNC_RESOURCE_TYPE="Oracle-Mobile-Sync-Resource-Type",n.ORACLE_MOBILE_SYNC_AGENT="Oracle-Mobile-Sync-Agent",n.LOCATION="Location",n.ORACLE_MOBILE_BACKEND_ID="Oracle-Mobile-Backend-Id",n.ORACLE_MOBILE_SOCIAL_IDENTITY_PROVIDER="Oracle-Mobile-Social-Identity-Provider",n.ORACLE_MOBILE_SOCIAL_ACCESS_TOKEN="Oracle-Mobile-Social-Access-Token",n.ORACLE_MOBILE_CLIENT_SDK_INFO="Oracle-Mobile-Client-SDK-Info",n.ACCEPT="Accept",n.CONTENT_TYPE="Content-Type",n.E_TAG="ETag",n.IF_MATCH="If-Match",n.AUTHORIZATION="Authorization",n.X_USER_IDENTITY_DOMAIN_NAME="X-USER-IDENTITY-DOMAIN-NAME",n.X_RESOURCE_IDENTITY_DOMAIN_NAME="X-RESOURCE-IDENTITY-DOMAIN-NAME",n.ACCEPT_ENCODING="Accept-Encoding",n.IF_MODIFIED_SINCE="if-modified-since",n.IF_NONE_MATCH="if-none-match",e.Headers=o,(s=r||(r={})).APPLICATION_JSON="application/json",s.TEXT_PLAIN="text/plain",s.X_WWW_FORM_FORM_URLENCODED="application/x-www-form-urlencoded; charset=utf-8",e.ContentTypes=r,(u=a||(a={})).GET="GET",u.PUT="PUT",u.PATCH="PATCH",u.POST="POST",u.DELETE="DELETE",u.HEAD="HEAD",e.HttpMethods=a,(l=c||(c={})).ITEM="item",l.COLLECTION="collection",l.FILE="file",e.ResourceTypes=c,(d=h||(h={})).basic="basic",d.oauth="oauth",d.facebook="facebook",d.token="token",e.AuthenticationTypes=h,(f=p||(p={})).STORAGE="Storage",f.AUTHORIZATION="Authorization",f.USER_MANAGEMENT="UserManagement",f.APP_POLICES="AppPolicies",f.LOCATION="Location",f.SYNC="Sync",f.SYNC_EXPRESS="SyncExpress",f.NOTIFICATIONS="Notifications",f.MCS_ANALYTICS="MCSAnalytics",f.ANALYTICS="Analytics",f.CUSTOM_CODE="CustomCode",f.APP_CONFIG="AppConfig",e.ModuleNames=p,(g=y||(y={})).JAVASCRIPT="Javascript",g.CORDOVA="Cordova",g.REACT_NATIVE="ReactNative",e.PlatformNames=y,(v=m||(m={})).ANDROID="android",v.IOS="ios",e.DevicePlatforms=m,(b=_||(_={})).FCM="FCM",b.APNS="APNS",b.WNS="WNS",b.SYNIVERSE="SYNIVERSE",e.NotificationProviders=_,(A=O||(O={})).JSON="json",A.BLOB="blob",A.ARRAY_BUFFER="arraybuffer",A.DOCUMENT="document",A.TEXT="text",e.XMLHttpRequestResponseTypes=O,(w=E||(E={})).GENERIC="Generic",w.MCS="MCS",w.ORACLE_REST="OracleRest",e.SyncRequestHandlerTypes=E},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t){this.module=t}return t.prototype.debug=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.log(t.LOG_LEVEL.DEBUG,e)},t.prototype.error=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.log(t.LOG_LEVEL.ERROR,e)},t.prototype.info=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.log(t.LOG_LEVEL.INFO,e)},t.prototype.warn=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.log(t.LOG_LEVEL.WARN,e)},t.prototype.log=function(e,i){if(t.logLevel>=e){i.unshift("[mcs."+this.module+"]");var o=void 0;switch(t.logLevel){case t.LOG_LEVEL.ERROR:o=console.error;break;case t.LOG_LEVEL.WARN:o=console.warn;break;case t.LOG_LEVEL.INFO:o=console.info;break;case t.LOG_LEVEL.DEBUG:o=console.debug}t.historyEnabled&&(t.history.push(Object.assign({},i,{level:e})),t.historySize<=t.history.length&&t.history.shift()),o.apply(console,i)}},t.LOG_LEVEL={NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4},t.logLevel=t.LOG_LEVEL.ERROR,t.historyEnabled=!1,t.historySize=100,t.history=[],t}();e.Logger=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){return function(t,e,i){this.statusCode=0,this.data=null,this.headers=null,this.statusCode=t,this.data=e,this.headers=i}}();e.NetworkResponse=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t){this._keys=[],this._values=[];for(var e=0;e<t.length;e++)this[t[e].key.toString()]=t[e].value,this._keys.push(t[e].key),this._values.push(t[e].value)}return t.prototype.add=function(t,e){this[t.toString()]=e,this._keys.push(t),this._values.push(e)},t.prototype.remove=function(t){var e=this._keys.indexOf(t,0);this._keys.splice(e,1),this._values.splice(e,1),delete this[t.toString()]},t.prototype.keys=function(){return this._keys},t.prototype.values=function(){return this._values},t.prototype.containsKey=function(t){return void 0!==this[t.toString()]},t.prototype.toLookup=function(){return this},t}();e.Dictionary=o},function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=i(2),a=i(0),u=function(t){function e(e,i){var o=t.call(this,e.statusCode,e.data,e.headers)||this;return o.accessToken=i,o}return n(e,t),e}(s.NetworkResponse);e.AuthenticationResponse=u;var c=function(){function t(t,e){this.utils=t,this.platform=e,this._onAuthenticationCallbacks=[],this.logger=new r.Logger("Authorization")}return Object.defineProperty(t.prototype,"isAuthorized",{get:function(){return this._isAuthorized},enumerable:!0,configurable:!0}),t.prototype.getAccessToken=function(){return this._accessToken},t.prototype._setAccessToken=function(t){this._accessToken=t},t.prototype._getIsAnonymous=function(){return this._isAnonymous},t.prototype._getIsAuthorized=function(){return this._isAuthorized},t.prototype._getAnonymousAccessToken=function(){return this._anonymousAccessToken},t.prototype._authenticateAnonymousInvoke=function(t,e,i,o,n){return this.logout(),t=this._getHeaders(t),t=this._getAnonymousAuthorizationHeaders(t),this.platform.invokeService({url:e,method:i,headers:t,withCredentials:o,data:n,module:a.ModuleNames.AUTHORIZATION}).then(function(t){return new u(t,null)}).then(this._anonymousTokenResponseConverter.bind(this)).catch(function(t){return this.logger.error("Login failed with error: "+t.statusCode),this._clearState(),Promise.reject(t)}.bind(this)).then(this._authenticateAnonymousSuccess.bind(this))},t.prototype._getHeaders=function(t){return t},t.prototype._authenticateAnonymousSuccess=function(t){return this.logger.info("User logged in anonymously "+t.statusCode),this._setAuthenticateAnonymousSuccess(t.accessToken),t},t.prototype._setAuthenticateAnonymousSuccess=function(t){this._isAnonymous=!0,this._isAuthorized=!0,this._anonymousAccessToken=t;for(var e=0;e<this._onAuthenticationCallbacks.length;e++)this._onAuthenticationCallbacks[e](t)},t.prototype._authenticateError=function(t){this.logger.error("Login failed with error: "+t.statusCode),this._clearState()},t.prototype._clearState=function(){this._accessToken=null,this._isAnonymous=!1,this._anonymousAccessToken=null,this._isAuthorized=!1},t.prototype.onAuthentication=function(t){this._onAuthenticationCallbacks.push(t)},t}();e.Authorization=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(10),n=i(15),r=i(0),s=function(){function t(t,e,i,o,n,r,s,a){this.backend=t,this.apiName=e,this.endpointPath=i,this.resolvingOfflineUpdate=o,this.utils=n,this.platform=r,this.options=s,this.common=a}return t.prototype.getHttpHeaders=function(t){var e=this.backend.getHttpHeaders(t);return e.add(r.Headers.ORACLE_MOBILE_SYNC_AGENT,"true"),e},t.prototype.getType=function(t,e){var i=o.SyncResourceType.file,n=t[r.Headers.ORACLE_MOBILE_SYNC_RESOURCE_TYPE.toLowerCase()];if(null!=n)n===r.ResourceTypes.ITEM?i=o.SyncResourceType.item:n===r.ResourceTypes.COLLECTION&&(i=o.SyncResourceType.collection);else if(this.common.isString(e))try{var s=JSON.parse(e);i=this.common.isArray(s)?o.SyncResourceType.collection:o.SyncResourceType.item}catch(t){i=o.SyncResourceType.file}return i},t.prototype.getUri=function(t,e){var i=t&&t.headers?t.headers[r.Headers.LOCATION.toLowerCase()]:null;if(null!=i)return"/"+i;var o=null;if(t.data&&(o="string"==typeof t.data?""!==t.data?JSON.parse(t.data):null:t.data),o&&o[n.McsRequestHandler.URI_KEY]){var s=o[n.McsRequestHandler.URI_KEY];return delete o[n.McsRequestHandler.URI_KEY],s}return this.options.parseURL(e).path},t.prototype.createResource=function(t,e,i,n,s,a,u,c){var l=c.headers[r.Headers.LOCATION.toLowerCase()];l=null!=l?"/"+l:e;o.SyncResourceType.file;var h=s[r.Headers.ORACLE_MOBILE_SYNC_RESOURCE_TYPE.toLowerCase()];if(null!=h)h===r.ResourceTypes.ITEM?o.SyncResourceType.item:h===r.ResourceTypes.COLLECTION&&o.SyncResourceType.collection;else if(this.common.isString(u))try{var d=JSON.parse(u);this.common.isArray(d)?o.SyncResourceType.collection:o.SyncResourceType.item}catch(t){o.SyncResourceType.file}return null},t}();e.SyncProcessor=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(9),n=i(1),r=function(){function t(t,e,i,o,r){var s=this;this.dbName=t,this.$options=e,this.$common=i,this.$utils=o,this.logger=new n.Logger("RequestHandler"),this.prefix=e.dbPrefix,this.$db=this._createDatabase(r),e.onDbPrefixChange=function(t,e){s.prefix=e,s.$db=s._createDatabase(r)}}return t.prototype.isPersistentRequest=function(t){if(!t)throw new Error("request cannot be undefined or null value");if(!this.$common.isObject(t))throw new Error("request has to be defined object with properties like: url, data etc.");if(this.$common.isEmpty(t))throw new Error("request cannot be empty object, it request properties like: url, data etc.");if(this.$common.isArray(t)||this.$common.isFunction(t))throw new Error("request cannot be array or function");if(!("url"in t))throw new Error("request.url was not specified");return!0},t.prototype.isPersistentGetRequest=function(t){return this.isPersistentRequest(t),!0},t.prototype.isPostRequest=function(t){if(this.isPersistentRequest(t),!("data"in t))throw new Error("request.data was not defined!");if(!this.$common.isObject(t.data))throw new Error("request.data is not a object or array!");if(this.$common.isFunction(t.data))throw new Error("request.data cannot be function");return!0},t.prototype.isOfflinePersistObj=function(t){return!!("meta"in t&&t.meta.hasOwnProperty("offline-persist"))},t.prototype.isLokiDbObj=function(t){return!(!("$loki"in t&&"number"==typeof t.$loki)||isNaN(t.$loki))},t.prototype.buildFindQueryBasedOnUrlParams=function(t){var e={};t.attr.length>0&&(e[t.attr[0].name]=t.attr[0].pattern.indexOf("d")>=0?parseInt(t.attr[0].value,10):t.attr[0].value+"");return e},t.prototype.buildUniqueIDValue=function(t,e){var i=function(){return t.uri.tokens.length>1&&t.uri.tokens[t.uri.tokens.length-1].pattern.indexOf("d")>=0},o=function(t){return i()?parseInt(t,10):t+""};return this.$common.isEmpty(e)?o(this.$common.getUID()):"number"==typeof e&&i()?e:o(e)},t.prototype.handleGetRootArrayPayload=function(t,e,i){var o=this;if(e.uri.tokens.length>1){if(i.find().length>0){var n=e.uri.tokens[1].name;return i.removeWhere(function(e){var r=t.findIndex(function(t){return t[n]===e[n]});if(!(r>-1))return!o.isOfflinePersistObj(e);try{o.isOfflinePersistObj(e)?e=o.$common.deepExtend(t[r],e):o.$common.extendOwn(e,t[r]),i.update(e),t.splice(r,1)}catch(t){o.logger.error(t)}finally{return!1}}),t.forEach(function(t){o.isLokiDbObj(t)?i.update(t):i.insert(t)}),i.find()}return i.insert(t)}return i.removeWhere(function(t){return!o.isOfflinePersistObj(t)}),i.insert(t)},t.prototype.handleGetRootObjectPayload=function(t,e,i){var o=this;if(e.uri.tokens.length>1){var n=e.uri.tokens[1].name;if(!t.hasOwnProperty(n))throw this.logger.error("payload does not contain unique key specified in the URL settings"),new Error("payload does not contain unique key specified in the URL settings");var r={};r[n]=t[n];var s=i.findOne(r);return s?(this.isOfflinePersistObj(s)?s=this.$common.deepExtend(t,s):this.$common.extendOwn(s,t),i.update(s)):i.insert(t)}return i.removeWhere(function(t){return!o.isOfflinePersistObj(t)}),i.insert(t)},t.prototype.buildNestedPropertySearchString=function(t){var e="";if(t.attr.length>1)for(var i=1;i<t.attr.length;i++)t.attr[i].is?e.length>0?e+="."+t.attr[i].name:e+=t.attr[i].name:e.length>0?e+="."+t.attr[i].name+"["+t.attr[i].value+"]":e+=t.attr[i].value;return e},t.prototype.buildNestedPropertyArrayParams=function(t,e,i){void 0===i&&(i=!1);var o=[],n=e.attr;if(Array.isArray(n)&&n.length>0)for(var r=t.uri.tokens.length>1?t.uri.tokens.slice(1):[],s=0;s<n.length;s++){var a=n.length-1===s;if(n[s].is){if(o.push({name:n[s].name,value:null,isProperty:!0,isInteger:!1}),a&&r[s+1]&&i){var u=this.$utils.isUrlRegexInteger(r[s+1].pattern);o.push({name:r[s+1].name,value:u?this.$common.getUID():this.$common.getUID()+"",isProperty:!1,isInteger:u})}}else{var c=n[s].value||this.$common.getUID();o.push({name:n[s].name,value:c,isProperty:!1,isInteger:this.$utils.isUrlRegexInteger(r[s].pattern)})}}return o},t.prototype.createObjFromUrlParamsForExistingForPost=function(t,e,i,o,n){var r=this.buildNestedPropertyArrayParams(e,i),s=t;if(Array.isArray(r)&&r.length>0){var a=void 0;if(n){var u=this.getKeyForCurrentObject(e,i);a={key:u,value:n[u.name]}}s=this.$utils.setNestedProperty2(t,r,o,a)}else this.$common.extendOwn(t,o);return{obj:t,result:s}},t.prototype.getKeyForCurrentObject=function(t,e){var i=e.attr.length;return t.uri.tokens[i+1]},t.prototype.createObjFromUrlParamsForGETAction=function(t,e,i,o){var n=this.buildNestedPropertyArrayParams(e,i,!1),r=t;return Array.isArray(n)&&n.length>0&&(r=this.$utils.setNestedProperty2(t,n,o)),{obj:t,result:r}},t.prototype.getNestedPropertyFromUrlParamsForExisting=function(t,e,i){var o=this.buildNestedPropertyArrayParams(e,i,!1);return Array.isArray(o)&&o.length>0?this.$utils.getNestedProperty(t,o):t},t.prototype.markObjAsOfflineIfForced=function(t,e){return e?(this.isOfflinePersistObj(t)&&delete t.meta["offline-persist"],t):"meta"in t?(t.meta["offline-persist"]=!0,t):(t.meta={},t.meta["offline-persist"]=!0,t)},t.prototype.handleGet=function(t){var e=this.$options.parseURL(t.url),i=this.$utils.isPersistUrl(e.path);if(!i)throw new Error("Persistence.RequestHandler.get() given URI was not configured for persistence:"+e.path);var o=this.$utils.extractKeyValuesFromUrl2(i),n=this.$db.getCollectionByName(o.root),r=this.buildFindQueryBasedOnUrlParams(o);if(this.$common.isEmpty(r)){this.logger.debug("return all from db");var s=this.$common.cleanObjects(n.find());return this.buildResponseObject(s)}var a=n.findOne(r);if(a){var u=this.getNestedPropertyFromUrlParamsForExisting(a,i,o),c=this.$common.cleanObject(u);return this.buildResponseObject(c)}return null},t.prototype.handleGetStore=function(t){var e=this.$options.parseURL(t.url),i=this.$utils.isPersistUrl(e.path);if(!i)throw new Error("Persistence.RequestHandler.get() given URI was not configured for persistence:"+e.path);var o=this.$utils.extractKeyValuesFromUrl2(i),n=this.$db.getCollectionByName(o.root),r=this.getResponsePayload(t),s=this.buildFindQueryBasedOnUrlParams(o);if(this.$common.isEmpty(s)){if(!this.$common.isArray(r)||this.$common.isFunction(r)||this.$common.isEmpty(r)){if(!this.$common.isObject(r)||this.$common.isArray(r)||this.$common.isFunction(r)||this.$common.isEmpty(r))throw this.logger.error("handleGetStore","unknown or empty object passed for the operation"),new Error("RequestHandler.handleGetStore -> unknown or empty object passed for the operation");return this.handleGetRootObjectPayload(r,i,n)}var a=this.handleGetRootArrayPayload(r,i,n);return this.buildResponseObject(a)}var u=n.findOne(s),c=void 0;return u?(c=this.createObjFromUrlParamsForGETAction(u,i,o,r),n.update(c.obj)):(c=this.createObjFromUrlParamsForGETAction(s,i,o,r),n.insert(c.obj)),this.buildResponseObject(c.result)},t.prototype.handlePostRootArrayPayload=function(t,e,i,o){var n=this,r=e.uri.tokens.length>1?e.uri.tokens[1].name:null;return t.forEach(function(t){if(n.isLokiDbObj(t))n.markObjAsOfflineIfForced(t,o),i.update(t);else{if(!r||!t.hasOwnProperty(r)){var s=i.insert(t);return s[r]=n.buildUniqueIDValue(e),n.markObjAsOfflineIfForced(s,o),n.$common.cleanObject(i.update(s))}var a=i.findOne({keyNameToCompare:t[r]});a?(n.$common.extendOwn(a,t),n.markObjAsOfflineIfForced(a,o),i.update(a)):(n.markObjAsOfflineIfForced(t,o),i.insert(t))}}),this.$common.cleanObjects(i.find())},t.prototype.handlePostRootObjectPayload=function(t,e,i,o){var n=e.uri.tokens.length>1?e.uri.tokens[1].name:"";if(n&&!t.hasOwnProperty(n)){this.logger.info("get payload","does not have the key specified in the URL settings"),t[n]="";var r=i.insert(t);if(r)return r[n]=this.buildUniqueIDValue(e),this.markObjAsOfflineIfForced(r,o),this.$common.cleanObject(i.update(r));throw new Error("unable to store the payload object")}if(n&&t.hasOwnProperty(n)){var s={};s[n]=t[n];var a=i.findOne(s);if(a)return this.$common.extendOwn(a,t),this.markObjAsOfflineIfForced(a,o),this.$common.cleanObject(i.update(a));t[n]=this.buildUniqueIDValue(e,t[n])}return this.markObjAsOfflineIfForced(t,o),this.$common.cleanObject(i.insert(t))},t.prototype.handlePost=function(t,e){var i=this.$options.parseURL(t.url),o=this.$utils.isPersistUrl(i.path);if(!o)throw new Error("Persistence.RequestHandler.post() given URI not configured for persistence: "+i.path);var n=this.$utils.extractKeyValuesFromUrl2(o),r=this.$db.getCollectionByName(n.root),s=t.data,a=this.buildFindQueryBasedOnUrlParams(n);if(!this.$common.isEmpty(a)){var u=r.findOne(a);if(u){var c=this.createObjFromUrlParamsForExistingForPost(u,o,n,s),l=o.uri.tokens[o.uri.tokens.length-1].name;return c.result[l]=this.buildUniqueIDValue(o,c.result[l]),this.markObjAsOfflineIfForced(c.obj,e),r.update(c.obj),this.$common.cleanObject(c.result)}c=this.createObjFromUrlParamsForExistingForPost(a,o,n,s);return this.markObjAsOfflineIfForced(c.obj,e),r.insert(c.obj),this.$common.cleanObject(c.result)}if(this.$common.isArray(s))return this.handlePostRootArrayPayload(s,o,r,e);if(this.$common.isObject(s)&&!this.$common.isArray(s)&&!this.$common.isNull(s))return this.handlePostRootObjectPayload(s,o,r,e);throw new Error("don't know what to do with the payload")},t.prototype.handlePut=function(t,e){var i=this.$options.parseURL(t.url),o=this.$utils.isPersistUrl(i.path);if(!o)throw new Error("Persistence.RequestHandler.post() given URI not configured for persistence: "+i.path);var n=this.$utils.extractKeyValuesFromUrl2(o),r=this.$db.getCollectionByName(n.root),s=t.data,a=this.buildFindQueryBasedOnUrlParams(n);if(!this.$common.isEmpty(a)){var u=r.findOne(a);if(u){var c=this.createObjFromUrlParamsForExistingForPost(u,o,n,s);return this.markObjAsOfflineIfForced(c.obj,e),r.update(c.obj),c.result}c=this.createObjFromUrlParamsForExistingForPost(a,o,n,s);return this.markObjAsOfflineIfForced(c.obj,e),r.insert(c.obj),c.result}if(this.$common.isArray(s))return this.handlePostRootArrayPayload(s,o,r,e);if(this.$common.isObject(s)&&!this.$common.isArray(s)&&!this.$common.isNull(s))return this.handlePostRootObjectPayload(s,o,r,e);throw new Error("no key specified to recognise obj in the database for editing!")},t.prototype.handlePatch=function(t,e){var i=this.$options.parseURL(t.url),o=this.$utils.isPersistUrl(i.path);if(!o)throw new Error("Persistence.RequestHandler.post() given URI not configured for persistence: "+i.path);var n=this.$utils.extractKeyValuesFromUrl2(o),r=this.$db.getCollectionByName(n.root),s=t.data,a=this.buildFindQueryBasedOnUrlParams(n);if(!this.$common.isEmpty(a)){var u=r.findOne(a);if(u){var c=this.createObjFromUrlParamsForExistingForPost(u,o,n,s);return this.markObjAsOfflineIfForced(c.obj,e),r.update(c.obj),c.result}c=this.createObjFromUrlParamsForExistingForPost(a,o,n,s);return this.markObjAsOfflineIfForced(c.obj,e),r.insert(c.obj),c.result}if(this.$common.isArray(s))return this.handlePostRootArrayPayload(s,o,r,e);if(this.$common.isObject(s)&&!this.$common.isArray(s)&&!this.$common.isNull(s))return this.handlePostRootObjectPayload(s,o,r,e);throw new Error("no key specified to recognise obj in the database for editing!")},t.prototype.handleDelete=function(t){var e=this.$options.parseURL(t.url),i=this.$utils.isPersistUrl(e.path);if(!i)throw new Error("Persistence.RequestHandler.post() given URI not configured for persistence: "+e.path);var o=this.$utils.extractKeyValuesFromUrl2(i),n=this.$db.getCollectionByName(o.root),r=this.buildFindQueryBasedOnUrlParams(o);if(!this.$common.isEmpty(r)){if(a=n.findOne(r))return this.$common.cleanObject(n.remove(a));throw new Error("unable to find object with the given ID(%s) in the database")}if(t.hasOwnProperty("data")){var s=t.data;if(!this.$common.isEmpty(s)&&this.$common.isObject(s)&&!this.$common.isArray(s)){var a,u=i.uri.tokens.length>1?i.uri.tokens[1].name:null;if(u&&!t.data.hasOwnProperty(u))throw new Error("payload does not have the key required to delete the object");if(a=n.findOne({keyNameToCompare:t.data[u]}))return this.$common.cleanObject(n.remove(a))}}throw this.logger.error("payload does not have the key required to delete the object in the payload"),new Error("payload does not have the key required to delete the object in the payload")},t.prototype.postSuccessOperations=function(t){if("POST"===t.syncObj.method){var e=this.$common.clone(t),i=this.$options.parseURL(e.syncObj.url),o=this.$utils.isPersistUrl(i.path);if(!o)return this.logger.debug("sync post success operation exist"),t;var n=this.$utils.extractKeyValuesFromUrl2(o),r=this.$db.getCollectionByName(n.root),s=e.syncObj.data,a=e.response,u=this.buildFindQueryBasedOnUrlParams(n);if(this.$common.isEmpty(u)){var c=o.uri.tokens.length>1?o.uri.tokens[1].name:"";if(c&&!s.hasOwnProperty(c))return a=this.$common.extendOwn(s,a),this.$common.cleanObject(r.insert(a));var l={};l[c]=s[c];var h=r.findOne(l);return this.$common.extendOwn(h,a),this.$common.cleanObject(r.update(h))}var d=r.findOne(u);if(d){var p=this.createObjFromUrlParamsForExistingForPost(d,o,n,a,s),f=o.uri.tokens[o.uri.tokens.length-1].name;return p.result[f]=this.buildUniqueIDValue(o,p.result[f]),r.update(p.obj),this.$common.cleanObject(p.result)}p=this.createObjFromUrlParamsForExistingForPost(u,o,n,a);return r.insert(p.obj),this.$common.cleanObject(p.result)}return t},t.prototype.flush=function(t){var e=this;if(this.logger.info("Persistence.RequestHandler.flush()",t),this.$common.isEmpty(t))return this.$db.flush();var i=this.$options.parseURL(t),o=this.$utils.isPersistUrl(i.path);return new Promise(function(t,n){if(o){var r=e.$utils.extractKeyValuesFromUrl2(o);t(e.$db.getCollectionByName(r.root).removeDataOnly())}else n(new Error("Persistence.RequestHandler.flush() given URI not configured for persistence: "+i.path))})},t.prototype.getDB=function(){return this.$db},t.prototype.get=function(t){var e=this;return new Promise(function(i){i(function(t){e.logger.info("get()"),e.isPersistentGetRequest(t);var i=e.$common.clone(t);return!i.hasOwnProperty("data")||e.$common.isEmpty(i.data)?e.$common.clone(e.handleGet(i)):e.$common.clone(e.handleGetStore(i))}(t))})},t.prototype.post=function(t,e){var i=this;return new Promise(function(o){o(function(t,e){i.logger.info("post()"),i.isPostRequest(t);var o=i.$common.clone(t);return i.$common.clone(i.handlePost(o,e))}(t,e))})},t.prototype.put=function(t,e){var i=this;return new Promise(function(o){o(function(t,e){i.logger.info("put()"),i.isPostRequest(t);var o=i.$common.clone(t);return i.$common.clone(i.handlePut(o,e))}(t,e))})},t.prototype.patch=function(t,e){var i=this;return new Promise(function(o){o(function(t,e){i.logger.info("patch()"),i.isPostRequest(t);var o=i.$common.clone(t);return i.$common.clone(i.handlePatch(o,e))}(t,e))})},t.prototype.delete=function(t){var e=this;return new Promise(function(i){i(function(t){e.logger.info("delete()"),e.isPersistentRequest(t);var i=e.$common.clone(t);return e.$common.clone(e.handleDelete(i))}(t))})},t.prototype.data=function(t){var e=this;return new Promise(function(i){i(function(t){if(e.logger.info("data()"),null==t)throw new Error("Path cannot be empty!");var i=e.$options.parseURL(t),o=e.$utils.isPersistUrl(i.path);if(!o)throw new Error("post() given URI not configured for persistence: "+i.path);var n=e.$utils.extractKeyValuesFromUrl2(o);return e.$db.getCollectionByName(n.root)}(t))})},t.prototype.router=function(t,e){var i=this;return void 0===e&&(e=!1),new Promise(function(o){if(!i.isPersistentGetRequest(t))throw i.logger.error("Passed object is not defined request for GET!",t.url),new Error("Passed object is not defined request for GET!");if(!t.hasOwnProperty("method"))throw i.logger.error("request.method was not provided!",t),new Error("request.method was not provided!");var n=i.$common.clone(t);if(n.method=i.$utils._normalizeMethod(n.method),!i[n.method])throw i.logger.error("specified router is not implemented!"),new Error("specified router is not implemented!");o(i[n.method](n,e))})},t.prototype._createDatabase=function(t){return new o.DB(this.prefix+"."+this.dbName,this.$options,t)},t}();e.RequestHandler=r},function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=i(35),a=i(2),u=i(4),c=i(0),l=function(t){function e(e,i){var o=t.call(this,e.statusCode,e.data,e.headers)||this;return o.accessToken=i,o}return n(e,t),e}(a.NetworkResponse);e.AuthenticationResponse=l;var h=function(t){function e(e,i,o){var n=t.call(this,i,o)||this;return n.backend=e,n.utils=i,n.platform=o,n.logger=new r.Logger("MCSAuthorization"),n}return n(e,t),e.prototype.getCurrentUser=function(){return this.platform.invokeService({method:c.HttpMethods.GET,url:this.backend.getPlatformUrl("users/~"),headers:this.backend.getHttpHeaders(),module:c.ModuleNames.AUTHORIZATION}).then(function(t){var e=t.data?new s.User(t.data):null;return{statusCode:t.statusCode,user:e}}.bind(this),function(t){return Promise.reject(t)}.bind(this))},e.prototype._authenticateSuccess=function(t,e){this.logger.info("User logged in "+t.statusCode),this._isAnonymous=!1,this._isAuthorized=!0,this._accessToken=e;for(var i=0;i<this._onAuthenticationCallbacks.length;i++)this._onAuthenticationCallbacks[i](e)},e.prototype.getAuthorizedUserName=function(){throw Error("THis method is not supported by this authorization method.")},e}(u.Authorization);e.MCSAuthorization=h},function(t,e,i){(function(o,n){var r,s,a;s=[],void 0===(a="function"==typeof(r=function(){return function(){"use strict";var t=Object.prototype.hasOwnProperty,e={copyProperties:function(t,e){var i;for(i in t)e[i]=t[i]},resolveTransformObject:function(t,i,o){var n,r;if("number"!=typeof o&&(o=0),++o>=10)return t;for(n in t)"string"==typeof t[n]&&0===t[n].indexOf("[%lktxp]")?(r=t[n].substring(8),i.hasOwnProperty(r)&&(t[n]=i[r])):"object"==typeof t[n]&&(t[n]=e.resolveTransformObject(t[n],i,o));return t},resolveTransformParams:function(t,i){var o,n,r=[];if(void 0===i)return t;for(o=0;o<t.length;o++)n=y(t[o],"shallow-recurse-objects"),r.push(e.resolveTransformObject(n,i));return r}},r={aeq:s,lt:a,gt:u};function s(t,e){var i,o,n,r;if(t===e)return!0;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:n=1;break;case!1:n=3;break;case!0:n=4;break;case"":n=5;break;default:n=t==t?9:0}switch(e){case void 0:case null:r=1;break;case!1:r=3;break;case!0:r=4;break;case"":r=5;break;default:r=e==e?9:0}if(9!==n||9!==r)return n===r}return i=Number(t),o=Number(e),i==i||o==o?i===o:(i=t.toString(),o=e.toString(),i==o)}function a(t,e,i){var o,n,r,s;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:r=1;break;case!1:r=3;break;case!0:r=4;break;case"":r=5;break;default:r=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==r||9!==s)return r===s?i:r<s}return o=Number(t),n=Number(e),o==o&&n==n?o<n||!(o>n)&&i:o==o&&n!=n||(n!=n||o==o)&&(t<e||!(t>e)&&(t==e?i:(o=t.toString(),n=e.toString(),o<n||o==n&&i)))}function u(t,e,i){var o,n,r,s;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:r=1;break;case!1:r=3;break;case!0:r=4;break;case"":r=5;break;default:r=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==r||9!==s)return r===s?i:r>s}return o=Number(t),n=Number(e),o==o&&n==n?o>n||!(o<n)&&i:(o!=o||n==n)&&(n==n&&o!=o||t>e||!(t<e)&&(t==e?i:(o=t.toString(),n=e.toString(),o>n||o==n&&i)))}function c(t,e,i){return r.aeq(t,e)?0:r.lt(t,e,!1)?i?1:-1:r.gt(t,e,!1)?i?-1:1:0}function l(e,i,o,n,r){var s=r||0,a=i[s];if(void 0===e||null===e||!t.call(e,a))return!1;var u=!1,c=e[a];if(s+1>=i.length)u=o(c,n);else if(Array.isArray(c))for(var h=0,d=c.length;h<d&&!0!==(u=l(c[h],i,o,n,s+1));h+=1);else u=l(c,i,o,n,s+1);return u}function h(e){return"string"==typeof e||Array.isArray(e)?function(t){return-1!==e.indexOf(t)}:"object"==typeof e&&null!==e?function(i){return t.call(e,i)}:null}function d(e,i){for(var o in i)if(t.call(i,o))return p[o](e,i[o]);return!1}var p={$eq:function(t,e){return t===e},$aeq:function(t,e){return t==e},$ne:function(t,e){return e!=e?t==t:t!==e},$dteq:function(t,e){return r.aeq(t,e)},$gt:function(t,e){return r.gt(t,e,!1)},$gte:function(t,e){return r.gt(t,e,!0)},$lt:function(t,e){return r.lt(t,e,!1)},$lte:function(t,e){return r.lt(t,e,!0)},$jgt:function(t,e){return t>e},$jgte:function(t,e){return t>=e},$jlt:function(t,e){return t<e},$jlte:function(t,e){return t<=e},$between:function(t,e){return void 0!==t&&null!==t&&r.gt(t,e[0],!0)&&r.lt(t,e[1],!0)},$jbetween:function(t,e){return void 0!==t&&null!==t&&t>=e[0]&&t<=e[1]},$in:function(t,e){return-1!==e.indexOf(t)},$nin:function(t,e){return-1===e.indexOf(t)},$keyin:function(t,e){return t in e},$nkeyin:function(t,e){return!(t in e)},$definedin:function(t,e){return void 0!==e[t]},$undefinedin:function(t,e){return void 0===e[t]},$regex:function(t,e){return e.test(t)},$containsString:function(t,e){return"string"==typeof t&&-1!==t.indexOf(e)},$containsNone:function(t,e){return!p.$containsAny(t,e)},$containsAny:function(t,e){var i=h(t);return null!==i&&(Array.isArray(e)?e.some(i):i(e))},$contains:function(t,e){var i=h(t);return null!==i&&(Array.isArray(e)?e.every(i):i(e))},$type:function(t,e){var i=typeof t;return"object"===i&&(Array.isArray(t)?i="array":t instanceof Date&&(i="date")),"object"!=typeof e?i===e:d(i,e)},$finite:function(t,e){return e===isFinite(t)},$size:function(t,e){return!!Array.isArray(t)&&("object"!=typeof e?t.length===e:d(t.length,e))},$len:function(t,e){return"string"==typeof t&&("object"!=typeof e?t.length===e:d(t.length,e))},$where:function(t,e){return!0===e(t)},$not:function(t,e){return!d(t,e)},$and:function(t,e){for(var i=0,o=e.length;i<o;i+=1)if(!d(t,e[i]))return!1;return!0},$or:function(t,e){for(var i=0,o=e.length;i<o;i+=1)if(d(t,e[i]))return!0;return!1}},f={$eq:p.$eq,$aeq:!0,$dteq:!0,$gt:!0,$gte:!0,$lt:!0,$lte:!0,$in:!0,$between:!0};function y(t,e){if(null===t||void 0===t)return null;var i,o=e||"parse-stringify";switch(o){case"parse-stringify":i=JSON.parse(JSON.stringify(t));break;case"jquery-extend-deep":i=jQuery.extend(!0,{},t);break;case"shallow":i=Object.create(t.constructor.prototype),Object.keys(t).map(function(e){i[e]=t[e]});break;case"shallow-assign":i=Object.create(t.constructor.prototype),Object.assign(i,t);break;case"shallow-recurse-objects":i=y(t,"shallow");var n=Object.keys(t);n.forEach(function(e){"object"==typeof t[e]&&"Object"===t[e].constructor.name&&(i[e]=y(t[e],"shallow-recurse-objects"))})}return i}function g(){try{return window&&void 0!==window.localStorage&&null!==window.localStorage}catch(t){return!1}}function m(){}function v(t,e){this.filename=t||"loki.db",this.collections=[],this.databaseVersion=1.5,this.engineVersion=1.5,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.throttledSaves=!0,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.throttledSavePending=!1,this.throttledCallbacks=[],this.verbose=!(!e||!e.hasOwnProperty("verbose"))&&e.verbose,this.events={init:[],loaded:[],flushChanges:[],close:[],changes:[],warning:[]},e&&e.hasOwnProperty("env")?this.ENV=e.env:this.ENV=void 0!==o&&(o.android||o.NSObject)?"NATIVESCRIPT":"undefined"==typeof window?"NODEJS":void 0!==o&&o.window&&n?"NODEJS":"undefined"!=typeof document?-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?"CORDOVA":"BROWSER":"CORDOVA","undefined"===this.ENV&&(this.ENV="NODEJS"),this.configureOptions(e,!0),this.on("init",this.clearChanges)}function _(t){this.hashStore={},this.options=t||{},this.options.hasOwnProperty("asyncResponses")||(this.options.asyncResponses=!1),this.options.hasOwnProperty("asyncTimeout")||(this.options.asyncTimeout=50)}function b(t,e){if(this.mode="reference",this.adapter=null,this.options=e||{},this.dbref=null,this.dbname="",this.pageIterator={},!t)throw new Error("LokiPartitioningAdapter requires a (non-reference mode) adapter on construction");if("reference"===t.mode)throw new Error("LokiPartitioningAdapter cannot be instantiated with a reference mode adapter");this.adapter=t,this.options.hasOwnProperty("paging")||(this.options.paging=!1),this.options.hasOwnProperty("pageSize")||(this.options.pageSize=26214400),this.options.hasOwnProperty("delimiter")||(this.options.delimiter="$<\n")}function O(){try{this.fs=i(11)}catch(t){this.fs=null}}function A(){}function E(t,e){return e=e||{},this.collection=t,this.filteredrows=[],this.filterInitialized=!1,this}function w(t,e,i){this.collection=t,this.name=e,this.rebuildPending=!1,this.options=i||{},this.options.hasOwnProperty("persistent")||(this.options.persistent=!1),this.options.hasOwnProperty("sortPriority")||(this.options.sortPriority="passive"),this.options.hasOwnProperty("minRebuildInterval")||(this.options.minRebuildInterval=1),this.resultset=new E(t),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,this.events={rebuild:[]}}function C(e,i){this.name=e,this.data=[],this.idIndex=[],this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=e,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;var o=this;(i=i||{}).hasOwnProperty("unique")&&(Array.isArray(i.unique)||(i.unique=[i.unique]),i.unique.forEach(function(t){o.uniqueNames.push(t),o.constraints.unique[t]=new M(t)})),i.hasOwnProperty("exact")&&i.exact.forEach(function(t){o.constraints.exact[t]=new x(t)}),this.adaptiveBinaryIndices=!i.hasOwnProperty("adaptiveBinaryIndices")||i.adaptiveBinaryIndices,this.transactional=!!i.hasOwnProperty("transactional")&&i.transactional,this.cloneObjects=!!i.hasOwnProperty("clone")&&i.clone,this.cloneMethod=i.hasOwnProperty("cloneMethod")?i.cloneMethod:"parse-stringify",this.asyncListeners=!!i.hasOwnProperty("asyncListeners")&&i.asyncListeners,this.disableMeta=!!i.hasOwnProperty("disableMeta")&&i.disableMeta,this.disableChangesApi=!i.hasOwnProperty("disableChangesApi")||i.disableChangesApi,this.disableDeltaChangesApi=!i.hasOwnProperty("disableDeltaChangesApi")||i.disableDeltaChangesApi,this.disableChangesApi&&(this.disableDeltaChangesApi=!0),this.autoupdate=!!i.hasOwnProperty("autoupdate")&&i.autoupdate,this.serializableIndices=!i.hasOwnProperty("serializableIndices")||i.serializableIndices,this.ttl={age:null,ttlInterval:null,daemon:null},this.setTTL(i.ttl||-1,i.ttlInterval),this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],delete:[],warning:[]},this.changes=[],this.ensureId();var n=[];if(i&&i.indices)if("[object Array]"===Object.prototype.toString.call(i.indices))n=i.indices;else{if("string"!=typeof i.indices)throw new TypeError("Indices needs to be a string or an array of strings");n=[i.indices]}for(var r=0;r<n.length;r++)this.ensureIndex(n[r]);function s(t,e){var i=null!==e&&"object"==typeof e?Object.keys(e):null;if(i&&i.length&&["string","boolean","number"].indexOf(typeof e)<0){for(var n={},r=0;r<i.length;r++){var a=i[r];if(e.hasOwnProperty(a))if(!t.hasOwnProperty(a)||o.uniqueNames.indexOf(a)>=0||"$loki"==a||"meta"==a)n[a]=e[a];else{var u=s(t[a],e[a]);void 0!==u&&u!={}&&(n[a]=u)}}return 0===Object.keys(n).length?void 0:n}return t===e?void 0:e}function a(){o.changes=[]}this.observerCallback=function(e){var i="function"==typeof Set?new Set:[];i.add||(i.add=function(t){return-1===this.indexOf(t)&&this.push(t),this}),e.forEach(function(t){i.add(t.object)}),i.forEach(function(e){if(!t.call(e,"$loki"))return o.removeAutoUpdateObserver(e);try{o.update(e)}catch(t){}})},this.getChangeDelta=function(t,e){return e?s(e,t):JSON.parse(JSON.stringify(t))},this.getObjectDelta=s,this.getChanges=function(){return o.changes},this.flushChanges=a,this.setChangesApi=function(t){o.disableChangesApi=!t,t||(o.disableDeltaChangesApi=!1)},this.on("delete",function(t){o.disableChangesApi||o.createChange(o.name,"R",t)}),this.on("warning",function(t){o.console.warn(t)}),a()}function I(t){return-1!==t.indexOf(".")}function P(t){return parseFloat(t,10)}function T(t,e){return t+e}function k(t,e){return t-e}function S(t){return t.reduce(T,0)/t.length}function D(t,e,i){if(!1===i)return t[e];for(var o=e.split("."),n=t;o.length>0;)n=n[o.shift()];return n}function N(t,e,i){for(var o,n,r=0,s=t.length;r<s;){if(n=r+s>>1,0===(o=i.apply(null,[e,t[n]])))return{found:!0,index:n};o<0?s=n:r=n+1}return{found:!1,index:s}}function F(t){return function(e,i){return N(e,i,t)}}function R(){}function M(t){this.field=t,this.keyMap={},this.lokiMap={}}function x(t){this.index={},this.field=t}return m.prototype.events={},m.prototype.asyncListeners=!1,m.prototype.on=function(t,e){var i,o=this;return Array.isArray(t)?(t.forEach(function(t){o.on(t,e)}),e):((i=this.events[t])||(i=this.events[t]=[]),i.push(e),e)},m.prototype.emit=function(t){var e=this,i=Array.prototype.slice.call(arguments,1);if(!t||!this.events[t])throw new Error("No event "+t+" defined");this.events[t].forEach(function(t){e.asyncListeners?setTimeout(function(){t.apply(e,i)},1):t.apply(e,i)})},m.prototype.addListener=m.prototype.on,m.prototype.removeListener=function(t,e){var i=this;if(Array.isArray(t))t.forEach(function(t){i.removeListener(t,e)});else if(this.events[t]){var o=this.events[t];o.splice(o.indexOf(e),1)}},v.prototype=new m,v.prototype.constructor=v,v.prototype.getIndexedAdapter=function(){return i(12)},v.prototype.configureOptions=function(t,e){var i={fs:O,localStorage:A,memory:_};if(this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,void 0!==t){if(this.options=t,this.options.hasOwnProperty("persistenceMethod")&&"function"==typeof i[t.persistenceMethod]&&(this.persistenceMethod=t.persistenceMethod,this.persistenceAdapter=new i[t.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=t.adapter,this.options.adapter=null),t.autoload&&e){var o=this;setTimeout(function(){o.loadDatabase(t,t.autoloadCallback)},1)}this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.options.hasOwnProperty("autosaveCallback")?this.autosaveEnable(t,t.autosaveCallback):this.autosaveEnable()),this.options.hasOwnProperty("throttledSaves")&&(this.throttledSaves=this.options.throttledSaves)}this.options.hasOwnProperty("serializationMethod")||(this.options.serializationMethod="normal"),this.options.hasOwnProperty("destructureDelimiter")||(this.options.destructureDelimiter="$<\n"),null===this.persistenceAdapter&&(this.persistenceMethod={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage",MEMORY:"memory"}[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new i[this.persistenceMethod]))},v.prototype.copy=function(t){var e,i,o=new v(this.filename,{env:"NA"});if(t=t||{},o.loadJSONObject(this,{retainDirtyFlags:!0}),t.hasOwnProperty("removeNonSerializable")&&!0===t.removeNonSerializable)for(o.autosaveHandle=null,o.persistenceAdapter=null,e=o.collections.length,i=0;i<e;i++)o.collections[i].constraints=null,o.collections[i].ttl=null;return o},v.prototype.addCollection=function(t,e){var i,o=this.collections.length;if(e&&!0===e.disableMeta){if(!1===e.disableChangesApi)throw new Error("disableMeta option cannot be passed as true when disableChangesApi is passed as false");if(!1===e.disableDeltaChangesApi)throw new Error("disableMeta option cannot be passed as true when disableDeltaChangesApi is passed as false");if("number"==typeof e.ttl&&e.ttl>0)throw new Error("disableMeta option cannot be passed as true when ttl is enabled")}for(i=0;i<o;i+=1)if(this.collections[i].name===t)return this.collections[i];var n=new C(t,e);return this.collections.push(n),this.verbose&&(n.console=console),n},v.prototype.loadCollection=function(t){if(!t.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(t)},v.prototype.getCollection=function(t){var e,i=this.collections.length;for(e=0;e<i;e+=1)if(this.collections[e].name===t)return this.collections[e];return this.emit("warning","collection "+t+" not found"),null},v.prototype.renameCollection=function(t,e){var i=this.getCollection(t);return i&&(i.name=e),i},v.prototype.listCollections=function(){for(var t=this.collections.length,e=[];t--;)e.push({name:this.collections[t].name,type:this.collections[t].objType,count:this.collections[t].data.length});return e},v.prototype.removeCollection=function(t){var e,i=this.collections.length;for(e=0;e<i;e+=1)if(this.collections[e].name===t){var o=new C(t,{}),n=this.collections[e];for(var r in n)n.hasOwnProperty(r)&&o.hasOwnProperty(r)&&(n[r]=o[r]);return void this.collections.splice(e,1)}},v.prototype.getName=function(){return this.name},v.prototype.serializeReplacer=function(t,e){switch(t){case"autosaveHandle":case"persistenceAdapter":case"constraints":case"ttl":return null;case"throttledSavePending":case"throttledCallbacks":return;default:return e}},v.prototype.serialize=function(t){switch((t=t||{}).hasOwnProperty("serializationMethod")||(t.serializationMethod=this.options.serializationMethod),t.serializationMethod){case"normal":return JSON.stringify(this,this.serializeReplacer);case"pretty":return JSON.stringify(this,this.serializeReplacer,2);case"destructured":return this.serializeDestructured();default:return JSON.stringify(this,this.serializeReplacer)}},v.prototype.toJson=v.prototype.serialize,v.prototype.serializeDestructured=function(t){var e,i,o,n,r,s=[];if((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),!0===t.partitioned&&t.hasOwnProperty("partition")&&t.partition>=0)return this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:t.partition});for((r=new v(this.filename)).loadJSONObject(this),e=0;e<r.collections.length;e++)r.collections[e].data=[];if(!0===t.partitioned&&-1===t.partition)return r.serialize({serializationMethod:"normal"});for(s.push(r.serialize({serializationMethod:"normal"})),r=null,e=0;e<this.collections.length;e++)if(o=this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:e}),!1===t.partitioned&&!1===t.delimited){if(!Array.isArray(o))throw new Error("a nondelimited, non partitioned collection serialization did not return an expected array");for(n=o.length,i=0;i<n;i++)s.push(o[i]),o[i]=null;s.push("")}else s.push(o);return t.partitioned?(t.delimited,s):t.delimited?(s.push(""),s.join(t.delimiter)):(s.push(""),s)},v.prototype.serializeCollection=function(t){var e,i,o=[];if((t=t||{}).hasOwnProperty("delimited")||(t.delimited=!0),!t.hasOwnProperty("collectionIndex"))throw new Error("serializeCollection called without 'collectionIndex' option");for(e=this.collections[t.collectionIndex].data.length,o=[],i=0;i<e;i++)o.push(JSON.stringify(this.collections[t.collectionIndex].data[i]));return t.delimited?(o.push(""),o.join(t.delimiter)):o},v.prototype.deserializeDestructured=function(t,e){var i,o,n,r=[],s=0,a=1,u=!1;if((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.partitioned){if(e.hasOwnProperty("partition"))return-1===e.partition?i=JSON.parse(t[0]):this.deserializeCollection(t[e.partition+1],e);for(i=JSON.parse(t[0]),o=i.collections.length,s=0;s<o;s++)i.collections[s].data=this.deserializeCollection(t[s+1],e);return i}if(e.delimited){if(r=t.split(e.delimiter),t=null,0===r.length)return null}else r=t;for(i=JSON.parse(r[0]),o=i.collections.length,r[0]=null;!u;)r[a],""===r[a]?++s>o&&(u=!0):(n=JSON.parse(r[a]),i.collections[s].data.push(n)),r[a++]=null;return i},v.prototype.deserializeCollection=function(t,e){var i,o,n=[];for((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.delimited?(n=t.split(e.delimiter)).pop():n=t,o=n.length,i=0;i<o;i++)n[i]=JSON.parse(n[i]);return n},v.prototype.loadJSON=function(t,e){var i;if(0===t.length)i={};else switch(this.options.serializationMethod){case"normal":case"pretty":i=JSON.parse(t);break;case"destructured":i=this.deserializeDestructured(t);break;default:i=JSON.parse(t)}this.loadJSONObject(i,e)},v.prototype.loadJSONObject=function(t,i){var o,n,r,s,a,u,c=0,l=t.collections?t.collections.length:0;function h(t){var o,n=i[t.name];return n.proto?(o=n.inflate||e.copyProperties,function(t){var e=new n.proto;return o(t,e),e}):n.inflate}for(this.name=t.name,t.hasOwnProperty("throttledSaves")&&i&&!i.hasOwnProperty("throttledSaves")&&(this.throttledSaves=t.throttledSaves),this.collections=[];c<l;c+=1){if(o=t.collections[c],(n=this.addCollection(o.name,{disableChangesApi:o.disableChangesApi,disableDeltaChangesApi:o.disableDeltaChangesApi,disableMeta:o.disableMeta})).adaptiveBinaryIndices=!!o.hasOwnProperty("adaptiveBinaryIndices")&&!0===o.adaptiveBinaryIndices,n.transactional=o.transactional,n.asyncListeners=o.asyncListeners,n.cloneObjects=o.cloneObjects,n.cloneMethod=o.cloneMethod||"parse-stringify",n.autoupdate=o.autoupdate,n.changes=o.changes,i&&!0===i.retainDirtyFlags?n.dirty=o.dirty:n.dirty=!1,r=o.data.length,s=0,i&&i.hasOwnProperty(o.name))for(a=h(o);s<r;s++)u=a(o.data[s]),n.data[s]=u,n.addAutoUpdateObserver(u);else for(;s<r;s++)n.data[s]=o.data[s],n.addAutoUpdateObserver(n.data[s]);if(n.maxId=void 0===o.maxId?0:o.maxId,n.idIndex=o.idIndex,void 0!==o.binaryIndices&&(n.binaryIndices=o.binaryIndices),void 0!==o.transforms&&(n.transforms=o.transforms),n.ensureId(),n.uniqueNames=[],o.hasOwnProperty("uniqueNames"))for(n.uniqueNames=o.uniqueNames,s=0;s<n.uniqueNames.length;s++)n.ensureUniqueIndex(n.uniqueNames[s]);if(void 0!==o.DynamicViews){for(var d=0;d<o.DynamicViews.length;d++){var p=o.DynamicViews[d],f=n.addDynamicView(p.name,p.options);f.resultdata=p.resultdata,f.resultsdirty=p.resultsdirty,f.filterPipeline=p.filterPipeline,f.sortCriteria=p.sortCriteria,f.sortFunction=null,f.sortDirty=p.sortDirty,f.resultset.filteredrows=p.resultset.filteredrows,f.resultset.filterInitialized=p.resultset.filterInitialized,f.rematerialize({removeWhereFilters:!0})}t.databaseVersion<1.5&&(n.ensureAllIndexes(!0),n.dirty=!0)}}},v.prototype.close=function(t){this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&(this.saveDatabase(t),t=void 0)),t&&this.on("close",t),this.emit("close")},v.prototype.generateChangesNotification=function(t){function e(t){return t.name}var i=[],o=t||this.collections.map(e);return this.collections.forEach(function(t){-1!==o.indexOf(e(t))&&(i=i.concat(t.getChanges()))}),i},v.prototype.serializeChanges=function(t){return JSON.stringify(this.generateChangesNotification(t))},v.prototype.clearChanges=function(){this.collections.forEach(function(t){t.flushChanges&&t.flushChanges()})},_.prototype.loadDatabase=function(t,e){var i=this;this.options.asyncResponses?setTimeout(function(){i.hashStore.hasOwnProperty(t)?e(i.hashStore[t].value):e(null)},this.options.asyncTimeout):this.hashStore.hasOwnProperty(t)?e(this.hashStore[t].value):e(null)},_.prototype.saveDatabase=function(t,e,i){var o,n=this;this.options.asyncResponses?setTimeout(function(){o=n.hashStore.hasOwnProperty(t)?n.hashStore[t].savecount:0,n.hashStore[t]={savecount:o+1,lastsave:new Date,value:e},i()},this.options.asyncTimeout):(o=this.hashStore.hasOwnProperty(t)?this.hashStore[t].savecount:0,this.hashStore[t]={savecount:o+1,lastsave:new Date,value:e},i())},_.prototype.deleteDatabase=function(t,e){this.hashStore.hasOwnProperty(t)&&delete this.hashStore[t],"function"==typeof e&&e()},b.prototype.loadDatabase=function(t,e){var i=this;this.dbname=t,this.dbref=new v(t),this.adapter.loadDatabase(t,function(t){if(t){"string"!=typeof t&&e(new Error("LokiPartitioningAdapter received an unexpected response from inner adapter loadDatabase()"));var o=JSON.parse(t);i.dbref.loadJSONObject(o),o=null,i.dbref.collections.length,0!==i.dbref.collections.length?(i.pageIterator={collection:0,pageIndex:0},i.loadNextPartition(0,function(){e(i.dbref)})):e(i.dbref)}else e(t)})},b.prototype.loadNextPartition=function(t,e){var i=this.dbname+"."+t,o=this;if(!0===this.options.paging)return this.pageIterator.pageIndex=0,void this.loadNextPage(e);this.adapter.loadDatabase(i,function(i){var n=o.dbref.deserializeCollection(i,{delimited:!0,collectionIndex:t});o.dbref.collections[t].data=n,++t<o.dbref.collections.length?o.loadNextPartition(t,e):e()})},b.prototype.loadNextPage=function(t){var e=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,i=this;this.adapter.loadDatabase(e,function(e){var o=e.split(i.options.delimiter);e="";var n,r=o.length,s=""===o[r-1];for(s&&(o.pop(),r=o.length,""===o[r-1]&&1===r&&(o.pop(),r=o.length)),n=0;n<r;n++)i.dbref.collections[i.pageIterator.collection].data.push(JSON.parse(o[n])),o[n]=null;o=[],s?++i.pageIterator.collection<i.dbref.collections.length?i.loadNextPartition(i.pageIterator.collection,t):t():(i.pageIterator.pageIndex++,i.loadNextPage(t))})},b.prototype.exportDatabase=function(t,e,i){var o,n=e.collections.length;for(this.dbref=e,this.dbname=t,this.dirtyPartitions=[-1],o=0;o<n;o++)e.collections[o].dirty&&this.dirtyPartitions.push(o);this.saveNextPartition(function(t){i(t)})},b.prototype.saveNextPartition=function(t){var e=this,i=this.dirtyPartitions.shift(),o=this.dbname+(-1===i?"":"."+i);if(this.options.paging&&-1!==i)return this.pageIterator={collection:i,docIndex:0,pageIndex:0},void this.saveNextPage(function(i){0===e.dirtyPartitions.length?t(i):e.saveNextPartition(t)});var n=this.dbref.serializeDestructured({partitioned:!0,delimited:!0,partition:i});this.adapter.saveDatabase(o,n,function(i){i?t(i):0===e.dirtyPartitions.length?t(null):e.saveNextPartition(t)})},b.prototype.saveNextPage=function(t){var e=this,i=this.dbref.collections[this.pageIterator.collection],o=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,n=0,r=i.data.length,s=this.options.delimiter.length,a="",u="",c=!1,l=!1,h=function(i){u="",i&&t(i),c?t(null):(e.pageIterator.pageIndex++,e.saveNextPage(t))};for(0===i.data.length&&(c=!0);;)if(c||(a=JSON.stringify(i.data[this.pageIterator.docIndex]),u+=a,n+=a.length,++this.pageIterator.docIndex>=r&&(c=!0)),n>=this.options.pageSize&&(l=!0),l&&!c||(u+=this.options.delimiter,n+=s),c||l)return void this.adapter.saveDatabase(o,u,h)},O.prototype.loadDatabase=function(t,e){var i=this;this.fs.stat(t,function(o,n){!o&&n.isFile()?i.fs.readFile(t,{encoding:"utf8"},function(t,i){e(t?new Error(t):i)}):e(null)})},O.prototype.saveDatabase=function(t,e,i){var o=this,n=t+"~";this.fs.writeFile(n,e,function(e){e?i(new Error(e)):o.fs.rename(n,t,i)})},O.prototype.deleteDatabase=function(t,e){this.fs.unlink(t,function(t){t?e(new Error(t)):e()})},A.prototype.loadDatabase=function(t,e){g()?e(localStorage.getItem(t)):e(new Error("localStorage is not available"))},A.prototype.saveDatabase=function(t,e,i){g()?(localStorage.setItem(t,e),i(null)):i(new Error("localStorage is not available"))},A.prototype.deleteDatabase=function(t,e){g()?(localStorage.removeItem(t),e(null)):e(new Error("localStorage is not available"))},v.prototype.throttledSaveDrain=function(t,e){var i=this,o=(new Date).getTime();if(this.throttledSaves||t(!0),(e=e||{}).hasOwnProperty("recursiveWait")||(e.recursiveWait=!0),e.hasOwnProperty("recursiveWaitLimit")||(e.recursiveWaitLimit=!1),e.hasOwnProperty("recursiveWaitLimitDuration")||(e.recursiveWaitLimitDuration=2e3),e.hasOwnProperty("started")||(e.started=(new Date).getTime()),this.throttledSaves&&this.throttledSavePending){if(!e.recursiveWait)return void this.throttledCallbacks.push(t);this.throttledCallbacks.push(function(){return i.throttledSavePending?e.recursiveWaitLimit&&o-e.started>e.recursiveWaitLimitDuration?void t(!1):void i.throttledSaveDrain(t,e):void t(!0)})}else t(!0)},v.prototype.loadDatabaseInternal=function(t,e){var i=e||function(t,e){if(t)throw t},o=this;null!==this.persistenceAdapter?this.persistenceAdapter.loadDatabase(this.filename,function(e){if("string"==typeof e){var n=!1;try{o.loadJSON(e,t||{}),n=!0}catch(t){i(t)}n&&(i(null),o.emit("loaded","database "+o.filename+" loaded"))}else{if(!e)return i(null),void o.emit("loaded","empty database "+o.filename+" loaded");if(e instanceof Error)return void i(e);if("object"==typeof e)return o.loadJSONObject(e,t||{}),i(null),void o.emit("loaded","database "+o.filename+" loaded");i("unexpected adapter response : "+e)}}):i(new Error("persistenceAdapter not configured"))},v.prototype.loadDatabase=function(t,e){var i=this;this.throttledSaves?this.throttledSaveDrain(function(o){if(o)return i.throttledSavePending=!0,void i.loadDatabaseInternal(t,function(t){0===i.throttledCallbacks.length?i.throttledSavePending=!1:i.saveDatabase(),"function"==typeof e&&e(t)});"function"==typeof e&&e(new Error("Unable to pause save throttling long enough to read database"))},t):this.loadDatabaseInternal(t,e)},v.prototype.saveDatabaseInternal=function(t){var e=t||function(t){if(t)throw t},i=this;null!==this.persistenceAdapter?"reference"===this.persistenceAdapter.mode&&"function"==typeof this.persistenceAdapter.exportDatabase?this.persistenceAdapter.exportDatabase(this.filename,this.copy({removeNonSerializable:!0}),function(t){i.autosaveClearFlags(),e(t)}):(i.autosaveClearFlags(),this.persistenceAdapter.saveDatabase(this.filename,i.serialize(),function(t){e(t)})):e(new Error("persistenceAdapter not configured"))},v.prototype.saveDatabase=function(t){if(this.throttledSaves)if(this.throttledSavePending)this.throttledCallbacks.push(t);else{var e=this.throttledCallbacks;this.throttledCallbacks=[],e.unshift(t),this.throttledSavePending=!0;var i=this;this.saveDatabaseInternal(function(t){i.throttledSavePending=!1,e.forEach(function(e){"function"==typeof e&&setTimeout(function(){e(t)},1)}),i.throttledCallbacks.length>0&&i.saveDatabase()})}else this.saveDatabaseInternal(t)},v.prototype.save=v.prototype.saveDatabase,v.prototype.deleteDatabase=function(t,e){var i=e||function(t,e){if(t)throw t};"function"!=typeof t||e||(i=t),null!==this.persistenceAdapter?this.persistenceAdapter.deleteDatabase(this.filename,function(t){i(t)}):i(new Error("persistenceAdapter not configured"))},v.prototype.autosaveDirty=function(){for(var t=0;t<this.collections.length;t++)if(this.collections[t].dirty)return!0;return!1},v.prototype.autosaveClearFlags=function(){for(var t=0;t<this.collections.length;t++)this.collections[t].dirty=!1},v.prototype.autosaveEnable=function(t,e){this.autosave=!0;var i=5e3,o=this;void 0!==this.autosaveInterval&&null!==this.autosaveInterval&&(i=this.autosaveInterval),this.autosaveHandle=setInterval(function(){o.autosaveDirty()&&o.saveDatabase(e)},i)},v.prototype.autosaveDisable=function(){void 0!==this.autosaveHandle&&null!==this.autosaveHandle&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)},E.prototype.reset=function(){return this.filteredrows.length>0&&(this.filteredrows=[]),this.filterInitialized=!1,this},E.prototype.toJSON=function(){var t=this.copy();return t.collection=null,t},E.prototype.limit=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new E(this.collection);return e.filteredrows=this.filteredrows.slice(0,t),e.filterInitialized=!0,e},E.prototype.offset=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new E(this.collection);return e.filteredrows=this.filteredrows.slice(t),e.filterInitialized=!0,e},E.prototype.copy=function(){var t=new E(this.collection);return this.filteredrows.length>0&&(t.filteredrows=this.filteredrows.slice()),t.filterInitialized=this.filterInitialized,t},E.prototype.branch=E.prototype.copy,E.prototype.transform=function(t,i){var o,n,r=this;if("string"==typeof t&&this.collection.transforms.hasOwnProperty(t)&&(t=this.collection.transforms[t]),"object"!=typeof t||!Array.isArray(t))throw new Error("Invalid transform");for(void 0!==i&&(t=e.resolveTransformParams(t,i)),o=0;o<t.length;o++)switch((n=t[o]).type){case"find":r.find(n.value);break;case"where":r.where(n.value);break;case"simplesort":r.simplesort(n.property,n.desc||n.options);break;case"compoundsort":r.compoundsort(n.value);break;case"sort":r.sort(n.value);break;case"limit":r=r.limit(n.value);break;case"offset":r=r.offset(n.value);break;case"map":r=r.map(n.value,n.dataOptions);break;case"eqJoin":r=r.eqJoin(n.joinData,n.leftJoinKey,n.rightJoinKey,n.mapFun,n.dataOptions);break;case"mapReduce":r=r.mapReduce(n.mapFunction,n.reduceFunction);break;case"update":r.update(n.value);break;case"remove":r.remove()}return r},E.prototype.sort=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e,i,o=(e=t,i=this.collection.data,function(t,o){return e(i[t],i[o])});return this.filteredrows.sort(o),this},E.prototype.simplesort=function(t,e){var i,o=10,n=this.collection.data.length,r=this.filteredrows.length,s=this.collection.binaryIndices.hasOwnProperty(t);if(void 0!==e&&!1!==e||(e={desc:!1}),!0===e&&(e={desc:!0}),0===r){if(this.filterInitialized)return this;if(this.collection.binaryIndices.hasOwnProperty(t))return this.collection.ensureIndex(t),this.filteredrows=this.collection.binaryIndices[t].values.slice(0),e.desc&&this.filteredrows.reverse(),this;this.filteredrows=this.collection.prepareFullDocIndex()}else if(!e.disableIndexIntersect&&s&&(i=n/r,e.useJavascriptSorting&&(o=6),i<=o||e.forceIndexIntersect)){var a,u=this.filteredrows,l={};for(a=0;a<r;a++)l[u[a]]=!0;var h=this.collection.binaryIndices[t].values;return this.filteredrows=h.filter(function(t){return l[t]}),e.desc&&this.filteredrows.reverse(),this}if(e.useJavascriptSorting)return this.sort(function(e,i){return e[t]===i[t]?0:e[t]>i[t]?1:e[t]<i[t]?-1:void 0});var d,p,f,y,g,m,v=(d=t,p=e.desc,f=this.collection.data,function(t,e){return~d.indexOf(".")?(m=d.split("."),y=m.reduce(function(t,e){return t&&t[e]||void 0},f[t]),g=m.reduce(function(t,e){return t&&t[e]||void 0},f[e])):(y=f[t][d],g=f[e][d]),c(y,g,p)});return this.filteredrows.sort(v),this},E.prototype.compoundsort=function(t){if(0===t.length)throw new Error("Invalid call to compoundsort, need at least one property");var e;if(1===t.length)return e=t[0],Array.isArray(e)?this.simplesort(e[0],e[1]):this.simplesort(e,!1);for(var i=0,o=t.length;i<o;i+=1)e=t[i],Array.isArray(e)||(t[i]=[e,!1]);this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var n,r,s=(n=t,r=this.collection.data,function(t,e){return function(t,e,i){for(var o,n,r,s,a,u=0,l=0,h=t.length;l<h;l++)if(o=t[l],~(n=o[0]).indexOf(".")?(a=n.split("."),r=a.reduce(function(t,e){return t&&t[e]||void 0},e),s=a.reduce(function(t,e){return t&&t[e]||void 0},i)):(r=e[n],s=i[n]),0!==(u=c(r,s,o[1])))return u;return 0}(n,r[t],r[e])});return this.filteredrows.sort(s),this},E.prototype.findOr=function(t){for(var e=null,i=0,o=0,n=[],r=[],s=0,a=this.count(),u=0,c=t.length;u<c;u++){if(e=this.branch().find(t[u]).filteredrows,(o=e.length)===a)return this;for(i=0;i<o;i++)s=e[i],void 0===r[s]&&(r[s]=!0,n.push(s))}return this.filteredrows=n,this.filterInitialized=!0,this},E.prototype.$or=E.prototype.findOr,E.prototype.findAnd=function(t){for(var e=0,i=t.length;e<i;e++){if(0===this.count())return this;this.find(t[e])}return this},E.prototype.$and=E.prototype.findAnd,E.prototype.find=function(e,i){if(0===this.collection.data.length)return this.filteredrows=[],this.filterInitialized=!0,this;var o,n,r,s,a,u,c,h=e||"getAll",d=!1,y=[],g=[],m=null;if(i=i||!1,"object"==typeof h){for(o in h)(s={})[o]=h[o],g.push(s),t.call(h,o)&&(n=o,r=h[o]);if(g.length>1)return this.find({$and:g},i)}if(!n||"getAll"===h)return i&&(this.filteredrows=this.collection.data.length>0?[0]:[],this.filterInitialized=!0),this;if("$and"===n||"$or"===n)return this[n](r),i&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this;if(null===r||"object"!=typeof r||r instanceof Date)a="$eq",u=r;else{if("object"!=typeof r)throw new Error("Do not know what you want to do.");for(c in r)if(t.call(r,c)){a=c,u=r[c];break}}"$regex"===a&&(Array.isArray(u)?u=new RegExp(u[0],u[1]):u instanceof RegExp||(u=new RegExp(u)));var v=-1!==n.indexOf("."),_=!v&&!this.filterInitialized;_&&this.collection.binaryIndices[n]&&f[a]&&(!0!==this.collection.adaptiveBinaryIndices&&this.collection.ensureIndex(n),d=!0,m=this.collection.binaryIndices[n]);var b,O=p[a],A=this.collection.data,E=0,w=0,C=0;if(this.filterInitialized)if(b=this.filteredrows,w=b.length,v)for(n=n.split("."),E=0;E<w;E++)C=b[E],l(A[C],n,O,u)&&y.push(C);else for(E=0;E<w;E++)C=b[E],O(A[C][n],u)&&y.push(C);else if(d){var I=this.collection.calculateRange(a,n,u);if("$in"!==a){for(E=I[0];E<=I[1];E++)if(!0!==f[a]){if(f[a](A[m.values[E]][n],u)&&(y.push(m.values[E]),i))return this.filteredrows=y,this.filterInitialized=!0,this}else if(y.push(m.values[E]),i)return this.filteredrows=y,this.filterInitialized=!0,this}else for(E=0,w=I.length;E<w;E++)if(y.push(m.values[I[E]]),i)return this.filteredrows=y,this.filterInitialized=!0,this}else if(w=A.length,v){for(n=n.split("."),E=0;E<w;E++)if(l(A[E],n,O,u)&&(y.push(E),i))return this.filteredrows=y,this.filterInitialized=!0,this}else for(E=0;E<w;E++)if(O(A[E][n],u)&&(y.push(E),i))return this.filteredrows=y,this.filterInitialized=!0,this;return this.filteredrows=y,this.filterInitialized=!0,this},E.prototype.where=function(t){var e,i=[];if("function"!=typeof t)throw new TypeError("Argument is not a stored view or a function");e=t;try{if(this.filterInitialized){for(var o=this.filteredrows.length;o--;)!0===e(this.collection.data[this.filteredrows[o]])&&i.push(this.filteredrows[o]);return this.filteredrows=i,this}for(var n=this.collection.data.length;n--;)!0===e(this.collection.data[n])&&i.push(n);return this.filteredrows=i,this.filterInitialized=!0,this}catch(t){throw t}},E.prototype.count=function(){return this.filterInitialized?this.filteredrows.length:this.collection.count()},E.prototype.data=function(t){var e,i,o,n,r=[],s=this.collection.data;if((t=t||{}).removeMeta&&!t.forceClones&&(t.forceClones=!0,t.forceCloneMethod=t.forceCloneMethod||"shallow"),this.collection.disableDeltaChangesApi||(t.forceClones=!0,t.forceCloneMethod="parse-stringify"),!this.filterInitialized){if(0===this.filteredrows.length){if(this.collection.cloneObjects||t.forceClones){for(i=s.length,n=t.forceCloneMethod||this.collection.cloneMethod,o=0;o<i;o++)e=y(s[o],n),t.removeMeta&&(delete e.$loki,delete e.meta),r.push(e);return r}return s.slice()}this.filterInitialized=!0}var a=this.filteredrows;if(i=a.length,this.collection.cloneObjects||t.forceClones)for(n=t.forceCloneMethod||this.collection.cloneMethod,o=0;o<i;o++)e=y(s[a[o]],n),t.removeMeta&&(delete e.$loki,delete e.meta),r.push(e);else for(o=0;o<i;o++)r.push(s[a[o]]);return r},E.prototype.update=function(t){if("function"!=typeof t)throw new TypeError("Argument is not a function");this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());for(var e,i=this.filteredrows.length,o=this.collection.data,n=0;n<i;n++)this.collection.cloneObjects||!this.collection.disableDeltaChangesApi?(e=y(o[this.filteredrows[n]],this.collection.cloneMethod),t(e),this.collection.update(e)):(t(o[this.filteredrows[n]]),this.collection.update(o[this.filteredrows[n]]));return this},E.prototype.remove=function(){return this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex()),this.collection.removeBatchByPositions(this.filteredrows),this.filteredrows=[],this},E.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(t){throw t}},E.prototype.eqJoin=function(t,e,i,o,n){var r,s,a,u=[],c=[],l=[],h="function"==typeof e,d="function"==typeof i,p={};if(u=this.data(n),r=u.length,t instanceof C)c=t.chain().data(n);else if(t instanceof E)c=t.data(n);else{if(!Array.isArray(t))throw new TypeError("joinData needs to be an array or result set");c=t}s=c.length;for(var f=0;f<s;f++)a=d?i(c[f]):c[f][i],p[a]=c[f];o||(o=function(t,e){return{left:t,right:e}});for(var y=0;y<r;y++)a=h?e(u[y]):u[y][e],l.push(o(u[y],p[a]||{}));return this.collection=new C("joinData"),this.collection.insert(l),this.filteredrows=[],this.filterInitialized=!1,this},E.prototype.map=function(t,e){var i=this.data(e).map(t);return this.collection=new C("mappedData"),this.collection.insert(i),this.filteredrows=[],this.filterInitialized=!1,this},w.prototype=new m,w.prototype.rematerialize=function(t){var e,i,o;if(t=t||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new E(this.collection),(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple)&&(this.sortDirty=!0),t.hasOwnProperty("removeWhereFilters"))for(e=this.filterPipeline.length,i=e;i--;)"where"===this.filterPipeline[i].type&&(i!==this.filterPipeline.length-1&&(this.filterPipeline[i]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);var n=this.filterPipeline;for(this.filterPipeline=[],e=n.length,o=0;o<e;o++)this.applyFind(n[o].val);return this.data(),this.emit("rebuild",this),this},w.prototype.branchResultset=function(t,e){var i=this.resultset.branch();return void 0===t?i:i.transform(t,e)},w.prototype.toJSON=function(){var t=new w(this.collection,this.name,this.options);return t.resultset=this.resultset,t.resultdata=[],t.resultsdirty=!0,t.filterPipeline=this.filterPipeline,t.sortFunction=this.sortFunction,t.sortCriteria=this.sortCriteria,t.sortCriteriaSimple=this.sortCriteriaSimple||null,t.sortDirty=this.sortDirty,t.collection=null,t},w.prototype.removeFilters=function(t){t=t||{},this.rebuildPending=!1,this.resultset.reset(),this.resultdata=[],this.resultsdirty=!0,this.cachedresultset=null,this.filterPipeline=[],this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,!0===t.queueSortPhase&&this.queueSortPhase()},w.prototype.applySort=function(t){return this.sortFunction=t,this.sortCriteria=null,this.sortCriteriaSimple=null,this.queueSortPhase(),this},w.prototype.applySimpleSort=function(t,e){return this.sortCriteriaSimple={propname:t,options:e||!1},this.sortCriteria=null,this.sortFunction=null,this.queueSortPhase(),this},w.prototype.applySortCriteria=function(t){return this.sortCriteria=t,this.sortCriteriaSimple=null,this.sortFunction=null,this.queueSortPhase(),this},w.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},w.prototype.commit=function(){return this.cachedresultset=null,this},w.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},w.prototype._indexOfFilterWithId=function(t){if("string"==typeof t||"number"==typeof t)for(var e=0,i=this.filterPipeline.length;e<i;e+=1)if(t===this.filterPipeline[e].uid)return e;return-1},w.prototype._addFilter=function(t){this.filterPipeline.push(t),this.resultset[t.type](t.val)},w.prototype.reapplyFilters=function(){this.resultset.reset(),this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0);var t=this.filterPipeline;this.filterPipeline=[];for(var e=0,i=t.length;e<i;e+=1)this._addFilter(t[e]);return this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this},w.prototype.applyFilter=function(t){var e=this._indexOfFilterWithId(t.uid);return e>=0?(this.filterPipeline[e]=t,this.reapplyFilters()):(this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0),this._addFilter(t),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this)},w.prototype.applyFind=function(t,e){return this.applyFilter({type:"find",val:t,uid:e}),this},w.prototype.applyWhere=function(t,e){return this.applyFilter({type:"where",val:t,uid:e}),this},w.prototype.removeFilter=function(t){var e=this._indexOfFilterWithId(t);if(e<0)throw new Error("Dynamic view does not contain a filter with ID: "+t);return this.filterPipeline.splice(e,1),this.reapplyFilters(),this},w.prototype.count=function(){return this.resultsdirty&&(this.resultdata=this.resultset.data()),this.resultset.count()},w.prototype.data=function(t){return(this.sortDirty||this.resultsdirty)&&this.performSortPhase({suppressRebuildEvent:!0}),this.options.persistent?this.resultdata:this.resultset.data(t)},w.prototype.queueRebuildEvent=function(){if(!this.rebuildPending){this.rebuildPending=!0;var t=this;setTimeout(function(){t.rebuildPending&&(t.rebuildPending=!1,t.emit("rebuild",t))},this.options.minRebuildInterval)}},w.prototype.queueSortPhase=function(){if(!this.sortDirty){this.sortDirty=!0;var t=this;"active"===this.options.sortPriority?setTimeout(function(){t.performSortPhase()},this.options.minRebuildInterval):this.queueRebuildEvent()}},w.prototype.performSortPhase=function(t){(this.sortDirty||this.resultsdirty)&&(t=t||{},this.sortDirty&&(this.sortFunction?this.resultset.sort(this.sortFunction):this.sortCriteria?this.resultset.compoundsort(this.sortCriteria):this.sortCriteriaSimple&&this.resultset.simplesort(this.sortCriteriaSimple.propname,this.sortCriteriaSimple.options),this.sortDirty=!1),this.options.persistent&&(this.resultdata=this.resultset.data(),this.resultsdirty=!1),t.suppressRebuildEvent||this.emit("rebuild",this))},w.prototype.evaluateDocument=function(t,e){if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var i,o=this.resultset.filteredrows,n=e?-1:o.indexOf(+t),r=o.length,s=new E(this.collection);s.filteredrows=[t],s.filterInitialized=!0;for(var a=0,u=this.filterPipeline.length;a<u;a++)i=this.filterPipeline[a],s[i.type](i.val);var c=0===s.filteredrows.length?-1:0;return-1!==n||-1!==c?-1===n&&-1!==c?(o.push(t),this.options.persistent&&this.resultdata.push(this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==n&&-1===c?(n<r-1?(o.splice(n,1),this.options.persistent&&this.resultdata.splice(n,1)):(o.length=r-1,this.options.persistent&&(this.resultdata.length=r-1)),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==n&&-1!==c?(this.options.persistent&&(this.resultdata[n]=this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):void 0:void 0},w.prototype.removeDocument=function(t){var e,i,o,n={},r={},s=[],a=this.resultset,u=this.resultset.filteredrows,c=u.length;if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());for(Array.isArray(t)||(t=[t]),o=t.length,i=0;i<o;i++)n[t[i]]=!0;for(e=0;e<c;e++)n[u[e]]&&(r[e]=!0);Object.keys(r).length>0&&(this.resultset.filteredrows=this.resultset.filteredrows.filter(function(t,e){return!r[e]}),this.options.persistent&&(this.resultdata=this.resultdata.filter(function(t,e){return!r[e]})),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var l=function(t){return function(e){return e<a.filteredrows[t]}};for(c=a.filteredrows.length,e=0;e<c;e++)s=t.filter(l(e)),a.filteredrows[e]-=s.length},w.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(t){throw t}},C.prototype=new m,C.prototype.createChange=function(t,e,i,o){this.changes.push({name:t,operation:e,obj:"U"!=e||this.disableDeltaChangesApi?JSON.parse(JSON.stringify(i)):this.getChangeDelta(i,o)})},C.prototype.insertMeta=function(t){var e,i;if(!this.disableMeta&&t)if(Array.isArray(t))for(e=t.length,i=0;i<e;i++)t[i].hasOwnProperty("meta")||(t[i].meta={}),t[i].meta.created=(new Date).getTime(),t[i].meta.revision=0;else t.meta||(t.meta={}),t.meta.created=(new Date).getTime(),t.meta.revision=0},C.prototype.updateMeta=function(t){!this.disableMeta&&t&&(t.meta.updated=(new Date).getTime(),t.meta.revision+=1)},C.prototype.createInsertChange=function(t){this.createChange(this.name,"I",t)},C.prototype.createUpdateChange=function(t,e){this.createChange(this.name,"U",t,e)},C.prototype.insertMetaWithChange=function(t){this.insertMeta(t),this.createInsertChange(t)},C.prototype.updateMetaWithChange=function(t,e){this.updateMeta(t),this.createUpdateChange(t,e)},C.prototype.console={log:function(){},warn:function(){},error:function(){}},C.prototype.addAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.observe(t,this.observerCallback,["add","update","delete","reconfigure","setPrototype"])},C.prototype.removeAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.unobserve(t,this.observerCallback)},C.prototype.addTransform=function(t,e){if(this.transforms.hasOwnProperty(t))throw new Error("a transform by that name already exists");this.transforms[t]=e},C.prototype.getTransform=function(t){return this.transforms[t]},C.prototype.setTransform=function(t,e){this.transforms[t]=e},C.prototype.removeTransform=function(t){delete this.transforms[t]},C.prototype.byExample=function(t){var e,i,o;for(e in o=[],t)t.hasOwnProperty(e)&&o.push(((i={})[e]=t[e],i));return{$and:o}},C.prototype.findObject=function(t){return this.findOne(this.byExample(t))},C.prototype.findObjects=function(t){return this.find(this.byExample(t))},C.prototype.ttlDaemonFuncGen=function(){var t=this,e=this.ttl.age;return function(){var i=Date.now(),o=t.chain().where(function(t){var o=t.meta.updated||t.meta.created,n=i-o;return e<n});o.remove()}},C.prototype.setTTL=function(t,e){t<0?clearInterval(this.ttl.daemon):(this.ttl.age=t,this.ttl.ttlInterval=e,this.ttl.daemon=setInterval(this.ttlDaemonFuncGen(),e))},C.prototype.prepareFullDocIndex=function(){for(var t=this.data.length,e=new Array(t),i=0;i<t;i+=1)e[i]=i;return e},C.prototype.configureOptions=function(t){(t=t||{}).hasOwnProperty("adaptiveBinaryIndices")&&(this.adaptiveBinaryIndices=t.adaptiveBinaryIndices,this.adaptiveBinaryIndices&&this.ensureAllIndexes())},C.prototype.ensureIndex=function(t,e){if(void 0===e&&(e=!1),null===t||void 0===t)throw new Error("Attempting to set index without an associated property");if((!this.binaryIndices[t]||e||this.binaryIndices[t].dirty)&&(!0!==this.adaptiveBinaryIndices||!this.binaryIndices.hasOwnProperty(t)||e)){var i={name:t,dirty:!0,values:this.prepareFullDocIndex()};this.binaryIndices[t]=i;var o,n,s,a,u,c=(o=t,n=this.data,function(t,e){if(~o.indexOf(".")?(u=o.split("."),s=u.reduce(function(t,e){return t&&t[e]||void 0},n[t]),a=u.reduce(function(t,e){return t&&t[e]||void 0},n[e])):(s=n[t][o],a=n[e][o]),s!==a){if(r.lt(s,a,!1))return-1;if(r.gt(s,a,!1))return 1}return 0});i.values.sort(c),i.dirty=!1,this.dirty=!0}},C.prototype.checkAllIndexes=function(e){var i,o=this.binaryIndices,n=[];for(i in o)t.call(o,i)&&(this.checkIndex(i,e)||n.push(i));return n},C.prototype.checkIndex=function(t,e){(e=e||{}).randomSamplingFactor&&!1!==e.randomSampling&&(e.randomSampling=!0),e.randomSamplingFactor=e.randomSamplingFactor||.1,(e.randomSamplingFactor<0||e.randomSamplingFactor>1)&&(e.randomSamplingFactor=.1);var i,o,n,r,s,a=!0;if(!this.binaryIndices.hasOwnProperty(t))throw new Error("called checkIndex on property without an index: "+t);if(this.adaptiveBinaryIndices||this.ensureIndex(t),s=this.binaryIndices[t].values,(r=s.length)!==this.data.length)return e.repair&&this.ensureIndex(t,!0),!1;if(0===r)return!0;if(1===r)a=0===s[0];else if(e.randomSampling){if(p.$lte(this.data[s[0]][t],this.data[s[1]][t])||(a=!1),p.$lte(this.data[s[r-2]][t],this.data[s[r-1]][t])||(a=!1),a)for(o=Math.floor((r-1)*e.randomSamplingFactor),i=0;i<o-1;i++)if(n=Math.floor(Math.random()*(r-1)),!p.$lte(this.data[s[n]][t],this.data[s[n+1]][t])){a=!1;break}}else for(i=0;i<r-1;i++)if(!p.$lte(this.data[s[i]][t],this.data[s[i+1]][t])){a=!1;break}return!a&&e.repair&&this.ensureIndex(t,!0),a},C.prototype.getBinaryIndexValues=function(t){var e,i=this.binaryIndices[t].values,o=[];for(e=0;e<i.length;e++)o.push(this.data[i[e]][t]);return o},C.prototype.ensureUniqueIndex=function(t){var e=this.constraints.unique[t];return e||-1==this.uniqueNames.indexOf(t)&&this.uniqueNames.push(t),this.constraints.unique[t]=e=new M(t),this.data.forEach(function(t){e.set(t)}),e},C.prototype.ensureAllIndexes=function(e){var i,o=this.binaryIndices;for(i in o)t.call(o,i)&&this.ensureIndex(i,e)},C.prototype.flagBinaryIndexesDirty=function(){var e,i=this.binaryIndices;for(e in i)t.call(i,e)&&(i[e].dirty=!0)},C.prototype.flagBinaryIndexDirty=function(t){this.binaryIndices[t]&&(this.binaryIndices[t].dirty=!0)},C.prototype.count=function(t){return t?this.chain().find(t).filteredrows.length:this.data.length},C.prototype.ensureId=function(){var t=this.data.length,e=0;for(this.idIndex=[];e<t;e+=1)this.idIndex.push(this.data[e].$loki)},C.prototype.ensureIdAsync=function(t){this.async(function(){this.ensureId()},t)},C.prototype.addDynamicView=function(t,e){var i=new w(this,t,e);return this.DynamicViews.push(i),i},C.prototype.removeDynamicView=function(t){for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].name===t&&this.DynamicViews.splice(e,1)},C.prototype.getDynamicView=function(t){for(var e=0;e<this.DynamicViews.length;e++)if(this.DynamicViews[e].name===t)return this.DynamicViews[e];return null},C.prototype.findAndUpdate=function(t,e){"function"==typeof t?this.updateWhere(t,e):this.chain().find(t).update(e)},C.prototype.findAndRemove=function(t){this.chain().find(t).remove()},C.prototype.insert=function(t){if(!Array.isArray(t))return this.insertOne(t);var e,i=[];this.emit("pre-insert",t);for(var o=0,n=t.length;o<n;o++){if(!(e=this.insertOne(t[o],!0)))return;i.push(e)}return this.emit("insert",i),1===(i=this.cloneObjects?y(i,this.cloneMethod):i).length?i[0]:i},C.prototype.insertOne=function(t,e){var i,o=null;if("object"!=typeof t?o=new TypeError("Document needs to be an object"):null===t&&(o=new TypeError("Object cannot be null")),null!==o)throw this.emit("error",o),o;var n=this.cloneObjects?y(t,this.cloneMethod):t;if(this.disableMeta||void 0!==n.meta||(n.meta={revision:0,created:0}),e||this.emit("pre-insert",n),this.add(n))return this.disableChangesApi?this.insertMeta(n):this.insertMetaWithChange(n),i=this.cloneObjects?y(n,this.cloneMethod):n,e||this.emit("insert",i),this.addAutoUpdateObserver(i),i},C.prototype.clear=function(t){var e=this;if(t=t||{},this.data=[],this.idIndex=[],this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0,!0===t.removeIndices)this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[];else{var i=Object.keys(this.binaryIndices);i.forEach(function(t){e.binaryIndices[t].dirty=!1,e.binaryIndices[t].values=[]}),this.constraints={unique:{},exact:{}},this.uniqueNames.forEach(function(t){e.ensureUniqueIndex(t)})}},C.prototype.update=function(e){var i,o,n;if(Array.isArray(e)){n=e.length,(i=!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0)&&(this.adaptiveBinaryIndices=!1);try{for(o=0;o<n;o+=1)this.update(e[o])}finally{i&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}}else{if(!t.call(e,"$loki"))throw new Error("Trying to update unsynced document. Please save the document first by using insert() or addMany()");try{this.startTransaction();var r,s,a,u,c,l=this.get(e.$loki,!0),h=this;if(!l)throw new Error("Trying to update a document not in collection.");r=l[0],a=l[1],s=this.cloneObjects||!this.disableDeltaChangesApi?y(e,this.cloneMethod):e,this.emit("pre-update",e),Object.keys(this.constraints.unique).forEach(function(t){h.constraints.unique[t].update(r,s)}),this.data[a]=s,s!==e&&this.addAutoUpdateObserver(e);for(var d=0;d<this.DynamicViews.length;d++)this.DynamicViews[d].evaluateDocument(a,!1);if(this.adaptiveBinaryIndices){var p=this.binaryIndices;for(u in p)this.adaptiveBinaryIndexUpdate(a,u)}else this.flagBinaryIndexesDirty();return this.idIndex[a]=s.$loki,this.commit(),this.dirty=!0,this.disableChangesApi?this.updateMeta(s,null):this.updateMetaWithChange(s,r),c=this.cloneObjects?y(s,this.cloneMethod):s,this.emit("update",c,r),c}catch(t){throw this.rollback(),this.console.error(t.message),this.emit("error",t),t}}},C.prototype.add=function(e){if("object"!=typeof e)throw new TypeError("Object being added needs to be an object");if(void 0!==e.$loki)throw new Error("Document is already in collection, please use update()");try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1),e.$loki=this.maxId,this.disableMeta||(e.meta.version=0);var i,o=this.constraints.unique;for(i in o)t.call(o,i)&&o[i].set(e);this.idIndex.push(e.$loki),this.data.push(e);for(var n=this.data.length-1,r=this.DynamicViews.length,s=0;s<r;s++)this.DynamicViews[s].evaluateDocument(n,!0);if(this.adaptiveBinaryIndices){var a=this.binaryIndices;for(i in a)this.adaptiveBinaryIndexInsert(n,i)}else this.flagBinaryIndexesDirty();return this.commit(),this.dirty=!0,this.cloneObjects?y(e,this.cloneMethod):e}catch(t){throw this.rollback(),this.console.error(t.message),this.emit("error",t),t}},C.prototype.updateWhere=function(t,e){var i,o=this.where(t),n=0;try{for(;n<o.length;n++)i=e(o[n]),this.update(i)}catch(t){this.rollback(),this.console.error(t.message)}},C.prototype.removeWhere=function(t){var e;"function"==typeof t?(e=this.data.filter(t),this.remove(e)):this.chain().find(t).remove()},C.prototype.removeDataOnly=function(){this.remove(this.data.slice())},C.prototype.removeBatchByPositions=function(t){var e,i,o,n=t.length,r={},s=Object.keys(this.binaryIndices).length,a=this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0;try{for(this.startTransaction(),o=0;o<n;o++)r[this.idIndex[t[o]]]=!0;if((e=this.DynamicViews.length)>0||s>0){if(e>0)for(i=0;i<e;i++)this.DynamicViews[i].removeDocument(t);if(this.adaptiveBinaryIndices&&!a){var u,c=this.binaryIndices;for(u in c)this.adaptiveBinaryIndexRemove(t,u)}else this.flagBinaryIndexesDirty()}if(!this.disableChangesApi||this.events.delete.length>1)for(o=0;o<n;o++)this.emit("delete",this.data[t[o]]);this.data=this.data.filter(function(t){return!r[t.$loki]}),this.idIndex=this.idIndex.filter(function(t){return!r[t]}),this.adaptiveBinaryIndices&&a&&(this.adaptiveBinaryIndices=!1,this.ensureAllIndexes(!0),this.adaptiveBinaryIndices=!0),this.commit(),this.dirty=!0}catch(t){return this.rollback(),a&&(this.adaptiveBinaryIndices=!0),this.console.error(t.message),this.emit("error",t),null}},C.prototype.removeBatch=function(t){var e,i=t.length,o=this.data.length,n={},r=[];for(e=0;e<o;e++)n[this.data[e].$loki]=e;for(e=0;e<i;e++)"object"==typeof t[e]?r.push(n[t[e].$loki]):r.push(n[t[e]]);this.removeBatchByPositions(r)},C.prototype.remove=function(e){if("number"==typeof e&&(e=this.get(e)),"object"!=typeof e)throw new Error("Parameter is not an object");if(Array.isArray(e))this.removeBatch(e);else{if(!t.call(e,"$loki"))throw new Error("Object is not a document stored in the collection");try{this.startTransaction();var i=this.get(e.$loki,!0),o=i[1],n=this;Object.keys(this.constraints.unique).forEach(function(t){null!==e[t]&&void 0!==e[t]&&n.constraints.unique[t].remove(e[t])});for(var r=0;r<this.DynamicViews.length;r++)this.DynamicViews[r].removeDocument(o);if(this.adaptiveBinaryIndices){var s,a=this.binaryIndices;for(s in a)this.adaptiveBinaryIndexRemove(o,s)}else this.flagBinaryIndexesDirty();return this.data.splice(o,1),this.removeAutoUpdateObserver(e),this.idIndex.splice(o,1),this.commit(),this.dirty=!0,this.emit("delete",i[0]),delete e.$loki,delete e.meta,e}catch(t){return this.rollback(),this.console.error(t.message),this.emit("error",t),null}}},C.prototype.get=function(t,e){var i=e||!1,o=this.idIndex,n=o.length-1,r=0,s=r+n>>1;if(t="number"==typeof t?t:parseInt(t,10),isNaN(t))throw new TypeError("Passed id is not an integer");for(;o[r]<o[n];)o[s=r+n>>1]<t?r=s+1:n=s;return n===r&&o[r]===t?i?[this.data[r],r]:this.data[r]:null},C.prototype.getBinaryIndexPosition=function(t,e){var i=this.data[t][e],o=this.binaryIndices[e].values,n=this.calculateRange("$eq",e,i);if(0===n[0]&&-1===n[1])return null;for(var r=n[0],s=n[1],a=r;a<=s;a++)if(o[a]===t)return a;return null},C.prototype.adaptiveBinaryIndexInsert=function(t,e){var i=this.binaryIndices[e].values,o=this.data[t][e];!0===this.serializableIndices&&o instanceof Date&&(this.data[t][e]=o.getTime(),o=this.data[t][e]);var n=0===i.length?0:this.calculateRangeStart(e,o,!0);this.binaryIndices[e].values.splice(n,0,t)},C.prototype.adaptiveBinaryIndexUpdate=function(t,e){var i,o=this.binaryIndices[e].values,n=o.length;for(i=0;i<n&&o[i]!==t;i++);this.binaryIndices[e].values.splice(i,1),this.adaptiveBinaryIndexInsert(t,e)},C.prototype.adaptiveBinaryIndexRemove=function(t,e,i){var o,n,r,s,a,u,c,l=this.binaryIndices[e],h={};if(Array.isArray(t)){if(1!==(s=t.length)){for(r=0;r<s;r++)h[t[r]]=!0;if(l.values=l.values.filter(function(t){return!h[t]}),!0===i)return;var d=t.slice();for(d.sort(function(t,e){return t-e}),o=l.values.length,n=0;n<o;n++){for(a=l.values[n],u=0,r=0;r<s&&a>d[r];r++)u++;l.values[n]-=u}return}t=t[0]}if(null===(c=this.getBinaryIndexPosition(t,e)))return null;if(l.values.splice(c,1),!0!==i)for(o=l.values.length,n=0;n<o;n++)l.values[n]>t&&l.values[n]--},C.prototype.calculateRangeStart=function(t,e,i){var o=this.data,n=this.binaryIndices[t].values,s=0,a=n.length-1,u=0;if(0===n.length)return-1;for(o[n[s]][t],o[n[a]][t];s<a;)u=s+a>>1,r.lt(o[n[u]][t],e,!1)?s=u+1:a=u;var c=s;return r.aeq(e,o[n[c]][t])?c:r.lt(e,o[n[c]][t],!1)?i?c:c-1:i?c+1:c},C.prototype.calculateRangeEnd=function(t,e){var i=this.data,o=this.binaryIndices[t].values,n=0,s=o.length-1,a=0;if(0===o.length)return-1;for(i[o[n]][t],i[o[s]][t];n<s;)a=n+s>>1,r.lt(e,i[o[a]][t],!1)?s=a:n=a+1;var u=s;return r.aeq(e,i[o[u]][t])?u:r.gt(e,i[o[u]][t],!1)?u+1:r.aeq(e,i[o[u-1]][t])?u-1:u},C.prototype.calculateRange=function(t,e,i){var o,n,s,a=this.data,u=this.binaryIndices[e].values,c=u.length-1;if(0===a.length)return[0,-1];var l=a[u[0]][e],h=a[u[c]][e];switch(t){case"$eq":case"$aeq":case"$dteq":if(r.lt(i,l,!1)||r.gt(i,h,!1))return[0,-1];break;case"$gt":if(r.gt(i,h,!0))return[0,-1];if(r.gt(l,i,!1))return[0,c];break;case"$gte":if(r.gt(i,h,!1))return[0,-1];if(r.gt(l,i,!0))return[0,c];break;case"$lt":if(r.lt(i,l,!0))return[0,-1];if(r.lt(h,i,!1))return[0,c];break;case"$lte":if(r.lt(i,l,!1))return[0,-1];if(r.lt(h,i,!0))return[0,c];break;case"$between":return r.gt(i[0],h,!1)?[0,-1]:r.lt(i[1],l,!1)?[0,-1]:(o=this.calculateRangeStart(e,i[0]),s=this.calculateRangeEnd(e,i[1]),o<0&&o++,s>c&&s--,r.gt(a[u[o]][e],i[0],!0)||o++,r.lt(a[u[s]][e],i[1],!0)||s--,s<o?[0,-1]:[o,s]);case"$in":for(var d=[],p=[],f=0,y=i.length;f<y;f++)for(var g=this.calculateRange("$eq",e,i[f]),m=g[0];m<=g[1];m++)void 0===d[m]&&(d[m]=!0,p.push(m));return p}switch(t){case"$eq":case"$aeq":case"$dteq":case"$gte":case"$lt":o=this.calculateRangeStart(e,i),n=a[u[o]][e]}switch(t){case"$eq":case"$aeq":case"$dteq":case"$lte":case"$gt":s=this.calculateRangeEnd(e,i),a[u[s]][e]}switch(t){case"$eq":case"$aeq":case"$dteq":return r.aeq(n,i)?[o,s]:[0,-1];case"$gt":return r.aeq(a[u[s]][e],i)?[s+1,c]:[s,c];case"$gte":return r.aeq(a[u[o]][e],i)?[o,c]:[o+1,c];case"$lt":return r.aeq(a[u[o]][e],i)?[0,o-1]:[0,o];case"$lte":return r.aeq(a[u[s]][e],i)?[0,s]:[0,s-1];default:return[0,a.length-1]}},C.prototype.by=function(t,e){var i;if(void 0===e)return i=this,function(e){return i.by(t,e)};var o=this.constraints.unique[t].get(e);return this.cloneObjects?y(o,this.cloneMethod):o},C.prototype.findOne=function(t){t=t||{};var e=this.chain().find(t,!0).data();return Array.isArray(e)&&0===e.length?null:this.cloneObjects?y(e[0],this.cloneMethod):e[0]},C.prototype.chain=function(t,e){var i=new E(this);return void 0===t?i:i.transform(t,e)},C.prototype.find=function(t){return this.chain().find(t).data()},C.prototype.findOneUnindexed=function(t,e){for(var i=this.data.length;i--;)if(this.data[i][t]===e)return this.data[i];return null},C.prototype.startTransaction=function(){if(this.transactional){this.cachedData=y(this.data,this.cloneMethod),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].startTransaction()}},C.prototype.commit=function(){if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndex=null;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].commit()}},C.prototype.rollback=function(){if(this.transactional){null!==this.cachedData&&null!==this.cachedIndex&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex);for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].rollback()}},C.prototype.async=function(t,e){setTimeout(function(){if("function"!=typeof t)throw new TypeError("Argument passed for async execution is not a function");t(),e()},0)},C.prototype.where=function(t){return this.chain().where(t).data()},C.prototype.mapReduce=function(t,e){try{return e(this.data.map(t))}catch(t){throw t}},C.prototype.eqJoin=function(t,e,i,o,n){return new E(this).eqJoin(t,e,i,o,n)},C.prototype.stages={},C.prototype.getStage=function(t){return this.stages[t]||(this.stages[t]={}),this.stages[t]},C.prototype.commitLog=[],C.prototype.stage=function(t,e){var i=JSON.parse(JSON.stringify(e));return this.getStage(t)[e.$loki]=i,i},C.prototype.commitStage=function(t,e){var i,o=this.getStage(t),n=(new Date).getTime();for(i in o)this.update(o[i]),this.commitLog.push({timestamp:n,message:e,data:JSON.parse(JSON.stringify(o[i]))});this.stages[t]={}},C.prototype.no_op=function(){},C.prototype.extract=function(t){for(var e=0,i=this.data.length,o=I(t),n=[];e<i;e+=1)n.push(D(this.data[e],t,o));return n},C.prototype.max=function(t){return Math.max.apply(null,this.extract(t))},C.prototype.min=function(t){return Math.min.apply(null,this.extract(t))},C.prototype.maxRecord=function(t){for(var e,i=0,o=this.data.length,n=I(t),r={index:0,value:void 0};i<o;i+=1)void 0!==e?e<D(this.data[i],t,n)&&(e=D(this.data[i],t,n),r.index=this.data[i].$loki):(e=D(this.data[i],t,n),r.index=this.data[i].$loki);return r.value=e,r},C.prototype.minRecord=function(t){for(var e,i=0,o=this.data.length,n=I(t),r={index:0,value:void 0};i<o;i+=1)void 0!==e?e>D(this.data[i],t,n)&&(e=D(this.data[i],t,n),r.index=this.data[i].$loki):(e=D(this.data[i],t,n),r.index=this.data[i].$loki);return r.value=e,r},C.prototype.extractNumerical=function(t){return this.extract(t).map(P).filter(Number).filter(function(t){return!isNaN(t)})},C.prototype.avg=function(t){return S(this.extractNumerical(t))},C.prototype.stdDev=function(t){return e=this.extractNumerical(t),i=S(e),o=S(e.map(function(t){var e=t-i,o=e*e;return o})),Math.sqrt(o);var e,i,o},C.prototype.mode=function(t){var e,i,o,n={},r=this.extract(t);for(i in r.forEach(function(t){n[t]?n[t]+=1:n[t]=1}),n)e?e<n[i]&&(o=i):(o=i,e=n[i]);return o},C.prototype.median=function(t){var e=this.extractNumerical(t);e.sort(k);var i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2},R.prototype={keys:[],values:[],sort:function(t,e){return t<e?-1:t>e?1:0},setSort:function(t){this.bs=new F(t)},bs:function(){return new F(this.sort)},set:function(t,e){var i=this.bs(this.keys,t);i.found?this.values[i.index]=e:(this.keys.splice(i.index,0,t),this.values.splice(i.index,0,e))},get:function(t){return this.values[N(this.keys,t,this.sort).index]}},M.prototype.keyMap={},M.prototype.lokiMap={},M.prototype.set=function(t){var e=t[this.field];if(null!==e&&void 0!==e){if(this.keyMap[e])throw new Error("Duplicate key for property "+this.field+": "+e);this.keyMap[e]=t,this.lokiMap[t.$loki]=e}},M.prototype.get=function(t){return this.keyMap[t]},M.prototype.byId=function(t){return this.keyMap[this.lokiMap[t]]},M.prototype.update=function(t,e){if(this.lokiMap[t.$loki]!==e[this.field]){var i=this.lokiMap[t.$loki];this.set(e),this.keyMap[i]=void 0}else this.keyMap[t[this.field]]=e},M.prototype.remove=function(t){var e=this.keyMap[t];if(null===e||void 0===e)throw new Error("Key is not in unique index: "+this.field);this.keyMap[t]=void 0,this.lokiMap[e.$loki]=void 0},M.prototype.clear=function(){this.keyMap={},this.lokiMap={}},x.prototype={set:function(t,e){this.index[t]?this.index[t].push(e):this.index[t]=[e]},remove:function(t,e){var i=this.index[t];for(var o in i)i[o]==e&&i.splice(o,1);i.length<1&&(this.index[t]=void 0)},get:function(t){return this.index[t]},clear:function(t){this.index={}}},v.LokiOps=p,v.Collection=C,v.KeyValueStore=R,v.LokiMemoryAdapter=_,v.LokiPartitioningAdapter=b,v.LokiLocalStorageAdapter=A,v.LokiFsAdapter=O,v.persistenceAdapters={fs:O,localStorage:A},v.aeq=s,v.lt=a,v.gt=u,v.Comparators=r,v}()})?r.apply(e,s):r)||(t.exports=a)}).call(this,i(14),i(13))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),n=i(8),r=function(){function t(t,e,i){this.name=t,this.$options=e,this.lokiStorageAdapter=i,this._db=null,this.options={autosave:!0,autosaveInterval:500,autoload:!0,adapter:null},this.logger=new o.Logger("DB"),!0!==this.$options.off&&!0!==this.$options.isTest||(this.options={autosave:!1,autosaveInterval:31104e6,autoload:!1,adapter:null}),this.options.adapter=i;var r=this.name||t||this.$options.offlineDBName||"offline";this._db=new n(r,this.options),this._db.loadDatabase()}return t.prototype.getCollectionByName=function(t){var e=this._db.getCollection(t);if(!e){e=this._db.addCollection(t,{clone:!0,disableChangesApi:!0,transactional:!0})}return e},t.prototype.getCollection=function(t){var e=this;return new Promise(function(i){e._db.loadDatabase({},function(){var o=e._db.getCollection(t);if(!o){o=e._db.addCollection(t)}i(o)})})},t.prototype.saveDatabase=function(){this._db.save()},t.prototype.getCollections=function(){return this._db.listCollections()},t.prototype.internalDB=function(){return this._db},t.prototype.close=function(t){this._db.close(t)},t.prototype.flush=function(){var t=this;return new Promise(function(e){for(var i=t.getCollections(),o=0;o<i.length;o++)t.getCollectionByName(i[o].name).removeDataOnly();e(!0)})},t}();e.DB=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.SyncResourceType={item:0,collection:1,file:2}},function(t,e){},function(t,e,i){var o,n,r;n=[],void 0===(r="function"==typeof(o=function(){return function(){function t(t){if(this.app="loki",void 0!==t&&(this.app=t),this.catalog=null,!this.checkAvailability())throw new Error("indexedDB does not seem to be supported for your environment")}function e(t){this.db=null,this.initializeLokiCatalog(t)}return t.prototype.checkAvailability=function(){return!("undefined"==typeof indexedDB||!indexedDB)},t.prototype.loadDatabase=function(t,i){var o=this.app,n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(o,t,function(t){if("function"==typeof i){if(0===t.id)return void i(null);i(t.val)}else console.log(t.val)}):this.catalog=new e(function(e){n.catalog=e,n.loadDatabase(t,i)})},t.prototype.loadKey=t.prototype.loadDatabase,t.prototype.saveDatabase=function(t,i,o){var n=this.app,r=this;function s(t){t&&!0===t.success?o(null):o(new Error("Error saving database"))}null!==this.catalog&&null!==this.catalog.db?this.catalog.setAppKey(n,t,i,s):this.catalog=new e(function(e){r.catalog=e,e.setAppKey(n,t,i,s)})},t.prototype.saveKey=t.prototype.saveDatabase,t.prototype.deleteDatabase=function(t,i){var o=this.app,n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(o,t,function(t){var e=t.id;0!==e?n.catalog.deleteAppKey(e,i):"function"==typeof i&&i({success:!0})}):this.catalog=new e(function(e){n.catalog=e,n.deleteDatabase(t,i)})},t.prototype.deleteKey=t.prototype.deleteDatabase,t.prototype.deleteDatabasePartitions=function(t){var e=this;this.getDatabaseList(function(i){i.forEach(function(i){i.startsWith(t)&&e.deleteDatabase(i)})})},t.prototype.getDatabaseList=function(t){var i=this.app,o=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKeys(i,function(e){for(var i=[],o=0;o<e.length;o++)i.push(e[o].key);"function"==typeof t?t(i):i.forEach(function(t){console.log(t)})}):this.catalog=new e(function(e){o.catalog=e,o.getDatabaseList(t)})},t.prototype.getKeyList=t.prototype.getDatabaseList,t.prototype.getCatalogSummary=function(t){this.app;var i=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAllKeys(function(e){for(var i,o,n,r,s,a=[],u=0;u<e.length;u++)i=e[u],n=i.app||"",r=i.key||"",s=i.val||"",o=2*n.length+2*r.length+s.length+1,a.push({app:i.app,key:i.key,size:o});"function"==typeof t?t(a):a.forEach(function(t){console.log(t)})}):this.catalog=new e(function(e){i.catalog=e,i.getCatalogSummary(t)})},e.prototype.initializeLokiCatalog=function(t){var e=indexedDB.open("LokiCatalog",1),i=this;e.onupgradeneeded=function(t){var e=t.target.result;if(e.objectStoreNames.contains("LokiAKV")&&e.deleteObjectStore("LokiAKV"),!e.objectStoreNames.contains("LokiAKV")){var i=e.createObjectStore("LokiAKV",{keyPath:"id",autoIncrement:!0});i.createIndex("app","app",{unique:!1}),i.createIndex("key","key",{unique:!1}),i.createIndex("appkey","appkey",{unique:!0})}},e.onsuccess=function(e){i.db=e.target.result,"function"==typeof t&&t(i)},e.onerror=function(t){throw t}},e.prototype.getAppKey=function(t,e,i){var o,n,r=this.db.transaction(["LokiAKV"],"readonly"),s=r.objectStore("LokiAKV"),a=s.index("appkey"),u=t+","+e,c=a.get(u);c.onsuccess=(o=i,function(t){var e=t.target.result;null!==e&&void 0!==e||(e={id:0,success:!1}),"function"==typeof o?o(e):console.log(e)}),c.onerror=(n=i,function(t){if("function"!=typeof n)throw t;n({id:0,success:!1})})},e.prototype.getAppKeyById=function(t,e,i){var o,n,r=this.db.transaction(["LokiAKV"],"readonly"),s=r.objectStore("LokiAKV"),a=s.get(t);a.onsuccess=(o=i,n=e,function(t){"function"==typeof n?n(t.target.result,o):console.log(t.target.result)})},e.prototype.setAppKey=function(t,e,i,o){var n,r=this.db.transaction(["LokiAKV"],"readwrite"),s=r.objectStore("LokiAKV"),a=s.index("appkey"),u=t+","+e,c=a.get(u);c.onsuccess=function(n){var r=n.target.result;null===r||void 0===r?r={app:t,key:e,appkey:t+","+e,val:i}:r.val=i;var a,u,l=s.put(r);l.onerror=(a=o,function(t){"function"==typeof a?a({success:!1}):(console.error("LokiCatalog.setAppKey (set) onerror"),console.error(c.error))}),l.onsuccess=(u=o,function(t){"function"==typeof u&&u({success:!0})})},c.onerror=(n=o,function(t){"function"==typeof n?n({success:!1}):(console.error("LokiCatalog.setAppKey (get) onerror"),console.error(c.error))})},e.prototype.deleteAppKey=function(t,e){var i,o,n=this.db.transaction(["LokiAKV"],"readwrite"),r=n.objectStore("LokiAKV"),s=r.delete(t);s.onsuccess=(i=e,function(t){"function"==typeof i&&i({success:!0})}),s.onerror=(o=e,function(t){"function"==typeof o?o({success:!1}):(console.error("LokiCatalog.deleteAppKey raised onerror"),console.error(s.error))})},e.prototype.getAppKeys=function(t,e){var i,o,n,r=this.db.transaction(["LokiAKV"],"readonly"),s=r.objectStore("LokiAKV"),a=s.index("app"),u=IDBKeyRange.only(t),c=a.openCursor(u);c.onsuccess=(i=[],o=e,function(t){var e=t.target.result;if(e){var n=e.value;i.push(n),e.continue()}else"function"==typeof o?o(i):console.log(i)}),c.onerror=(n=e,function(t){"function"==typeof n?n(null):(console.error("LokiCatalog.getAppKeys raised onerror"),console.error(t))})},e.prototype.getAllKeys=function(t){var e,i,o,n=this.db.transaction(["LokiAKV"],"readonly"),r=n.objectStore("LokiAKV"),s=r.openCursor();s.onsuccess=(e=[],i=t,function(t){var o=t.target.result;if(o){var n=o.value;e.push(n),o.continue()}else"function"==typeof i?i(e):console.log(e)}),s.onerror=(o=t,function(t){"function"==typeof o&&o(null)})},t}()})?o.apply(e,n):o)||(t.exports=r)},function(t,e){var i,o,n=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:r}catch(t){i=r}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(t){o=s}}();var u,c=[],l=!1,h=-1;function d(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&p())}function p(){if(!l){var t=a(d);l=!0;for(var e=c.length;e;){for(u=c,c=[];++h<e;)u&&u[h].run();h=-1,e=c.length}u=null,l=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function y(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new f(t,e)),1!==c.length||l||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=y,n.addListener=y,n.once=y,n.off=y,n.removeListener=y,n.removeAllListeners=y,n.emit=y,n.prependListener=y,n.prependOnceListener=y,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(e,i,o,n){return t.call(this,"mcs-request",e,i,o,n)||this}return n(e,t),e.prototype.buildResponseObject=function(t){return t},e.prototype.getResponsePayload=function(t){return t.data},e.prototype.getModuleName=function(){return"MCS"},e.prototype.isPersistentGetRequest=function(i){t.prototype.isPersistentGetRequest.call(this,i);var o=e.HEADER_RESOURCE_TYPE in i||i.headers[e.HEADER_RESOURCE_TYPE];if("collection"===o){if(this.$common.isEmpty(i.data))throw new Error("cannot proceed with empty payload");if(!("items"in i.data))throw new Error("items is not in the payload returned from MCS, probably not Sync Custom Code");if(!("uris"in i.data))throw new Error("url is not in the payload returned from MCS, probably not Sync Custom Code");if(!("etags"in i.data))throw new Error("etags is not in the payload returned from MCS, probably not Sync Custom Code")}else if("item"!==o)throw new Error("oracle-mobile-sync-resource-type is not in the headers returned from MCS, probably not Sync Custom Code");return!0},e.prototype.handleMcsGetCollectionPayload=function(t,i){for(var o=t.items,n=Date.now(),r=0;r<o.length;r++){var s=o[r];s[e.URI_KEY]=this.normalizeURI(t.uris[r]),s[e.ETAG_KEY]=t.etags[r];var a=s[e.URI_KEY],u=this.collectionFindOneByUri(i,a);u?(this.$common.extendOwn(u,s),i.update(u)):i.insert(s)}return i.removeWhere(function(t){return(t.meta.updated||t.meta.created)<n}),i.find()},e.prototype.handleMcsGetItemPayload=function(t,i,o){var n=this.collectionFindOneByUri(t,o);if(n){var r=i;return this.$common.extendOwn(n,r),t.update(n)}return(r=i)[e.URI_KEY]=o,t.insert(r)},e.prototype.handleGet=function(t){var i=this.$options.isPersistentUrl(t.url);if(!1===i)throw new Error("Persistence.handleMcsGet()-> URI was not configured for persistence:"+t.url);var o=this.$db.getCollectionByName(i.root);if(this.$common.isEmpty(i.params)){var n=o.find(),r={items:[],uris:[],etags:[]};for(var s in n){n[s].hasOwnProperty(e.URI_KEY)&&(r.uris.push(n[s][e.URI_KEY]),delete n[s][e.URI_KEY]),n[s].hasOwnProperty(e.ETAG_KEY)&&(r.etags.push(n[s][e.ETAG_KEY]),delete n[s][e.ETAG_KEY]);var a=this.$common.cleanObject(n[s]);r.items.push(a)}return r}var u=this.collectionFindOneByPersistentPath(o,i);return this.$common.cleanObject(u)},e.prototype.handleGetStore=function(t){var i=this.$options.isPersistentUrl(t.url);if(!1===i)throw new Error("Persistence.handleMcsGetStore()-> URI was not configured for persistence:"+t.url);var o=this.$db.getCollectionByName(i.root),n=t.data,r=e.HEADER_RESOURCE_TYPE in t||t.headers[e.HEADER_RESOURCE_TYPE];if("collection"===r)return this.handleMcsGetCollectionPayload(n,o);if("item"===r)return this.handleMcsGetItemPayload(o,n,i.path);throw r?(this.logger.error("unknown Oracle-Mobile-Sync-Resource-Type (%s)",r),new Error("unknown Oracle-Mobile-Sync-Resource-Type")):(this.logger.error("this is not MCS response, unable to handle the payload, no MCS header was specified: ",t),new Error("this is not MCS response, unable to handle the payload, no MCS header was specified"))},e.prototype.handlePost=function(t,i){var o=this.$options.isPersistentUrl(t.url);if(!1===o)throw new Error("Persistence.handleMcsPost()-> URI was not configured for persistence:"+t.url);var n=this.$db.getCollectionByName(o.root),r=t.data;if(!this.$common.isEmpty(o.params))throw new Error("you can add new objects only against the root REST resource endpoint");if(this.$common.isArray(r))throw new Error("the payload cannot be array");if(this.$common.isObject(r)&&!this.$common.isNull(r)&&!this.$common.isFunction(r)){if(t.data&&t.data[e.URI_KEY])return this.updatePayloadWithNewUri(n,t);var s=null;t&&t.headers&&t.headers[e.HEADER_LOCATION]&&(s=this.$common.stringStartsWith(t.headers[e.HEADER_LOCATION],"/")?t.headers[e.HEADER_LOCATION]:"/"+t.headers[e.HEADER_LOCATION]);var a=null;if(s&&(a=this.collectionFindOneByUri(n,s)),a?this.$common.extendOwn(a,t.data):(r[e.ETAG_KEY]='"0-1B2M2Y8AsgTpgAmY7PhCfg"',a=n.insert(r),this.markObjAsOfflineIfForced(a,i)),!s){var u=o.tokens.length>0&&/^\w+$/.test(o.tokens[0].name)?o.tokens[0].name:null,c=null;u&&(c=t.data.hasOwnProperty(u)?t.data[u]:this.$common.getUID()),s=null===c?o.root+"/"+this.$common.getUID():o.root+"/"+c}return a[e.URI_KEY]=s,n.update(a)}throw new Error("don't know what to do with the payload")},e.prototype.updatePayloadWithNewUri=function(t,i){var o=i.data[e.URI_KEY],n=this.collectionFindOneByUri(t,o);if(n)return this.$common.extendOwn(n,i.data),n[e.URI_KEY]=this.normalizeURI(i.headers[e.HEADER_LOCATION]),t.update(n);throw new Error("the payload was not found in collection:"+o)},e.prototype.handlePut=function(t,e){var i=this.$options.isPersistentUrl(t.url);if(!1===i)throw new Error("Persistence.handleMcsPut()-> URI was not configured for persistence:"+t.url);var o=this.$db.getCollectionByName(i.root),n=t.data;if(!this.$common.isEmpty(i.params)){if(this.$common.isArray(n))throw new Error("the payload cannot be array");if(this.$common.isObject(n)&&!this.$common.isNull(n)&&!this.$common.isFunction(n)){var r=this.collectionFindOneByPersistentPath(o,i);if(r)return this.$common.extendOwn(r,n),this.markObjAsOfflineIfForced(r,e),o.update(r)}}throw new Error("you can execute update operations only against existing items in the offline database!")},e.prototype.collectionFindOneByPersistentPath=function(t,i){var o=i.path+"$",n={};return n[e.URI_KEY]={$regex:new RegExp(o)},t.findOne(n)},e.prototype.collectionFindOneByUri=function(t,i){var o={};return o[e.URI_KEY]=i,t.findOne(o)},e.prototype.handleDelete=function(t){var e=this.$options.isPersistentUrl(t.url);if(!1===e)throw new Error("Persistence.handleMcsDelete()-> URI was not configured for persistence:"+t.url);var i=this.$db.getCollectionByName(e.root);if(!this.$common.isEmpty(e.params)){var o=this.collectionFindOneByPersistentPath(i,e);if(o)return i.remove(o);throw new Error("unable to find object with the given ID("+e.path+") in the database")}},e.prototype.postSuccessOperations=function(t){if("POST"===t.syncObj.method){var i=this.$common.clone(t),o=this.$options.parseURL(i.syncObj.url),n=this.$utils.isPersistUrl(o.path);if(!1===n)return this.logger.debug("sync post success operation exist"),t;var r=this.$utils.extractKeyValuesFromUrl2(n),s=this.$db.getCollectionByName(r.root),a=i.syncObj.data,u=i.response;if(this.$common.isArray(a))return this.logger.error("The payload cannot be array"),t;if(this.$common.isObject(a)&&!this.$common.isNull(a)&&!this.$common.isFunction(a)){if(u.data&&u.data[e.URI_KEY])return this.updatePayloadWithNewUri(s,u);var c=null;if(i.headers){var l=this.$utils.parseResponseHeaders(i.headers);if(l[e.HEADER_LOCATION]){var h=l[e.HEADER_LOCATION];c=this.normalizeURI(h)}}var d=a[e.URI_KEY],p=this.collectionFindOneByUri(s,d);if(p?this.$common.extendOwn(p,u.data):(a[e.ETAG_KEY]='"0-1B2M2Y8AsgTpgAmY7PhCfg"',p=s.insert(a)),!c){var f=n.uri.tokens.length>0&&/^\w+$/.test(n.uri.tokens[0].name)?n.uri.tokens[0].name:null,y=null;f&&(y=u.data.hasOwnProperty(f)?u.data[f]:this.$common.getUID()),c=null===y?n.root+"/"+this.$common.getUID():n.root+"/"+y}return p[e.URI_KEY]=c,s.update(p)}}return t},e.prototype.normalizeURI=function(t){return this.$common.stringStartsWith(t,"/")||this.$common.stringStartsWith(t,"http")?t:"/"+t},e.prototype.data=function(t){return new Promise(function(e){return e(function(t){var e=this.$options.isPersistentUrl(t);if(!e)throw new Error("Persistence.BaseModule.data() given URI not configured for persistence: "+t);return this.$db.getCollectionByName(e.root)}(t))})},e.prototype.router=function(t,e){var i=this;return void 0===e&&(e=!1),new Promise(function(o){if(!i.$common.isObject(t))throw console.error("Passed object is not defined request!",t),new Error("Passed object is not defined request!");if(!t.hasOwnProperty("method"))throw i.logger.error("request.method was not provided!",t),new Error("request.method was not provided!");var n=i.$common.clone(t);if(n.method=i.$utils._normalizeMethod(n.method),!i[n.method])throw i.logger.error("specified router is not implemented!"),new Error("specified router is not implemented!");o(i[n.method](n,e))})},e.prototype.get=function(t){var e=this;return new Promise(function(i){i(function(t){e.logger.info("get()"),e.isPersistentRequest(t);var i=e.$common.clone(t);return!i.hasOwnProperty("data")||e.$common.isEmpty(i.data)?e.$common.clone(e.handleGet(i)):(e.isPersistentGetRequest(t),e.$common.clone(e.handleGetStore(i)))}(t))})},e.URI_KEY="$mcs$mcsPersistenceURI",e.ETAG_KEY="$mcs$etag",e.HEADER_LOCATION="location",e.HEADER_RESOURCE_TYPE="oracle-mobile-sync-resource-type",e}(i(6).RequestHandler);e.McsRequestHandler=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){this.endpoint=t,this.uri=e}return t.prototype._getEndpoint=function(){return this.endpoint},t.prototype._getMcsId=function(){return this.uri?this.uri.substring(this.uri.lastIndexOf("/")+1,this.uri.length):null},t.prototype._getMcsURI=function(){return this.uri},t}();e.MobileResource=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),n=function(){function t(t,e){this.storageCollection=t,e&&(this.id=e.id,this.name=e.name,this.contentLength=e.contentLength,this.contentType=e.contentType,this._eTag=e.eTag,this.createdBy=e.createdBy,this.createdOn=e.createdOn,this.modifiedBy=e.modifiedBy,this.modifiedOn=e.modifiedOn)}return t.prototype.getPayload=function(){return this.contentType===o.ContentTypes.APPLICATION_JSON?JSON.parse(this._payload):this._payload},t.prototype.setPayload=function(t){this.contentType===o.ContentTypes.APPLICATION_JSON&&"object"==typeof t?this._payload=JSON.stringify(t):this._payload=t,this.contentLength=this._payload.length},t.prototype.getstorageCollection=function(){return this.storageCollection},t.prototype.getStorage=function(){return this.storageCollection.getStorage()},t.prototype.loadPayload=function(t,e){this.contentType=e,this.setPayload(t)},t.prototype.setDisplayName=function(t){this.name=t},t.prototype.getDisplayName=function(){return this.name},t.prototype.readPayload=function(t){var e=this;return this.getPayload()?Promise.resolve(this):this.storageCollection.loadObjectPayload(this.id,t).then(function(t){return e.contentType=t.headers[o.Headers.CONTENT_TYPE.toLowerCase()],e.name=decodeURI(t.headers[o.Headers.ORACLE_MOBILE_NAME.toLowerCase()]),e._eTag=t.headers[o.Headers.E_TAG.toLowerCase()],e.createdBy=t.headers[o.Headers.ORACLE_MOBILE_CREATED_BY.toLowerCase()],e.createdOn=t.headers[o.Headers.ORACLE_MOBILE_CREATED_ON.toLowerCase()],e.modifiedBy=t.headers[o.Headers.ORACLE_MOBILE_MODIFIED_BY.toLowerCase()],e.modifiedOn=t.headers[o.Headers.ORACLE_MOBILE_MODIFIED_ON.toLowerCase()],e.setPayload(t.data),e})},t}();e.StorageObject=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){return function(t){this.name=null,this.timestamp=(new Date).toISOString(),this.sessionID=null,this.properties={},this.name=t}}();e.AnalyticsEvent=o},,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),n=i(2),r=function(){function t(t,e,i){this._logHTTP=!1,this._queryRegex=/\?/,this._deviceState="undefined"!=typeof deviceState?deviceState.unrestricted:null,this._deviceStateChangedCallbacks=[],this.ANDROID_OS_NAME="",this.IOS_OS_NAME="",this._logHTTP=void 0!==t.logHTTP&&t.logHTTP,this._config=t,this._utils=e,this._deviceId=e.uuid(),this._logger=i}return t.prototype.initGPSLocation=function(){},t.prototype.getDeviceId=function(){return this._deviceId},t.prototype.setDeviceState=function(t){if(this._deviceState!==t){this._logger.info("Device state changing from "+this._deviceState+" to "+t),this._deviceState=t;for(var e=0,i=this._deviceStateChangedCallbacks;e<i.length;e++){(0,i[e])(this._deviceState)}}},t.prototype.getGPSLocation=function(){return{latitude:null,longitude:null}},t.prototype.getDeviceInformation=function(){return{model:"<unknown>",manufacturer:"<unknown>",osName:"<unknown>",osVersion:"<unknown>",osBuild:"<unknown>",carrier:"<unknown>"}},t.prototype.invokeService=function(t){var e=t.url;return this.isBrowser&&(e=e+(this._queryRegex.test(e)?"&":"?")+"_="+(new Date).getTime()),new Promise(function(i,r){var s=this,a=new XMLHttpRequest;for(var u in a.open(t.method,e),t.headers)t.headers.hasOwnProperty(u)&&a.setRequestHeader(u,t.headers[u]);if(this._setRequestHeaders(a,t),a.withCredentials=!t.hasOwnProperty("withCredentials")||"boolean"!=typeof t.withCredentials||t.withCredentials,a.responseType=t.responseType||o.XMLHttpRequestResponseTypes.JSON,a.onreadystatechange=function(){if(4===a.readyState){var e=""===a.responseType||"text"===a.responseType?a.responseText:a.response,o=a.responseHeaders?s._utils.normalizeHeaderKeys(a.responseHeaders):s._utils.parseHeaders(a.getAllResponseHeaders()),u=new n.NetworkResponse(a.status,e,o);if(s._logHTTP){var c={headers:o,body:e};s._logger.debug("Received "+t.method+" response from "+t.url,c)}a.status>=200&&a.status<=299?i(u):r(u)}},a.send(t.data),this._logHTTP){var c={headers:t.headers,body:t.data};this._logger.debug("Sent "+t.method+" request to "+t.url,c)}}.bind(this))},t.prototype._setRequestHeaders=function(t,e){t.setRequestHeader(o.Headers.ORACLE_MOBILE_CLIENT_SDK_INFO,this.getClientSDKInfoHeader(e.module))},t.prototype.getClientSDKInfoHeader=function(t){var e=this._getPlatform();return e+=" "+(this._config.mcsVersion||"Unknown"),e+=" ["+t+"]"},t}();e.Platform=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){return function(t,e){this.statusCode=0,this.storageObject=null,this.statusCode=t,this.storageObject=e}}();e.NetworkStorageObject=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(17),n=i(22),r=i(0),s=function(){function t(t,e,i,o,n,r,s){this.userIsolated=i,this.backend=o,this.utils=n,this.logger=r,this.platform=s,this.storage=o.storage,this.userId=n.validateConfiguration(e),this.id=n.validateConfiguration(t)}return t.prototype.getDescription=function(){return this.data?this.data.description:(this.logger.warn("Collection metadata was not loaded yet, please use StorageCollection.loadMetadata to load metadata."),null)},t.prototype.getUserIsolated=function(){return this.data?this.data.userIsolated:this.userIsolated},t.prototype.getStorage=function(){return this.storage},t.prototype.getUserId=function(){return this.userId},t.prototype.getData=function(){return this.data},t.prototype.toJSON=function(){return{id:this.id,description:this.getDescription(),userId:this.getUserId(),userIsolated:this.getUserIsolated(),data:this.getData()}},t.prototype.loadMetadata=function(){var t=this.backend.getHttpHeaders();return t.add(r.Headers.ACCEPT,r.ContentTypes.APPLICATION_JSON),this.platform.invokeService({headers:t,method:r.HttpMethods.GET,url:this.backend.getPlatformUrl("storage/collections/"+this.id),module:r.ModuleNames.STORAGE}).then(function(t){return this.data=t.data,this}.bind(this))},t.prototype.getObjects=function(t,e,i){var n=this.backend.getHttpHeaders();n.add(r.Headers.ACCEPT,r.ContentTypes.APPLICATION_JSON);var s="storage/collections/"+this.id+"/objects";return null!=t&&(s+=-1==s.indexOf("?")?"?":"&",s+="offset="+t),null!=e&&(s+=-1==s.indexOf("?")?"?":"&",s+="limit="+e),this.getUserIsolated()&&i?(s+=-1==s.indexOf("?")?"?":"&",s+="user=*"):this.getUserIsolated()&&this.getUserId()&&(s+=-1==s.indexOf("?")?"?":"&",s+="user="+this.getUserId()),this.platform.invokeService({headers:n,method:r.HttpMethods.GET,url:this.backend.getPlatformUrl(s),module:r.ModuleNames.STORAGE}).then(function(t){for(var e=[],i=t.data,n=0;n<i.items.length;n++)e[e.length]=new o.StorageObject(this,i.items[n]);return e}.bind(this))},t.prototype.getObject=function(t,e){var i=new o.StorageObject(this,this.backend);return i.id=t,i.readPayload(e).then(function(){return i})},t.prototype.loadObjectPayload=function(t,e){var i=this.backend.getHttpHeaders(),o="storage/collections/"+this.id+"/objects/"+t;return null!=this.userId&&this.getUserIsolated()&&(o+="?user="+this.userId),this.platform.invokeService({headers:i,method:r.HttpMethods.GET,url:this.backend.getPlatformUrl(o),responseType:e||r.XMLHttpRequestResponseTypes.JSON,module:r.ModuleNames.STORAGE})},t.prototype.postObject=function(t){return this._postOrPutStorageObject(t,!0)},t.prototype.putObject=function(t){return this._postOrPutStorageObject(t,!1)},t.prototype._postOrPutStorageObject=function(t,e){var i=this.backend.getHttpHeaders();i.add(r.Headers.ORACLE_MOBILE_NAME,encodeURI(t.getDisplayName())),i.add(r.Headers.CONTENT_TYPE,t.contentType);var s="storage/collections/"+this.id+"/objects";return e||(s+="/"+t.id,null!=t._eTag&&i.add(r.Headers.IF_MATCH,t._eTag)),this.getUserIsolated()&&this.getUserId()&&(s+="?user="+this.getUserId()),this.platform.invokeService({headers:i,method:e?r.HttpMethods.POST:r.HttpMethods.PUT,url:this.backend.getPlatformUrl(s),data:t._payload,module:r.ModuleNames.STORAGE}).then(function(t){var e=new o.StorageObject(this,t.data);return new n.NetworkStorageObject(t.statusCode,e)}.bind(this))},t.prototype.contains=function(t){var e=this.backend.getHttpHeaders(),i="storage/collections/"+this.id+"/objects/"+t;return this.getUserIsolated()&&this.getUserId()&&(i+="?user="+this.getUserId()),this.platform.invokeService({headers:e,method:r.HttpMethods.HEAD,url:this.backend.getPlatformUrl(i),module:r.ModuleNames.STORAGE})},t.prototype.deleteObject=function(t){var e=this.backend.getHttpHeaders();e.add(r.Headers.IF_MATCH,"*");var i="storage/collections/"+this.id+"/objects/"+t;return this.getUserIsolated()&&this.getUserId()&&(i+="?user="+this.getUserId()),this.platform.invokeService({headers:e,method:r.HttpMethods.DELETE,url:this.backend.getPlatformUrl(i),module:r.ModuleNames.STORAGE})},t}();e.StorageCollection=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),n=i(23),r=function(){function t(t,e,i){this.backend=t,this.utils=e,this.platform=i,this.logger=new o.Logger("Storage")}return t.prototype.getCollection=function(t,e,i,o){var r=new n.StorageCollection(t,e,i,this.backend,this.utils,this.logger,this.platform);return o?Promise.resolve(r):r.loadMetadata()},t}();e.Storage=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(3),n=function(){function t(t,e){this.endpoint=t,this.json=e,this._fetchFromService=!1,this._offset=-1,this._limit=-1,this._fetchAll=!1,this._withParams={},this._withHeaders=new o.Dictionary([])}return t.prototype.execute=function(){return this.endpoint._executeFetchObjects(this._withHeaders,this._withParams,this._fetchAll,this._offset,this._limit,this._fetchFromService)},t}();e.FetchCollectionBuilder=n},function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(16),s=i(10),a=function(t){function e(e,i){var o=t.call(this,e,i)||this;return o._type=s.SyncResourceType.item,o._objects=[],o}return n(e,t),e.prototype.initialize=function(t){for(var e in t)if(t.hasOwnProperty(e)){var i=t[e];this._objects.push(i)}return this},e.prototype.getLength=function(){return this._objects.length},e.prototype.getItem=function(t){return this._objects[t]},e.prototype.all=function(){return this._objects},e.prototype.forEach=function(t){this._objects.forEach(t)},e}(r.MobileResource);e.MobileObjectCollection=a},function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(5),s=i(0),a=i(3),u=function(t){function e(e,i,o,n,r,s,a){return t.call(this,e,i,o,!1,r,n,a,s)||this}return n(e,t),e.prototype.performRequest=function(t){var e=this.getHttpHeaders(new a.Dictionary([]));return this.platform.invokeService({url:t,headers:e,method:s.HttpMethods.DELETE,module:s.ModuleNames.SYNC})},e}(r.SyncProcessor);e.DeleteProcessor=u},function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(5),s=i(0),a=function(t){function e(e,i,o,n,r,s,a){return t.call(this,e,i,o,!1,r,n,a,s)||this}return n(e,t),e.prototype.performRequest=function(t,e,i){var o=this,n=this.getHttpHeaders(e);return this.platform.invokeService({url:t,headers:n,method:s.HttpMethods.PUT,data:i,module:s.ModuleNames.SYNC}).then(function(e){return{uri:o.getUri(e,t),data:e.data}})},e}(r.SyncProcessor);e.PutProcessor=a},function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(5),s=i(0),a=function(t){function e(e,i,o,n,r,s,a){return t.call(this,e,i,o,!1,r,n,a,s)||this}return n(e,t),e.prototype.performRequest=function(t,e,i){var o=this,n=this.getHttpHeaders(e);return this.platform.invokeService({url:t,headers:n,method:s.HttpMethods.POST,data:i,module:s.ModuleNames.SYNC}).then(function(e){return{uri:o.getUri(e,t),data:e.data}})},e}(r.SyncProcessor);e.PostProcessor=a},function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(5),s=i(0),a=function(t){function e(e,i,o,n,r,s,a){return t.call(this,e,i,o,!1,r,n,a,s)||this}return n(e,t),e.prototype.performRequest=function(t,e,i){var o=this.getHttpHeaders(e);return this.platform.invokeService({url:t,headers:o,method:s.HttpMethods.GET,module:s.ModuleNames.SYNC}).then(function(e){return{uri:this.getUri(e,t),data:e.data}}.bind(this))},e}(r.SyncProcessor);e.GetProcessor=a},function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(10),s=function(t){function e(e,i){var o=t.call(this,e,i)||this;return o._type=r.SyncResourceType.item,o}return n(e,t),e.prototype._assign=function(t){return void 0===t&&(t={}),t.__proto__=this,t},e.prototype.save=function(t){return this._getEndpoint()._save(this,t)},e.prototype.delete=function(){return this._getEndpoint()._delete(this)},e}(i(16).MobileResource);e.MobileObject=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(31),n=i(30),r=i(29),s=i(28),a=i(27),u=i(26),c=i(25),l=i(2),h=i(0),d=i(3),p=function(){function t(t,e,i,o,n,r,s,a){var u=this;this.backend=o,this.utils=n,this.platform=r,this.common=s,this.options=a,this.purge=function(){u.options.module.flush(u.backend.getCustomCodeUrl(u.apiName+"/"+u.endpointPath))},this.synchronization=t,this.apiName=e,this.endpointPath=i}return t.prototype.createObject=function(t){return void 0===t&&(t={}),new o.MobileObject(this,null)._assign(t)},t.prototype.fetchObject=function(t,e){var i=this.apiName;this.endpointPath&&this.endpointPath.length>0&&(i+="/"+this.endpointPath),t&&""!==t&&(i+="/"+t),i=this.backend.getCustomCodeUrl(i);var r=new n.GetProcessor(this.backend,this.apiName,this.endpointPath,this.platform,this.utils,this.common,this.options),s=new d.Dictionary([]);return s.add(h.Headers.ACCEPT,h.ContentTypes.APPLICATION_JSON),r.performRequest(i,s,e).then(function(t){{if(t.data&&""!==t.data){var e=t.data;return"string"==typeof e&&(e=""!==e?JSON.parse(e):null),new o.MobileObject(this,t.uri)._assign(e)}return Promise.reject(new l.NetworkResponse(404,"Object not found in cache."))}}.bind(this))},t.prototype._save=function(t,e){var i=this,n=!t._getMcsURI(),a=n?this.backend.getCustomCodeUrl(this.apiName+"/"+this.endpointPath):this._getMcsURI(t),u=n?new r.PostProcessor(this.backend,this.apiName,this.endpointPath,this.platform,this.utils,this.common,this.options):new s.PutProcessor(this.backend,this.apiName,this.endpointPath,this.platform,this.utils,this.common,this.options),c=JSON.stringify(t),l=new d.Dictionary([]);return l.add(h.Headers.ACCEPT,h.ContentTypes.APPLICATION_JSON),l.add(h.Headers.CONTENT_TYPE,h.ContentTypes.APPLICATION_JSON),u.performRequest(a,l,c).then(function(e){var n=e.data;return"string"==typeof n&&(n=""!==n?JSON.parse(n):null),i._updateMobileObject(t,n),t.__proto__=new o.MobileObject(i,e.uri),t})},t.prototype._delete=function(t){var e=this,i=new a.DeleteProcessor(this.backend,this.apiName,this.endpointPath,this.platform,this.utils,this.common,this.options),o=this._getMcsURI(t);return i.performRequest(o).then(function(i){return e._updateMobileObject(t._syncResource),t._syncResource=null,i})},t.prototype._getMcsURI=function(t){var e=t._getMcsURI();return e.startsWith("http")?e:this.backend._baseUrl+e},t.prototype._updateMobileObject=function(t,e){for(var i in void 0===e&&(e={}),t)t.hasOwnProperty(i)&&delete t[i];for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},t.prototype._executeFetchObjects=function(t,e,i,n,r,s){var a=this,c=this.backend.getHttpHeaders(t);c.add(h.Headers.ORACLE_MOBILE_SYNC_AGENT,"true");var l={method:h.HttpMethods.GET,url:this.backend.getCustomCodeUrl(this.apiName+"/"+this.endpointPath),headers:c,module:h.ModuleNames.SYNC};return this.platform.invokeService(l).then(function(t){var e=t.data;"string"==typeof e&&(e=""!==e?JSON.parse(e):null);var i=[];for(var n in e.items)if(e.items.hasOwnProperty(n)){var r=e.items[n],s="/"+e.uris[n];i.push(new o.MobileObject(a,s)._assign(r))}return new u.MobileObjectCollection(a,null).initialize(i)}.bind(this))},t.prototype.fetchObjects=function(){return new c.FetchCollectionBuilder(this)},t}();e.MobileEndpoint=p},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(32),n=i(1),r=function(){function t(t,e,i,o,r,s){this.utils=e,this.platform=i,this.common=o,this.options=r,this.process=s,this._endpoints={},this.logger=new n.Logger("Synchronization"),this.backend=t,r._originalIsOnline||(r._originalIsOnline=r.isOnline.bind(r));var a=!1;r.isOnline=function(){return!1===a?r._originalIsOnline():!a},this.setOfflineMode=function(t){a="boolean"!=typeof t||t}}return t.prototype.isOnline=function(){return this.options.isOnline()},t.prototype.purge=function(){for(var t in this._endpoints)if(this._endpoints.hasOwnProperty(t)){var e=this._endpoints[t];for(var i in e)e.hasOwnProperty(i)&&e[i].purge()}},t.prototype.openEndpoint=function(t,e){return this._endpoints[t]=this._endpoints[t]||{},this._endpoints[t][e]=this._endpoints[t][e]||new o.MobileEndpoint(this,t,e,this.backend,this.utils,this.platform,this.common,this.options),this._endpoints[t][e]},t.prototype._run=function(t){return this.process.run(t)},t.prototype._runWithoutReadInBackground=function(t){return this.process.runWithoutReadInBackground(t)},t}();e.Synchronization=r},function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(4),s=i(1),a=i(2),u=i(7),c=i(0),l=i(3),h=function(t){function e(e,i,o,n,r,a){var u=t.call(this,o,r,a)||this;return u.oAuthTokenEndPoint=e,u.config=i,u.logger=new s.Logger("OAuthAuthorization"),u._clientId=r.validateConfiguration(i.clientId),u._clientSecret=r.validateConfiguration(i.clientSecret),u._tenantName=r.validateConfiguration(n),u}return n(e,t),e.prototype.getAuthorizedUserName=function(){return this._authorizedUserName},e.prototype.getClientId=function(){return this._clientId},e.prototype.getTenantName=function(){return this._tenantName},e.prototype.getClientSecret=function(){return this._clientSecret},e.prototype.authenticate=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var o=t[0],n=t[1];if(this.logout(),!o||!n)return this.logger.error("Wrong username or password parameter"),Promise.reject(new a.NetworkResponse(400,"Bad Request"));var r="Basic "+this.utils.encodeBase64(this._clientId+":"+this._clientSecret),s=this.config.scope||this.backend._baseUrl+"urn:opc:resource:consumer::all",u=e.urlEncodeComponent(o,n,s),h=new l.Dictionary([]);return h.add(c.Headers.CONTENT_TYPE,c.ContentTypes.X_WWW_FORM_FORM_URLENCODED),h.add(c.Headers.AUTHORIZATION,r),void 0!==this._tenantName&&h.add(c.Headers.X_RESOURCE_IDENTITY_DOMAIN_NAME,this._tenantName),this.platform.invokeService({headers:h,url:this.getOAuthTokenUrl(),method:c.HttpMethods.POST,data:u,withCredentials:!1,module:c.ModuleNames.AUTHORIZATION}).then(function(t){return this._authenticateSuccess(t,t.data.access_token),this._authorizedUserName=o,t}.bind(this)).catch(function(t){return this._authenticateError(t),Promise.reject(t)}.bind(this))},e.prototype.authenticateAnonymous=function(){var t=new l.Dictionary([]);t.add(c.Headers.CONTENT_TYPE,c.ContentTypes.X_WWW_FORM_FORM_URLENCODED),void 0!==this._tenantName&&t.add(c.Headers.X_USER_IDENTITY_DOMAIN_NAME,this._tenantName);var e=this.config.scope||this.backend._baseUrl+"urn:opc:resource:consumer::all",i="grant_type=client_credentials&scope="+encodeURIComponent(e);return this._authenticateAnonymousInvoke(t,this.getOAuthTokenUrl(),c.HttpMethods.POST,!1,i).then(function(t){return this._tokenExpiredTime=Date.now()+1e3*t.data.expires_in,t}.bind(this))},e.prototype._getAnonymousAuthorizationHeaders=function(t){return t.add(c.Headers.AUTHORIZATION,"Basic "+this.utils.encodeBase64(this.getClientId()+":"+this.getClientSecret())),t},e.prototype.isTokenValid=function(){return!(!this.getAccessToken()&&!this._getAnonymousAccessToken())&&(this.logger.debug("Token is not null or empty"),Date.now()>=this._tokenExpiredTime?(this.logger.info("Token has expired"),!1):(this.logger.debug("Token is still valid"),!0))},e.prototype.logout=function(){this._clearState()},e.prototype.refreshToken=function(){var t=this.isTokenValid();return t&&!this.getAccessToken()&&this._getIsAnonymous()?Promise.resolve(new a.NetworkResponse(200,this._getAnonymousAccessToken())):!t||this._getAnonymousAccessToken()||this._getIsAnonymous()?(this.logger.error("Token has expired or user has not been authenticate with the service."),Promise.resolve(new a.NetworkResponse(401,"Please use the authenticate with username/password combination or authenticateAnonymous function before using refreshToken."))):Promise.resolve(new a.NetworkResponse(200,this._getAnonymousAccessToken()))},e.prototype._anonymousTokenResponseConverter=function(t){return new r.AuthenticationResponse(t,t.data.access_token)},e.prototype._clearState=function(){t.prototype._clearState.call(this),this._authorizedUserName=null,this._tokenExpiredTime=1e3*Date.now()},e.prototype._getHttpHeaders=function(t){return null!==this.getAccessToken()&&"string"==typeof this.getAccessToken()&&t.add(c.Headers.AUTHORIZATION,"Bearer "+this.getAccessToken()),t},e.prototype._getAnonymousHttpHeaders=function(t){return this._getAnonymousAccessToken()&&"string"==typeof this._getAnonymousAccessToken()&&t.add(c.Headers.AUTHORIZATION,"Bearer "+this._getAnonymousAccessToken()),t},e.urlEncodeComponent=function(t,e,i){return"grant_type=password&username="+(t.indexOf("@")>-1?encodeURIComponent(t).replace(/%20/g,"+"):encodeURIComponent(t).replace(/%5B/g,"[").replace(/%5D/g,"]"))+"&password="+(e.indexOf("&")>-1?encodeURIComponent(e).replace(/%20/g,"+"):encodeURIComponent(e).replace(/%5B/g,"[").replace(/%5D/g,"]"))+"&scope="+encodeURIComponent(i)},e.prototype.getOAuthTokenUrl=function(){var t=this.utils.validateConfiguration(this.oAuthTokenEndPoint);return this.utils.strEndsWith(t,"/oauth2/v1/token")||(t+="/oauth2/v1/token"),t},e}(u.MCSAuthorization);e.OAuthAuthorization=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t){this._id=t.id,this._userName=t.username,this._firstName=t._firstName,this._lastName=t._lastName,this._email=t.email}return t.prototype.getId=function(){return this._id},t.prototype.getFirstName=function(){return this._firstName},t.prototype.getLastName=function(){return this._lastName},t.prototype.getEmail=function(){return this._email},t}();e.User=o},function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(4),s=i(1),a=i(2),u=i(7),c=i(0),l=i(3),h=function(t){function e(e,i,o,n){var r=t.call(this,i,o,n)||this;return r._logger=new s.Logger("BasicAuthorization"),r._backendId=o.validateConfiguration(e.mobileBackendId),r._anonymousToken=o.validateConfiguration(e.anonymousKey),r}return n(e,t),e.prototype.getAuthorizedUserName=function(){return this._authorizedUserName},e.prototype.authenticate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],o=t[1];if(this.logout(),!i||!o)return this._logger.error("Wrong username or password parameter"),Promise.reject(new a.NetworkResponse(400,"Bad Request"));var n="Basic "+this.utils.encodeBase64(i+":"+o),r=new l.Dictionary([]);return r.add(c.Headers.AUTHORIZATION,n),r.add(c.Headers.ORACLE_MOBILE_BACKEND_ID,this._backendId),this.platform.invokeService({headers:r,url:this.backend.getPlatformUrl("users/login"),method:c.HttpMethods.GET,module:c.ModuleNames.AUTHORIZATION}).then(function(t){return this._authenticateSuccess(t,n),this._authorizedUserName=i,t}.bind(this)).catch(function(t){return this._authenticateError(t),Promise.reject(t)}.bind(this))},e.prototype.authenticateAnonymous=function(){return this._authenticateAnonymousInvoke(new l.Dictionary([]),this.backend.getPlatformUrl("users/login"),c.HttpMethods.GET)},e.prototype._getAnonymousAuthorizationHeaders=function(t){return t.add(c.Headers.AUTHORIZATION,"Basic "+this._anonymousToken),t.add(c.Headers.ORACLE_MOBILE_BACKEND_ID,this._backendId),t},e.prototype.isTokenValid=function(){return null!==this.getAccessToken()&&"string"==typeof this.getAccessToken()?(this._logger.info("Authorization token is not null or empty"),!0):null==this.getAccessToken()&&"string"!=typeof this.getAccessToken()?(this._logger.info("Authorization token is null and/or empty"),!1):void 0},e.prototype.refreshToken=function(){return this._getIsAuthorized()||this.isTokenValid()?this._getIsAuthorized()&&this.isTokenValid()?(this._logger.debug("Authenticated token is valid, you do not need to refresh."),Promise.resolve(new a.NetworkResponse(200,this.getAccessToken()))):void 0:Promise.reject(new a.NetworkResponse(401,"Please use the authenticate with username/password combination or authenticateAnonymous function before using refreshToken."))},e.prototype.logout=function(){this._clearState()},e.prototype._anonymousTokenResponseConverter=function(t){return new r.AuthenticationResponse(t,"Basic "+this._anonymousToken)},e.prototype._getHttpHeaders=function(t){return null!==this.getAccessToken()&&"string"==typeof this.getAccessToken()&&t.add(c.Headers.AUTHORIZATION,this.getAccessToken()),t.add(c.Headers.ORACLE_MOBILE_BACKEND_ID,this._backendId),t},e.prototype._getAnonymousHttpHeaders=function(t){return this._getAnonymousAccessToken()&&"string"==typeof this._getAnonymousAccessToken()&&t.add(c.Headers.AUTHORIZATION,this._getAnonymousAccessToken()),t.add(c.Headers.ORACLE_MOBILE_BACKEND_ID,this._backendId),t},e.prototype._clearState=function(){t.prototype._clearState.call(this),this._authorizedUserName=null},e}(u.MCSAuthorization);e.BasicAuthorization=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(18),n=i(1),r=i(2),s=i(0),a=function(){function t(t,e,i,o){this.config=t,this.backend=e,this.platform=i,this.utils=o,this.events=[],this.logger=new n.Logger("Analytics")}return t.prototype.getSessionId=function(){return this.sessionId},t.prototype.startSession=function(){this.sessionId||(this._locationEnabled()&&this.platform.initGPSLocation(),this.sessionId=this.utils.uuid(),this.logNamedEvent("sessionStart").type="system")},t.prototype.endSession=function(){return this.sessionId?(this.logNamedEvent("sessionEnd").type="system",this.logger.debug("Deactivate a default session"),this.flush().then(function(t){return this.sessionId=void 0,t}.bind(this))):Promise.reject(new r.NetworkResponse(500,"Session ID is null"))},t.prototype.logNamedEvent=function(t){var e=new o.AnalyticsEvent(t);return this.logEvent(e),e},t.prototype.logEvent=function(t){return 0===this.events.length&&(this.events[0]=this._createContextEvent()),this.startSession(),this.events[this.events.length]=t,t.sessionID=this.sessionId,t},t.prototype.flush=function(){for(var t=0;t<this.events.length;t++){if(this._locationEnabled()&&"context"==this.events[t].name){var e=this.platform.getGPSLocation();null!=e&&null!=e.latitude&&(this.events[t].properties.latitude=e.latitude),null!=e&&null!=e.longitude&&(this.events[t].properties.longitude=e.longitude)}}var i=JSON.stringify(this.events),o=this.backend.getHttpHeaders();return o.add(s.Headers.CONTENT_TYPE,s.ContentTypes.APPLICATION_JSON),this.platform.invokeService({headers:o,method:s.HttpMethods.POST,url:this.backend.getPlatformUrl("analytics/events"),data:i,module:s.ModuleNames.MCS_ANALYTICS}).then(function(t){return this.logger.debug("Analytics events flushed."),this.events=[],t}.bind(this),function(t){return this.logger.error("Failed to flush analytics events."),Promise.reject(t)}.bind(this))},t.prototype._createContextEvent=function(){var t=new o.AnalyticsEvent("context");t.type="system",t.sessionID=this.sessionId,t.properties.timezone=""+60*(new Date).getTimezoneOffset();var e=this.platform.getDeviceInformation();return t.properties.model=e.model,t.properties.manufacturer=e.manufacturer,t.properties.osName=e.osName,t.properties.osVersion=e.osVersion,t.properties.osBuild=e.osBuild,t.properties.carrier=e.carrier,t},t.prototype._getEvents=function(){return this.events},t.prototype._locationEnabled=function(){return void 0===this.config.disableAnalyticsLocation||this.config.disableAnalyticsLocation},t}();e.Analytics=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(2),n=i(0),r=function(){function t(t,e){this.backend=t,this.platform=e}return t.prototype.invokeCustomCodeJSONRequest=function(e,i,r){if(i in t.httpMethods){if(i===t.httpMethods.DELETE&&r)return Promise.reject(new o.NetworkResponse(500,"DELETE method content body"));var s=this.backend.getHttpHeaders();s.add(n.Headers.CONTENT_TYPE,n.ContentTypes.APPLICATION_JSON);var a=r?JSON.stringify(r):null;return this.platform.invokeService({method:i,headers:s,url:this.backend.getCustomCodeUrl(e),data:a,module:n.ModuleNames.CUSTOM_CODE})}return Promise.reject(new o.NetworkResponse(501,"Method Not Implemented"))},t.httpMethods={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE",PATCH:"PATCH"},t}();e.CustomCode=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),n=i(3),r=i(0),s=function(){function t(t,e){this.platform=t,this.logger=new o.Logger("Diagnostics"),this._sessionId=e.uuid()}return t.prototype._getHttpHeaders=function(t){return void 0===t&&(t=new n.Dictionary([])),t.add(r.Headers.ORACLE_MOBILE_DIAGNOSTIC_SESSION_ID,this.getSessionId()),t.add(r.Headers.ORACLE_MOBILE_DEVICE_ID,this.platform.getDeviceId()),t.add(r.Headers.ORACLE_MOBILE_CLIENT_REQUEST_TIME,(new Date).toISOString()),t},t.prototype.getSessionId=function(){return this._sessionId},t}();e.Diagnostics=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),n=i(39),r=i(38),s=i(37),a=i(36),u=i(34),c=i(33),l=i(24),h=i(0),d=i(3),p=function(){function t(t,e,i,a){this.config=t,this.platform=e,this.utils=i,this.syncExpress=a,this.PLATFORM_PATH="mobile/platform",this.CUSTOM_CODE_PATH="mobile/custom",this._authenticationType=null,this._logger=new o.Logger("MobileBackend"),this.name=null,this.authorization=null,this.diagnostics=null,this.customCode=null,this.analytics=null,this.storage=null,this.synchronization=null,this.appConfig={},this._mbeConfig=t.mobileBackend,this.name=this._mbeConfig.name,this.diagnostics=new n.Diagnostics(e,i),this.customCode=new r.CustomCode(this,e),this.analytics=new s.Analytics(t,this,e,i),this.storage=new l.Storage(this,i,e),this._baseUrl=i.validateConfiguration(this._mbeConfig.baseUrl),this._authenticationTypes=Object.assign({},h.AuthenticationTypes,{facebook:void 0,token:void 0}),console.log("constructor",JSON.stringify(this._authenticationTypes)),a&&(this.synchronization=new c.Synchronization(this,i,e,a.common,a.options,a.process)),this._mbeConfig.authentication.type&&this.setAuthenticationType(this._mbeConfig.authentication.type)}return t.prototype.getPlatformUrl=function(t){var e=this._baseUrl;return this._authenticationType===h.AuthenticationTypes.oauth&&this.utils.strEndsWith(this._baseUrl,"1")&&(e=e.substring(0,e.length-4)+"7777"),e=this.utils.validateConfiguration(e)+"/"+this.PLATFORM_PATH,this.utils.strEndsWith(e,"/")||(e+="/"),e+t},t.prototype.getCustomCodeUrl=function(t){return this.utils.validateConfiguration(this._baseUrl)+this._getCustomCodeUri(t)},t.prototype.getHttpHeaders=function(t){void 0===t&&(t=new d.Dictionary([]));var e=this.authorization,i=this.diagnostics._getHttpHeaders(t);return e&&(i=e._getIsAuthorized()&&e._getIsAnonymous()?e._getAnonymousHttpHeaders(i):e._getHttpHeaders(i)),i},t.prototype.getAuthenticationType=function(){return this._authenticationType},t.prototype.setAuthenticationType=function(t){var e=this.utils.validateConfiguration(t);if(this.authorization=null,!this._authenticationTypes[e])throw Error("Wrong Authentication type: "+t+", please use one of: \n"+this._getAuthenticationTypesMessage(this._authenticationTypes));if(!this._mbeConfig.authentication[e])throw Error("No Authentication Type called "+t+" is defined in configuration \ncheck configuration in authorization object for the following objects:\n"+this._getAuthenticationTypesMessage(this._authenticationTypes));if(this.authorization&&this.authorization._getIsAuthorized()&&this.authorization.logout(),e===h.AuthenticationTypes.basic)this.authorization=new a.BasicAuthorization(this._mbeConfig.authentication.basic,this,this.utils,this.platform),this._logger.info("Your Authentication type: "+e),this._authenticationType=e;else if(e===h.AuthenticationTypes.oauth){var i=this._mbeConfig;this.authorization=new u.OAuthAuthorization(this.config.oAuthTokenEndPoint,this._mbeConfig.authentication.oauth,this,i.tenantId,this.utils,this.platform),this._logger.info("Your Authentication type: "+e),this._authenticationType=e}return this.authorization},t.prototype.loadAppConfig=function(){var t=this.getHttpHeaders();t.add(h.Headers.CONTENT_TYPE,h.ContentTypes.APPLICATION_JSON);var e=this.authorization;return e._getIsAuthorized()||(t=e._getAnonymousAuthorizationHeaders(t)),this.platform.invokeService({headers:t,method:h.HttpMethods.GET,url:this.getPlatformUrl("appconfig/client"),module:h.ModuleNames.APP_CONFIG}).catch(function(t){return this.logger.error("App config download failed! with status code: "+t.statusCode),Promise.reject(t)}.bind(this))},t.prototype._getCustomCodeUri=function(t){var e="/"+this.CUSTOM_CODE_PATH,i=t;return this.utils.strEndsWith(i,"/")&&(i=i.slice(0,-1)),e+"/"+i},t.prototype._getAuthenticationTypesMessage=function(t){var e=this;return Object.keys(this._authenticationTypes).filter(function(t){return!!e._authenticationTypes[t]}).map(function(t){return e._authenticationTypes[t]}).join("\n")},t}();e.Backend=p},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.POLICIES_MAP={fetchPolicy:{persistencePropertyName:"fetchPolicy",FETCH_FROM_CACHE_SCHEDULE_REFRESH:"FETCH_FROM_CACHE_SCHEDULE_REFRESH",FETCH_FROM_SERVICE_IF_ONLINE:"FETCH_FROM_SERVICE_IF_ONLINE",FETCH_FROM_CACHE:"FETCH_FROM_CACHE",FETCH_FROM_SERVICE:"FETCH_FROM_SERVICE",FETCH_FROM_SERVICE_ON_CACHE_MISS:"FETCH_FROM_SERVICE_ON_CACHE_MISS",FETCH_FROM_SERVICE_ON_CACHE_MISS_OR_EXPIRY:"FETCH_FROM_SERVICE_ON_CACHE_MISS_OR_EXPIRY",FETCH_WITH_REFRESH:"FETCH_WITH_REFRESH"},evictionPolicy:{persistencePropertyName:"evictionPolicy",EVICT_ON_EXPIRY_AT_STARTUP:"EVICT_ON_EXPIRY_AT_STARTUP",MANUAL_EVICTION:"MANUAL_EVICTION"},expirationPolicy:{persistencePropertyName:"expirationPolicy",EXPIRE_ON_RESTART:"EXPIRE_ON_RESTART",EXPIRE_AFTER:"EXPIRE_AFTER",NEVER_EXPIRE:"NEVER_EXPIRE"},updatePolicy:{persistencePropertyName:"updatePolicy",QUEUE_IF_OFFLINE:"QUEUE_IF_OFFLINE",UPDATE_IF_ONLINE:"UPDATE_IF_ONLINE"},refreshPolicy:{persistencePropertyName:"refreshPolicy",PeriodicallyRefreshExpiredResource:""},conflictResolutionPolicy:{persistencePropertyName:"conflictResolutionPolicy",SERVER_WINS:"SERVER_WINS",PRESERVE_CONFLICT:"PRESERVE_CONFLICT",CLIENT_WINS:"CLIENT_WINS"},noCache:{persistencePropertyName:"noCache",false:!1,true:!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){}return t.prototype.removeSpace=function(t){return t.replace(/ /g,"")},t.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},t.prototype.validateConfiguration=function(t){var e=t;return/\s/.test(e)&&e&&(e=this.removeSpace(t)),e},t.prototype.encodeBase64=function(e){var i,o,n,r,s,a="",u="",c="",l=0;do{n=(i=e.charCodeAt(l++))>>2,r=(3&i)<<4|(o=e.charCodeAt(l++))>>4,s=(15&o)<<2|(u=e.charCodeAt(l++))>>6,c=63&u,isNaN(o)?s=c=64:isNaN(u)&&(c=64),a=a+t.KEY_STR.charAt(n)+t.KEY_STR.charAt(r)+t.KEY_STR.charAt(s)+t.KEY_STR.charAt(c),i=o=u="",n=r=s=c=""}while(l<e.length);return a},t.prototype.decodeBase64=function(e){var i,o,n,r,s,a,u="",c=0;if(/[^A-Za-z0-9\+\/\=]/g.exec(e))return null;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{i=t.KEY_STR.indexOf(e.charAt(c++))<<2|(r=t.KEY_STR.indexOf(e.charAt(c++)))>>4,o=(15&r)<<4|(s=t.KEY_STR.indexOf(e.charAt(c++)))>>2,n=(3&s)<<6|(a=t.KEY_STR.indexOf(e.charAt(c++))),u+=String.fromCharCode(i),64!=s&&(u+=String.fromCharCode(o)),64!=a&&(u+=String.fromCharCode(n))}while(c<e.length);return u},t.prototype.clearNonPrintableCharacters=function(e){return e.replace(t.SPECIAL_CHAR_RGX,"")},t.prototype.hasValue=function(t,e,i){return t.hasOwnProperty(e)&&t[e]===i},t.prototype.isEquivalentURL=function(t,e){return 0===t.indexOf("https")&&0===e.indexOf("https")?(t=443===this.getPort(t)?t.replace(":443",""):t,e=443===this.getPort(e)?e.replace(":443",""):e):-1===t.indexOf("https")&&-1===e.indexOf("https")&&(t=80===this.getPort(t)?t.replace(":80",""):t,e=80===this.getPort(e)?e.replace(":80",""):e),0===t.indexOf(e)},t.prototype.getPort=function(t){var e=t.indexOf(":",7),i=t.indexOf("/",e);e>0&&-1==i&&(i=t.length);var o=t.substr(e+1,i-e-1);return o&&!isNaN(1*o)?1*o:-1},t.prototype.parseHeaders=function(t){var e={};if(!t)return e;for(var i=t.split("\r\n"),o=0,n=i.length;o<n;o++){var r=i[o],s=r.indexOf(": ");s>0&&(e[r.substring(0,s).toLowerCase()]=r.substring(s+2))}return e},t.prototype.normalizeHeaderKeys=function(t){var e={};if(this.isArray(t))for(var i=t,o=0;o<i.length;o++)e[i[o].name.toLowerCase()]=i[o].value;else for(var n in t)t.hasOwnProperty(n)&&(e[n.toLowerCase()]=t[n]);return e},t.prototype.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.prototype.isCordova=function(){return void 0!==window.cordova},t.prototype.strEndsWith=function(t,e){return t.endsWith(e)},t.prototype.hashCode=function(t){return t.split("").reduce(function(t,e){return(t=(t<<5)-t+e.charCodeAt(0))&t},0)},t.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t.SPECIAL_CHAR_RGX=/[\0-\x1F\x7F-\x9F\xAD\u0378\u0379\u037F-\u0383\u038B\u038D\u03A2\u0528-\u0530\u0557\u0558\u0560\u0588\u058B-\u058E\u0590\u05C8-\u05CF\u05EB-\u05EF\u05F5-\u0605\u061C\u061D\u06DD\u070E\u070F\u074B\u074C\u07B2-\u07BF\u07FB-\u07FF\u082E\u082F\u083F\u085C\u085D\u085F-\u089F\u08A1\u08AD-\u08E3\u08FF\u0978\u0980\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09FC-\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A76-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF2-\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B55\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B78-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BFB-\u0C00\u0C04\u0C0D\u0C11\u0C29\u0C34\u0C3A-\u0C3C\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5A-\u0C5F\u0C64\u0C65\u0C70-\u0C77\u0C80\u0C81\u0C84\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDD\u0CDF\u0CE4\u0CE5\u0CF0\u0CF3-\u0D01\u0D04\u0D0D\u0D11\u0D3B\u0D3C\u0D45\u0D49\u0D4F-\u0D56\u0D58-\u0D5F\u0D64\u0D65\u0D76-\u0D78\u0D80\u0D81\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DF1\u0DF5-\u0E00\u0E3B-\u0E3E\u0E5C-\u0E80\u0E83\u0E85\u0E86\u0E89\u0E8B\u0E8C\u0E8E-\u0E93\u0E98\u0EA0\u0EA4\u0EA6\u0EA8\u0EA9\u0EAC\u0EBA\u0EBE\u0EBF\u0EC5\u0EC7\u0ECE\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F48\u0F6D-\u0F70\u0F98\u0FBD\u0FCD\u0FDB-\u0FFF\u10C6\u10C8-\u10CC\u10CE\u10CF\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u137D-\u137F\u139A-\u139F\u13F5-\u13FF\u169D-\u169F\u16F1-\u16FF\u170D\u1715-\u171F\u1737-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17DE\u17DF\u17EA-\u17EF\u17FA-\u17FF\u180F\u181A-\u181F\u1878-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191D-\u191F\u192C-\u192F\u193C-\u193F\u1941-\u1943\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DB-\u19DD\u1A1C\u1A1D\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1A9F\u1AAE-\u1AFF\u1B4C-\u1B4F\u1B7D-\u1B7F\u1BF4-\u1BFB\u1C38-\u1C3A\u1C4A-\u1C4C\u1C80-\u1CBF\u1CC8-\u1CCF\u1CF7-\u1CFF\u1DE7-\u1DFB\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FC5\u1FD4\u1FD5\u1FDC\u1FF0\u1FF1\u1FF5\u1FFF\u200B-\u200F\u202A-\u202E\u2060-\u206F\u2072\u2073\u208F\u209D-\u209F\u20BB-\u20CF\u20F1-\u20FF\u218A-\u218F\u23F4-\u23FF\u2427-\u243F\u244B-\u245F\u2700\u2B4D-\u2B4F\u2B5A-\u2BFF\u2C2F\u2C5F\u2CF4-\u2CF8\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D71-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E3C-\u2E7F\u2E9A\u2EF4-\u2EFF\u2FD6-\u2FEF\u2FFC-\u2FFF\u3040\u3097\u3098\u3100-\u3104\u312E-\u3130\u318F\u31BB-\u31BF\u31E4-\u31EF\u321F\u32FF\u4DB6-\u4DBF\u9FCD-\u9FFF\uA48D-\uA48F\uA4C7-\uA4CF\uA62C-\uA63F\uA698-\uA69E\uA6F8-\uA6FF\uA78F\uA794-\uA79F\uA7AB-\uA7F7\uA82C-\uA82F\uA83A-\uA83F\uA878-\uA87F\uA8C5-\uA8CD\uA8DA-\uA8DF\uA8FC-\uA8FF\uA954-\uA95E\uA97D-\uA97F\uA9CE\uA9DA-\uA9DD\uA9E0-\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A\uAA5B\uAA7C-\uAA7F\uAAC3-\uAADA\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F-\uABBF\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uF8FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBC2-\uFBD2\uFD40-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFE\uFDFF\uFE1A-\uFE1F\uFE27-\uFE2F\uFE53\uFE67\uFE6C-\uFE6F\uFE75\uFEFD-\uFF00\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFDF\uFFE7\uFFEF-\uFFFB\uFFFE\uFFFF]/g,t}();e.Utils=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(42),n=i(1),r=i(18),s=i(17),a=i(41),u=i(0),c=function(){function t(t,e,i){void 0===i&&(i=null),this.cxa=t,this._global=e,this._logger=new n.Logger("MCS"),this._utils=new o.Utils,this.LOG_LEVEL=n.Logger.LOG_LEVEL,this.AUTHENTICATION_TYPES=u.AuthenticationTypes,this.RESPONSE_TYPES=u.XMLHttpRequestResponseTypes,this.HTTP_METHODS=u.HttpMethods,this.NOTIFICATION_PROVIDERS=u.NotificationProviders,this._getLogHistory=function(){return n.Logger.history},this.StorageObject=s.StorageObject,this.AnalyticsEvent=r.AnalyticsEvent,this._syncExpress=i||(void 0!==e.mcs?e.mcs.sync:null)}return t.prototype._init=function(t){this._config=Object.assign({mcsVersion:"18.3.3.0"},t),void 0!==t.logLevel?n.Logger.logLevel=t.logLevel:n.Logger.logLevel=this.LOG_LEVEL.NONE;var e=this._config;this._logger.debug("MCS initialization, version",e.mcsVersion),void 0!==e.logHistoryEnabled&&(n.Logger.historyEnabled=e.logHistoryEnabled),void 0!==e.logHistorySize&&(n.Logger.historySize=e.logHistorySize),void 0!==e.mcsGlobal&&e.mcsGlobal&&(this._global.mcs=Object.assign({},this._global.mcs,this)),this._syncExpress?this._initPersistenceConfiguration(t):(t.sync||t.syncExpress)&&this._logger.warn("Sync script was not included on page, switch caching off"),this._platform=this._getPlatform(this._config,this._utils)},t.prototype._initPersistenceConfiguration=function(t){var e=this._syncExpress;e._setLogLevel(t.logLevel),e._setLogHTTP(t.logHTTP);var i=null;if(t.sync&&t.syncExpress)throw Error("Configuration contains two types synchronisation, please choose one of those types, switch caching off");if(t.sync)i=t.sync,e.setHandler(e.SYNC_REQUEST_HANDLER_TYPE.MCS);else{if(!t.syncExpress)return this._logger.warn("Missing synchronization configuration, switch caching off"),void e.options.switchOff();i=t.syncExpress;var o=t.syncExpress.handler&&"OracleRestHandler"===t.syncExpress.handler;e.setHandler(o?e.SYNC_REQUEST_HANDLER_TYPE.ORACLE_REST:e.SYNC_REQUEST_HANDLER_TYPE.GENERIC)}e.options.switchOff(!1);var n={default:{conflictResolutionPolicy:"CLIENT_WINS",expirationPolicy:"NEVER_EXPIRE",expireAfter:600,evictionPolicy:"MANUAL_EVICTION",fetchPolicy:"FETCH_FROM_SERVICE_IF_ONLINE",updatePolicy:"QUEUE_IF_OFFLINE",noCache:!1},periodicRefreshInterval:i.backgroundRefreshPolicy||120,policies:[],periodicRefreshPolicy:null},r=i.policies;for(var s in r)if(r.hasOwnProperty(s)){var a=r[s];a?n.policies.push(this._getPersistencePolicy(a)):this._logger.error("The "+a+"policy was not found in accepted policies.")}e.options.setPolicies(n),e.options.dbFirst=!1,e.options.setMaxSyncAttempts(1),e.options.setAutoRemoveAfterReachMaxAttempts(!0)},t.prototype._getPersistencePolicy=function(t){var e={path:t.path};for(var i in t)if(t.hasOwnProperty(i)&&"path"!==i){var o=a.POLICIES_MAP[i];o?void 0===o[t[i]]?this._logger.error("The "+i+" policy value "+t[i]+" was not found in accepted policy values."):e[o.persistencePropertyName]=o[t[i]]:this._logger.error("The "+i+" policy was not found in accepted policies.")}return e},t}();e.MCSModule=c},,,,,,,,,,,,,,,,function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(21),s=i(1),a=i(0),u=function(t){function e(e,i,o,n){var r=t.call(this,e,i,n||new s.Logger("BrowserPlatform"))||this;return r._navigator=o,r.isBrowser=!0,r.isCordova=!1,r}return n(e,t),e.prototype.getDevicePlatform=function(){var t=this._navigator.userAgent;return t.match(/Android/i)?a.DevicePlatforms.ANDROID:t.match(/iPad/i)||t.match(/iPod/i)||t.match(/iPhone/i)?a.DevicePlatforms.IOS:void 0},e.prototype._getPlatform=function(){return a.PlatformNames.JAVASCRIPT},e}(r.Platform);e.BrowserPlatform=u},function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(4),s=i(1),a=i(2),u=i(7),c=i(0),l=i(3),h=function(t){function e(e,i,o,n){var r=t.call(this,i,o,n)||this;return r.logger=new s.Logger("ExternalTokenExchangeAuthorization"),r._backendId=o.validateConfiguration(e.mobileBackendId),r._anonymousToken=o.validateConfiguration(e.anonymousKey),r._clientId=o.validateConfiguration(e.clientId),r._clientSecret=o.validateConfiguration(e.clientSecret),r}return n(e,t),e.prototype.authenticate=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var o=e[0];if(!o||"string"!=typeof o||0===o.length)return this.logger.error("Wrong token parameter"),Promise.reject(new a.NetworkResponse(400,"Bad Request"));this.logout(),this._redToken=o;var n=!1,r=!1;if(-1===o.indexOf("."))n=!0;else{var s=this.getAudience(o);if(!s)return Promise.reject(new a.NetworkResponse(400,"Bad Request"));for(var u=0,c=s;u<c.length;u++){var l=c[u];l===this.backend.getPlatformUrl("sso")||l===this.backend.getPlatformUrl("sso/exchange-token")?n=!0:l!==this.backend.getPlatformUrl("auth")&&l!==this.backend.getPlatformUrl("auth/token")||(r=!0)}}return console.log(n,r),n&&!r?this.authenticateOldAPI(o).then(h.bind(this)).catch(d.bind(this)):r&&!n?this.authenticateNewAPI(o).then(h.bind(this)).catch(d.bind(this)):this.authenticateOldAPI(o).then(h.bind(this)).catch(function(e){return 0===e.statusCode||401===e.statusCode?t.authenticateNewAPI(o):Promise.reject(e)}).then(h.bind(this)).catch(d.bind(this));function h(t){return this._tokenExpiredTime=Date.now()+1e3*t.data.expires_in,this._authenticateSuccess(t,t.data.access_token),new a.NetworkResponse(200,t.data)}function d(t){return this._authenticateError(t),Promise.reject(t)}},e.prototype.getAudience=function(t){var e;try{var i=t.split(".")[1],o=this.utils.decodeBase64(i);o=this.utils.clearNonPrintableCharacters(o),"string"==typeof(e=JSON.parse(o).aud)&&(e=[e])}catch(t){this.logger.error("Token has wrong format",t)}return e},e.prototype.authenticateOldAPI=function(t){console.log("authenticateOldAPI");var e="Bearer "+t,i=this.backend.getHttpHeaders();return i.add(c.Headers.AUTHORIZATION,e),i.add(c.Headers.ORACLE_MOBILE_BACKEND_ID,this._backendId),this.platform.invokeService({headers:i,url:this.backend.getPlatformUrl("sso/exchange-token?format=json"),method:c.HttpMethods.GET,module:c.ModuleNames.AUTHORIZATION})},e.prototype.authenticateNewAPI=function(t){console.log("authenticateNewAPI");var e="Basic "+this.utils.encodeBase64(this._clientId+":"+this._clientSecret),i=this.getData(t),o=this.backend.getHttpHeaders();return o.add(c.Headers.AUTHORIZATION,e),o.add(c.Headers.CONTENT_TYPE,c.ContentTypes.X_WWW_FORM_FORM_URLENCODED),this.platform.invokeService({headers:o,data:i,url:this.backend.getPlatformUrl("auth/token"),method:c.HttpMethods.POST,module:c.ModuleNames.AUTHORIZATION})},e.prototype.getData=function(t){return"grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer&assertion="+encodeURIComponent(t)},e.prototype.authenticateAnonymous=function(){return this._authenticateAnonymousInvoke(new l.Dictionary([]),this.backend.getPlatformUrl("users/login"),c.HttpMethods.GET)},e.prototype._getAnonymousAuthorizationHeaders=function(t){return t.add(c.Headers.AUTHORIZATION,"Basic "+this._anonymousToken),t.add(c.Headers.ORACLE_MOBILE_BACKEND_ID,this._backendId),t},e.prototype.isTokenValid=function(){return!(!this.getAccessToken()&&!this._getAnonymousAccessToken())&&(this.logger.debug("Token is not null or empty"),Date.now()>=this._tokenExpiredTime?(this.logger.info("Token has expired or user has not been authenticate with the service"),!1):(this.logger.debug("Token is still valid"),!0))},e.prototype.logout=function(){this._redToken=null,this._clearState()},e.prototype.refreshToken=function(){return!1===this.isTokenValid()?(this.logger.error("Token is not valid and has expired, refreshing token from service.",this._redToken),this.authenticate(this._redToken).then(function(){return this._accessToken})):null==this._accessToken&&this._isAnonymous?(this.logger.error("Anonymous token is valid, you do not need to refresh."),Promise.resolve(this._anonymousAccessToken)):this._anonymousAccessToken||this._isAnonymous?void 0:(this.logger.error("Authenticated token is valid, you do not need to refresh."),Promise.resolve(this._accessToken))},e.prototype._getHttpHeaders=function(t){return null!==this.getAccessToken()&&"string"==typeof this.getAccessToken()&&t.add(c.Headers.AUTHORIZATION,"Bearer "+this.getAccessToken()),t},e.prototype._getAnonymousHttpHeaders=function(t){return this._getAnonymousAccessToken()&&"string"==typeof this._getAnonymousAccessToken()&&t.add(c.Headers.AUTHORIZATION,"Bearer "+this._getAnonymousAccessToken()),t},e.prototype._anonymousTokenResponseConverter=function(t){return new r.AuthenticationResponse(t,t.data.access_token)},e}(u.MCSAuthorization);e.ExternalTokenExchangeAuthorization=h},function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(4),s=i(1),a=i(2),u=i(7),c=i(3),l=i(0),h=function(t){function e(e,i,o,n){var r=t.call(this,i,o,n)||this;return r.expiredTime=null,r.logger=new s.Logger("FacebookAuthorization"),r._backendId=o.validateConfiguration(e.mobileBackendId),r._anonymousToken=o.validateConfiguration(e.anonymousKey),r._facebookAppId=o.validateConfiguration(e.appId),r._scopes=o.validateConfiguration(e.scopes),r}return n(e,t),e.prototype.getFacebookAppId=function(){return this._facebookAppId},e.prototype.authenticate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.logout(),"undefined"!=typeof cordova){var i=cordova.require("cordova/plugin_list").metadata;return!0!==this.isInAppBrowserInstalled(i)?Promise.reject(new a.NetworkResponse(100,'Could not find InAppBrowser plugin, use command "cordova plugin add cordova-plugin-inappbrowser"')):this._authenticateInvoke()}return Promise.reject(new a.NetworkResponse(400,"Bad Request - This method require Cordova framework"))},e.prototype._authenticateInvoke=function(){return new Promise(function(t,e){var i=this,o=(this.getFacebookAppId(),this.scopes),n=window.open(o,"_blank","location=no,clearsessioncache=yes,clearcache=yes");n.show(),this.logger.info("Opening InAppBrowser to url: "+o),n.addEventListener("loadstart",function(o){if(0===o.url.indexOf("http://localhost/callback")){n.close();for(var r=o.url.split("#")[1],s=r.split("&"),u={},c=0;c<s.length;c++)u[s[c].split("=")[0]]=s[c].split("=")[1];u.access_token?(i.expiredTime=Date.now()+1e3*u.expires_in,t(new a.NetworkResponse(200,u))):0===o.url.indexOf("error_code=100")||i.isAuthorized||e(new a.NetworkResponse(100,"Cannot authenticate via a web browser"))}}),n.addEventListener("exit",function(){i._getIsAuthorized()||e(new a.NetworkResponse(100,"Cannot authenticate via a web browser"))})}.bind(this)).then(function(t){return this._authenticateSuccess(t,t.data.access_token),this.expiredTime=Date.now()+1e3*t.data.expires_in,t}.bind(this)).catch(function(t){return this._authenticateError(t),Promise.reject(t)}.bind(this))},e.prototype.authenticateAnonymous=function(){return this._authenticateAnonymousInvoke(new c.Dictionary([]),this.backend.getPlatformUrl("users/login"),l.HttpMethods.GET)},e.prototype._getAnonymousAuthorizationHeaders=function(t){return t.add(l.Headers.AUTHORIZATION,"Basic "+this._anonymousToken),t.add(l.Headers.ORACLE_MOBILE_BACKEND_ID,this._backendId),t},e.prototype._anonymousTokenResponseConverter=function(t){return new r.AuthenticationResponse(t,"Basic "+this._anonymousToken)},e.prototype.isTokenValid=function(){return!(!this.getAccessToken()&&!this._getAnonymousAccessToken())&&(this.logger.debug("Token is not null or empty"),Date.now()>=this.expiredTime?(this.logger.info("Token has expired or user has not been authenticate with the service/Facebook"),!1):(this.logger.debug("Token is still valid"),!0))},e.prototype.refreshToken=function(){var t=this.isTokenValid();return t&&null==this.getAccessToken()&&this._getIsAnonymous()?Promise.resolve(new a.NetworkResponse(200,this._getAnonymousAccessToken())):t&&this._getAnonymousAccessToken()&&!this._getIsAnonymous()?Promise.resolve(new a.NetworkResponse(200,this._getAnonymousAccessToken())):(this.logger.error("Token is not valid and has expired, refreshing token from Facebook."),this.authenticate())},e.prototype.logout=function(){this._clearState(),this.expiredTime=1e3*Date.now()},e.prototype._getHttpHeaders=function(t){return null!=this.getAccessToken()&&"string"==typeof this.getAccessToken()&&(t.add(l.Headers.AUTHORIZATION,"Basic "+this._anonymousToken),t.add(l.Headers.ORACLE_MOBILE_SOCIAL_ACCESS_TOKEN,this.getAccessToken()),t.add(l.Headers.ORACLE_MOBILE_SOCIAL_IDENTITY_PROVIDER,"facebook")),t.add(l.Headers.ORACLE_MOBILE_BACKEND_ID,this._backendId),t},e.prototype._getAnonymousHttpHeaders=function(t){return this._getAnonymousAccessToken()&&"string"==typeof this._getAnonymousAccessToken()&&t.add(l.Headers.AUTHORIZATION,this._getAnonymousAccessToken()),t.add(l.Headers.ORACLE_MOBILE_BACKEND_ID,this._backendId),t},e.prototype.isInAppBrowserInstalled=function(t){return["cordova-plugin-inappbrowser","org.apache.cordova.inappbrowser"].some(function(e){return t.hasOwnProperty(e)})},e}(u.MCSAuthorization);e.FacebookAuthorization=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),n=i(0),r=function(){function t(t,e){this.backend=t,this.platform=e,this.logger=new o.Logger("Notifications")}return t.prototype.getDevicePlatform=function(){return this.platform.getDevicePlatform().toUpperCase()},t.prototype.registerForNotifications=function(t,e,i,o){if(!(o in n.NotificationProviders))throw Error(this._getProviderError(o));var r=this.backend.getHttpHeaders();r.add(n.Headers.CONTENT_TYPE,n.ContentTypes.APPLICATION_JSON);var s={notificationProvider:o,notificationToken:t,mobileClient:{platform:this.platform.getDevicePlatform().toUpperCase(),id:e,version:i}};return this.platform.invokeService({headers:r,method:n.HttpMethods.POST,url:this.backend.getPlatformUrl("devices/register"),data:JSON.stringify(s),module:n.ModuleNames.NOTIFICATIONS}).then(function(t){return this.logger.info("Device registered for push notifications.",t.statusCode),t}.bind(this)).catch(function(t){return this.logger.error("Device registration for push notifications failed!",t),Promise.reject(t)}.bind(this))},t.prototype.deregisterForNotifications=function(t,e,i){if(!(i in n.NotificationProviders))throw Error(this._getProviderError(i));var o=this.backend.getHttpHeaders();o.add(n.Headers.CONTENT_TYPE,n.ContentTypes.APPLICATION_JSON);var r={notificationProvider:i,notificationToken:t,mobileClient:{platform:this.platform.getDevicePlatform().toUpperCase(),id:e}};return this.platform.invokeService({headers:o,method:n.HttpMethods.POST,url:this.backend.getPlatformUrl("devices/deregister"),data:JSON.stringify(r),module:n.ModuleNames.NOTIFICATIONS}).then(function(t){return this.logger.info("Device deregistered for push notifications succeeded.",t.statusCode),t}.bind(this)).catch(function(t){return this.logger.error("Device deregistration for push notifications failed!",t),Promise.reject(t)}.bind(this))},t.prototype._getProviderError=function(t){return"No Notification Provider Type called "+t+"\nplease use one of those types\n"+n.NotificationProviders.APNS+"\n"+n.NotificationProviders.FCM+"\n"+n.NotificationProviders.WNS+"\n"+n.NotificationProviders.SYNIVERSE},t}();e.Notifications=r},function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(62),s=i(40),a=i(0),u=i(61),c=i(60),l=function(t){function e(e,i,o,n){var s=t.call(this,e,i,o,n)||this;return s.notifications=null,s.notifications=new r.Notifications(s,i),s._authenticationTypes=s.platform._getPlatform()===a.PlatformNames.REACT_NATIVE?Object.assign({},a.AuthenticationTypes,{facebook:void 0}):a.AuthenticationTypes,s}return n(e,t),e.prototype.setAuthenticationType=function(e){var i=this.utils.validateConfiguration(e);if(this.authorization=t.prototype.setAuthenticationType.call(this,i),!this.authorization)if(this.authorization&&this.authorization._getIsAuthorized()&&this.authorization.logout(),i===a.AuthenticationTypes.facebook){var o=this._mbeConfig.authentication.facebook;this.authorization=new u.FacebookAuthorization(o,this,this.utils,this.platform),this._logger.info("Your Authentication type: "+i),this._authenticationType=i}else if(i===a.AuthenticationTypes.token){o=this._mbeConfig.authentication.token;this.authorization=new c.ExternalTokenExchangeAuthorization(o,this,this.utils,this.platform),this._logger.info("Your Authentication type: "+i),this._authenticationType=i}return this.authorization},e}(s.Backend);e.MobileBackend=l},,,,,,function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(59),s=i(1),a=i(0),u=function(t){function e(e,i,o,n){var r=t.call(this,e,i,o,n||new s.Logger("CordovaPlatform"))||this;return r.ANDROID_OS_NAME="Android",r.IOS_OS_NAME="iOS",r._latitude=null,r._longitude=null,r._gpsLocationInitialised=!1,r.isBrowser=!1,r.isCordova=!0,r}return n(e,t),e.prototype.initGPSLocation=function(){function t(t){this.latitude=t.coords.latitude,this.longitude=t.coords.longitude}function e(t){this.logger.error("Error while subscribing for position.",t)}this._logger.debug("Subscribe to location changes"),this._gpsLocationInitialised||(this._navigator&&this._navigator.geolocation&&this._navigator.geolocation.watchPosition&&this._navigator.geolocation.getCurrentPosition?document.addEventListener("deviceready",function(){this._navigator.geolocation.getCurrentPosition(t,e),this._navigator.geolocation.watchPosition(t,e)}.bind(this),!1):this._logger.warn("This browser does not support geolocation."),this._gpsLocationInitialised=!0)},e.prototype.getGPSLocation=function(){return{latitude:this._latitude,longitude:this._longitude}},e.prototype.checkConnection=function(){var t=this._navigator.connection.type,e={};return e[Connection.UNKNOWN]="Unknown connection",e[Connection.ETHERNET]="Ethernet connection",e[Connection.WIFI]="WiFi connection",e[Connection.CELL_2G]="Cell 2G connection",e[Connection.CELL_3G]="Cell 3G connection",e[Connection.CELL_4G]="Cell 4G connection",e[Connection.CELL]="Cell generic connection",e[Connection.NONE]="No network connection",this._logger.info("Connection type: "+e[t]),e[t]},e.prototype.getDeviceInformation=function(){return{model:this._getProperty("model"),manufacturer:this._getProperty("manufacturer"),osName:this._getProperty("platform"),osVersion:this._getProperty("version"),osBuild:this._getProperty("cordova"),carrier:"<unknown>"}},e.prototype._getProperty=function(t){return("undefined"!=typeof device?device[t]:null)||"<unknown>"},e.prototype.getDevicePlatform=function(){return device.platform.toUpperCase()},e.prototype._getPlatform=function(){return a.PlatformNames.CORDOVA},e}(r.BrowserPlatform);e.CordovaPlatform=u},function(t,e,i){"use strict";var o,n=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var r=i(43),s=i(63),u=i(69),c=function(t){function e(e,i){var o=t.call(this,e,i)||this;return o.mobileBackend=null,o}return n(e,t),e.prototype.init=function(t){this._init(t),t.mobileBackend&&(this.mobileBackend=new s.MobileBackend(this._config,this._platform,this._utils,this._syncExpress))},e.prototype._getPlatform=function(t,e){return this._logger.debug("Create Cordova platform"),new u.CordovaPlatform(this._config,this._utils,navigator)},e}(r.MCSModule);e.MCSCordovaModule=c,a=c}]);var c=new a(function(t,e,i,o,n){},u=void 0!==o?o:void 0!==n?n:void 0!==r?r:s);"object"==typeof e&&void 0!==t?t.exports=c:"function"==typeof i&&i.amd?i([],c):u.mcs=c}("undefined"==typeof module?void 0:module,"undefined"==typeof exports?void 0:exports,"undefined"==typeof define?void 0:define,"undefined"==typeof window?void 0:window,"undefined"==typeof global?void 0:global,"undefined"==typeof self?void 0:self,this);