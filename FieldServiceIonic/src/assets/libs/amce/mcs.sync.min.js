!function(t,e,r,i,n,o,s){var a,l;!function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=58)}([function(t,e,r){"use strict";var i,n,o,s,a,l,c,h,u,p,d,f,y,m,g,v,b,E,O,w,P,R;Object.defineProperty(e,"__esModule",{value:!0}),(n=i||(i={})).ORACLE_MOBILE_DIAGNOSTIC_SESSION_ID="Oracle-Mobile-DIAGNOSTIC-SESSION-ID",n.ORACLE_MOBILE_DEVICE_ID="Oracle-Mobile-DEVICE-ID",n.ORACLE_MOBILE_CLIENT_REQUEST_TIME="Oracle-Mobile-CLIENT-REQUEST-TIME",n.ORACLE_MOBILE_ANALYTICS_APPLICATION_ID="Oracle-Mobile-Analytics-Application-Id",n.ORACLE_MOBILE_NAME="Oracle-Mobile-Name",n.ORACLE_MOBILE_CREATED_BY="Oracle-Mobile-Created-By",n.ORACLE_MOBILE_CREATED_ON="Oracle-Mobile-Created-On",n.ORACLE_MOBILE_MODIFIED_BY="Oracle-Mobile-Modified-By",n.ORACLE_MOBILE_MODIFIED_ON="Oracle-Mobile-Modified-On",n.ORACLE_MOBILE_SYNC_RESOURCE_TYPE="Oracle-Mobile-Sync-Resource-Type",n.ORACLE_MOBILE_SYNC_AGENT="Oracle-Mobile-Sync-Agent",n.LOCATION="Location",n.ORACLE_MOBILE_BACKEND_ID="Oracle-Mobile-Backend-Id",n.ORACLE_MOBILE_SOCIAL_IDENTITY_PROVIDER="Oracle-Mobile-Social-Identity-Provider",n.ORACLE_MOBILE_SOCIAL_ACCESS_TOKEN="Oracle-Mobile-Social-Access-Token",n.ORACLE_MOBILE_CLIENT_SDK_INFO="Oracle-Mobile-Client-SDK-Info",n.ACCEPT="Accept",n.CONTENT_TYPE="Content-Type",n.E_TAG="ETag",n.IF_MATCH="If-Match",n.AUTHORIZATION="Authorization",n.X_USER_IDENTITY_DOMAIN_NAME="X-USER-IDENTITY-DOMAIN-NAME",n.X_RESOURCE_IDENTITY_DOMAIN_NAME="X-RESOURCE-IDENTITY-DOMAIN-NAME",n.ACCEPT_ENCODING="Accept-Encoding",n.IF_MODIFIED_SINCE="if-modified-since",n.IF_NONE_MATCH="if-none-match",e.Headers=i,(s=o||(o={})).APPLICATION_JSON="application/json",s.TEXT_PLAIN="text/plain",s.X_WWW_FORM_FORM_URLENCODED="application/x-www-form-urlencoded; charset=utf-8",e.ContentTypes=o,(l=a||(a={})).GET="GET",l.PUT="PUT",l.PATCH="PATCH",l.POST="POST",l.DELETE="DELETE",l.HEAD="HEAD",e.HttpMethods=a,(h=c||(c={})).ITEM="item",h.COLLECTION="collection",h.FILE="file",e.ResourceTypes=c,(p=u||(u={})).basic="basic",p.oauth="oauth",p.facebook="facebook",p.token="token",e.AuthenticationTypes=u,(f=d||(d={})).STORAGE="Storage",f.AUTHORIZATION="Authorization",f.USER_MANAGEMENT="UserManagement",f.APP_POLICES="AppPolicies",f.LOCATION="Location",f.SYNC="Sync",f.SYNC_EXPRESS="SyncExpress",f.NOTIFICATIONS="Notifications",f.MCS_ANALYTICS="MCSAnalytics",f.ANALYTICS="Analytics",f.CUSTOM_CODE="CustomCode",f.APP_CONFIG="AppConfig",e.ModuleNames=d,(m=y||(y={})).JAVASCRIPT="Javascript",m.CORDOVA="Cordova",m.REACT_NATIVE="ReactNative",e.PlatformNames=y,(v=g||(g={})).ANDROID="android",v.IOS="ios",e.DevicePlatforms=g,(E=b||(b={})).FCM="FCM",E.APNS="APNS",E.WNS="WNS",E.SYNIVERSE="SYNIVERSE",e.NotificationProviders=b,(w=O||(O={})).JSON="json",w.BLOB="blob",w.ARRAY_BUFFER="arraybuffer",w.DOCUMENT="document",w.TEXT="text",e.XMLHttpRequestResponseTypes=O,(R=P||(P={})).GENERIC="Generic",R.MCS="MCS",R.ORACLE_REST="OracleRest",e.SyncRequestHandlerTypes=P},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.module=t}return t.prototype.debug=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this.log(t.LOG_LEVEL.DEBUG,e)},t.prototype.error=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this.log(t.LOG_LEVEL.ERROR,e)},t.prototype.info=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this.log(t.LOG_LEVEL.INFO,e)},t.prototype.warn=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this.log(t.LOG_LEVEL.WARN,e)},t.prototype.log=function(e,r){if(t.logLevel>=e){r.unshift("[mcs."+this.module+"]");var i=void 0;switch(t.logLevel){case t.LOG_LEVEL.ERROR:i=console.error;break;case t.LOG_LEVEL.WARN:i=console.warn;break;case t.LOG_LEVEL.INFO:i=console.info;break;case t.LOG_LEVEL.DEBUG:i=console.debug}t.historyEnabled&&(t.history.push(Object.assign({},r,{level:e})),t.historySize<=t.history.length&&t.history.shift()),i.apply(console,r)}},t.LOG_LEVEL={NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4},t.logLevel=t.LOG_LEVEL.ERROR,t.historyEnabled=!1,t.historySize=100,t.history=[],t}();e.Logger=i},,,,,function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(9),n=r(1),o=function(){function t(t,e,r,i,o){var s=this;this.dbName=t,this.$options=e,this.$common=r,this.$utils=i,this.logger=new n.Logger("RequestHandler"),this.prefix=e.dbPrefix,this.$db=this._createDatabase(o),e.onDbPrefixChange=function(t,e){s.prefix=e,s.$db=s._createDatabase(o)}}return t.prototype.isPersistentRequest=function(t){if(!t)throw new Error("request cannot be undefined or null value");if(!this.$common.isObject(t))throw new Error("request has to be defined object with properties like: url, data etc.");if(this.$common.isEmpty(t))throw new Error("request cannot be empty object, it request properties like: url, data etc.");if(this.$common.isArray(t)||this.$common.isFunction(t))throw new Error("request cannot be array or function");if(!("url"in t))throw new Error("request.url was not specified");return!0},t.prototype.isPersistentGetRequest=function(t){return this.isPersistentRequest(t),!0},t.prototype.isPostRequest=function(t){if(this.isPersistentRequest(t),!("data"in t))throw new Error("request.data was not defined!");if(!this.$common.isObject(t.data))throw new Error("request.data is not a object or array!");if(this.$common.isFunction(t.data))throw new Error("request.data cannot be function");return!0},t.prototype.isOfflinePersistObj=function(t){return!!("meta"in t&&t.meta.hasOwnProperty("offline-persist"))},t.prototype.isLokiDbObj=function(t){return!(!("$loki"in t&&"number"==typeof t.$loki)||isNaN(t.$loki))},t.prototype.buildFindQueryBasedOnUrlParams=function(t){var e={};t.attr.length>0&&(e[t.attr[0].name]=t.attr[0].pattern.indexOf("d")>=0?parseInt(t.attr[0].value,10):t.attr[0].value+"");return e},t.prototype.buildUniqueIDValue=function(t,e){var r=function(){return t.uri.tokens.length>1&&t.uri.tokens[t.uri.tokens.length-1].pattern.indexOf("d")>=0},i=function(t){return r()?parseInt(t,10):t+""};return this.$common.isEmpty(e)?i(this.$common.getUID()):"number"==typeof e&&r()?e:i(e)},t.prototype.handleGetRootArrayPayload=function(t,e,r){var i=this;if(e.uri.tokens.length>1){if(r.find().length>0){var n=e.uri.tokens[1].name;return r.removeWhere(function(e){var o=t.findIndex(function(t){return t[n]===e[n]});if(!(o>-1))return!i.isOfflinePersistObj(e);try{i.isOfflinePersistObj(e)?e=i.$common.deepExtend(t[o],e):i.$common.extendOwn(e,t[o]),r.update(e),t.splice(o,1)}catch(t){i.logger.error(t)}finally{return!1}}),t.forEach(function(t){i.isLokiDbObj(t)?r.update(t):r.insert(t)}),r.find()}return r.insert(t)}return r.removeWhere(function(t){return!i.isOfflinePersistObj(t)}),r.insert(t)},t.prototype.handleGetRootObjectPayload=function(t,e,r){var i=this;if(e.uri.tokens.length>1){var n=e.uri.tokens[1].name;if(!t.hasOwnProperty(n))throw this.logger.error("payload does not contain unique key specified in the URL settings"),new Error("payload does not contain unique key specified in the URL settings");var o={};o[n]=t[n];var s=r.findOne(o);return s?(this.isOfflinePersistObj(s)?s=this.$common.deepExtend(t,s):this.$common.extendOwn(s,t),r.update(s)):r.insert(t)}return r.removeWhere(function(t){return!i.isOfflinePersistObj(t)}),r.insert(t)},t.prototype.buildNestedPropertySearchString=function(t){var e="";if(t.attr.length>1)for(var r=1;r<t.attr.length;r++)t.attr[r].is?e.length>0?e+="."+t.attr[r].name:e+=t.attr[r].name:e.length>0?e+="."+t.attr[r].name+"["+t.attr[r].value+"]":e+=t.attr[r].value;return e},t.prototype.buildNestedPropertyArrayParams=function(t,e,r){void 0===r&&(r=!1);var i=[],n=e.attr;if(Array.isArray(n)&&n.length>0)for(var o=t.uri.tokens.length>1?t.uri.tokens.slice(1):[],s=0;s<n.length;s++){var a=n.length-1===s;if(n[s].is){if(i.push({name:n[s].name,value:null,isProperty:!0,isInteger:!1}),a&&o[s+1]&&r){var l=this.$utils.isUrlRegexInteger(o[s+1].pattern);i.push({name:o[s+1].name,value:l?this.$common.getUID():this.$common.getUID()+"",isProperty:!1,isInteger:l})}}else{var c=n[s].value||this.$common.getUID();i.push({name:n[s].name,value:c,isProperty:!1,isInteger:this.$utils.isUrlRegexInteger(o[s].pattern)})}}return i},t.prototype.createObjFromUrlParamsForExistingForPost=function(t,e,r,i,n){var o=this.buildNestedPropertyArrayParams(e,r),s=t;if(Array.isArray(o)&&o.length>0){var a=void 0;if(n){var l=this.getKeyForCurrentObject(e,r);a={key:l,value:n[l.name]}}s=this.$utils.setNestedProperty2(t,o,i,a)}else this.$common.extendOwn(t,i);return{obj:t,result:s}},t.prototype.getKeyForCurrentObject=function(t,e){var r=e.attr.length;return t.uri.tokens[r+1]},t.prototype.createObjFromUrlParamsForGETAction=function(t,e,r,i){var n=this.buildNestedPropertyArrayParams(e,r,!1),o=t;return Array.isArray(n)&&n.length>0&&(o=this.$utils.setNestedProperty2(t,n,i)),{obj:t,result:o}},t.prototype.getNestedPropertyFromUrlParamsForExisting=function(t,e,r){var i=this.buildNestedPropertyArrayParams(e,r,!1);return Array.isArray(i)&&i.length>0?this.$utils.getNestedProperty(t,i):t},t.prototype.markObjAsOfflineIfForced=function(t,e){return e?(this.isOfflinePersistObj(t)&&delete t.meta["offline-persist"],t):"meta"in t?(t.meta["offline-persist"]=!0,t):(t.meta={},t.meta["offline-persist"]=!0,t)},t.prototype.handleGet=function(t){var e=this.$options.parseURL(t.url),r=this.$utils.isPersistUrl(e.path);if(!r)throw new Error("Persistence.RequestHandler.get() given URI was not configured for persistence:"+e.path);var i=this.$utils.extractKeyValuesFromUrl2(r),n=this.$db.getCollectionByName(i.root),o=this.buildFindQueryBasedOnUrlParams(i);if(this.$common.isEmpty(o)){this.logger.debug("return all from db");var s=this.$common.cleanObjects(n.find());return this.buildResponseObject(s)}var a=n.findOne(o);if(a){var l=this.getNestedPropertyFromUrlParamsForExisting(a,r,i),c=this.$common.cleanObject(l);return this.buildResponseObject(c)}return null},t.prototype.handleGetStore=function(t){var e=this.$options.parseURL(t.url),r=this.$utils.isPersistUrl(e.path);if(!r)throw new Error("Persistence.RequestHandler.get() given URI was not configured for persistence:"+e.path);var i=this.$utils.extractKeyValuesFromUrl2(r),n=this.$db.getCollectionByName(i.root),o=this.getResponsePayload(t),s=this.buildFindQueryBasedOnUrlParams(i);if(this.$common.isEmpty(s)){if(!this.$common.isArray(o)||this.$common.isFunction(o)||this.$common.isEmpty(o)){if(!this.$common.isObject(o)||this.$common.isArray(o)||this.$common.isFunction(o)||this.$common.isEmpty(o))throw this.logger.error("handleGetStore","unknown or empty object passed for the operation"),new Error("RequestHandler.handleGetStore -> unknown or empty object passed for the operation");return this.handleGetRootObjectPayload(o,r,n)}var a=this.handleGetRootArrayPayload(o,r,n);return this.buildResponseObject(a)}var l=n.findOne(s),c=void 0;return l?(c=this.createObjFromUrlParamsForGETAction(l,r,i,o),n.update(c.obj)):(c=this.createObjFromUrlParamsForGETAction(s,r,i,o),n.insert(c.obj)),this.buildResponseObject(c.result)},t.prototype.handlePostRootArrayPayload=function(t,e,r,i){var n=this,o=e.uri.tokens.length>1?e.uri.tokens[1].name:null;return t.forEach(function(t){if(n.isLokiDbObj(t))n.markObjAsOfflineIfForced(t,i),r.update(t);else{if(!o||!t.hasOwnProperty(o)){var s=r.insert(t);return s[o]=n.buildUniqueIDValue(e),n.markObjAsOfflineIfForced(s,i),n.$common.cleanObject(r.update(s))}var a=r.findOne({keyNameToCompare:t[o]});a?(n.$common.extendOwn(a,t),n.markObjAsOfflineIfForced(a,i),r.update(a)):(n.markObjAsOfflineIfForced(t,i),r.insert(t))}}),this.$common.cleanObjects(r.find())},t.prototype.handlePostRootObjectPayload=function(t,e,r,i){var n=e.uri.tokens.length>1?e.uri.tokens[1].name:"";if(n&&!t.hasOwnProperty(n)){this.logger.info("get payload","does not have the key specified in the URL settings"),t[n]="";var o=r.insert(t);if(o)return o[n]=this.buildUniqueIDValue(e),this.markObjAsOfflineIfForced(o,i),this.$common.cleanObject(r.update(o));throw new Error("unable to store the payload object")}if(n&&t.hasOwnProperty(n)){var s={};s[n]=t[n];var a=r.findOne(s);if(a)return this.$common.extendOwn(a,t),this.markObjAsOfflineIfForced(a,i),this.$common.cleanObject(r.update(a));t[n]=this.buildUniqueIDValue(e,t[n])}return this.markObjAsOfflineIfForced(t,i),this.$common.cleanObject(r.insert(t))},t.prototype.handlePost=function(t,e){var r=this.$options.parseURL(t.url),i=this.$utils.isPersistUrl(r.path);if(!i)throw new Error("Persistence.RequestHandler.post() given URI not configured for persistence: "+r.path);var n=this.$utils.extractKeyValuesFromUrl2(i),o=this.$db.getCollectionByName(n.root),s=t.data,a=this.buildFindQueryBasedOnUrlParams(n);if(!this.$common.isEmpty(a)){var l=o.findOne(a);if(l){var c=this.createObjFromUrlParamsForExistingForPost(l,i,n,s),h=i.uri.tokens[i.uri.tokens.length-1].name;return c.result[h]=this.buildUniqueIDValue(i,c.result[h]),this.markObjAsOfflineIfForced(c.obj,e),o.update(c.obj),this.$common.cleanObject(c.result)}c=this.createObjFromUrlParamsForExistingForPost(a,i,n,s);return this.markObjAsOfflineIfForced(c.obj,e),o.insert(c.obj),this.$common.cleanObject(c.result)}if(this.$common.isArray(s))return this.handlePostRootArrayPayload(s,i,o,e);if(this.$common.isObject(s)&&!this.$common.isArray(s)&&!this.$common.isNull(s))return this.handlePostRootObjectPayload(s,i,o,e);throw new Error("don't know what to do with the payload")},t.prototype.handlePut=function(t,e){var r=this.$options.parseURL(t.url),i=this.$utils.isPersistUrl(r.path);if(!i)throw new Error("Persistence.RequestHandler.post() given URI not configured for persistence: "+r.path);var n=this.$utils.extractKeyValuesFromUrl2(i),o=this.$db.getCollectionByName(n.root),s=t.data,a=this.buildFindQueryBasedOnUrlParams(n);if(!this.$common.isEmpty(a)){var l=o.findOne(a);if(l){var c=this.createObjFromUrlParamsForExistingForPost(l,i,n,s);return this.markObjAsOfflineIfForced(c.obj,e),o.update(c.obj),c.result}c=this.createObjFromUrlParamsForExistingForPost(a,i,n,s);return this.markObjAsOfflineIfForced(c.obj,e),o.insert(c.obj),c.result}if(this.$common.isArray(s))return this.handlePostRootArrayPayload(s,i,o,e);if(this.$common.isObject(s)&&!this.$common.isArray(s)&&!this.$common.isNull(s))return this.handlePostRootObjectPayload(s,i,o,e);throw new Error("no key specified to recognise obj in the database for editing!")},t.prototype.handlePatch=function(t,e){var r=this.$options.parseURL(t.url),i=this.$utils.isPersistUrl(r.path);if(!i)throw new Error("Persistence.RequestHandler.post() given URI not configured for persistence: "+r.path);var n=this.$utils.extractKeyValuesFromUrl2(i),o=this.$db.getCollectionByName(n.root),s=t.data,a=this.buildFindQueryBasedOnUrlParams(n);if(!this.$common.isEmpty(a)){var l=o.findOne(a);if(l){var c=this.createObjFromUrlParamsForExistingForPost(l,i,n,s);return this.markObjAsOfflineIfForced(c.obj,e),o.update(c.obj),c.result}c=this.createObjFromUrlParamsForExistingForPost(a,i,n,s);return this.markObjAsOfflineIfForced(c.obj,e),o.insert(c.obj),c.result}if(this.$common.isArray(s))return this.handlePostRootArrayPayload(s,i,o,e);if(this.$common.isObject(s)&&!this.$common.isArray(s)&&!this.$common.isNull(s))return this.handlePostRootObjectPayload(s,i,o,e);throw new Error("no key specified to recognise obj in the database for editing!")},t.prototype.handleDelete=function(t){var e=this.$options.parseURL(t.url),r=this.$utils.isPersistUrl(e.path);if(!r)throw new Error("Persistence.RequestHandler.post() given URI not configured for persistence: "+e.path);var i=this.$utils.extractKeyValuesFromUrl2(r),n=this.$db.getCollectionByName(i.root),o=this.buildFindQueryBasedOnUrlParams(i);if(!this.$common.isEmpty(o)){if(a=n.findOne(o))return this.$common.cleanObject(n.remove(a));throw new Error("unable to find object with the given ID(%s) in the database")}if(t.hasOwnProperty("data")){var s=t.data;if(!this.$common.isEmpty(s)&&this.$common.isObject(s)&&!this.$common.isArray(s)){var a,l=r.uri.tokens.length>1?r.uri.tokens[1].name:null;if(l&&!t.data.hasOwnProperty(l))throw new Error("payload does not have the key required to delete the object");if(a=n.findOne({keyNameToCompare:t.data[l]}))return this.$common.cleanObject(n.remove(a))}}throw this.logger.error("payload does not have the key required to delete the object in the payload"),new Error("payload does not have the key required to delete the object in the payload")},t.prototype.postSuccessOperations=function(t){if("POST"===t.syncObj.method){var e=this.$common.clone(t),r=this.$options.parseURL(e.syncObj.url),i=this.$utils.isPersistUrl(r.path);if(!i)return this.logger.debug("sync post success operation exist"),t;var n=this.$utils.extractKeyValuesFromUrl2(i),o=this.$db.getCollectionByName(n.root),s=e.syncObj.data,a=e.response,l=this.buildFindQueryBasedOnUrlParams(n);if(this.$common.isEmpty(l)){var c=i.uri.tokens.length>1?i.uri.tokens[1].name:"";if(c&&!s.hasOwnProperty(c))return a=this.$common.extendOwn(s,a),this.$common.cleanObject(o.insert(a));var h={};h[c]=s[c];var u=o.findOne(h);return this.$common.extendOwn(u,a),this.$common.cleanObject(o.update(u))}var p=o.findOne(l);if(p){var d=this.createObjFromUrlParamsForExistingForPost(p,i,n,a,s),f=i.uri.tokens[i.uri.tokens.length-1].name;return d.result[f]=this.buildUniqueIDValue(i,d.result[f]),o.update(d.obj),this.$common.cleanObject(d.result)}d=this.createObjFromUrlParamsForExistingForPost(l,i,n,a);return o.insert(d.obj),this.$common.cleanObject(d.result)}return t},t.prototype.flush=function(t){var e=this;if(this.logger.info("Persistence.RequestHandler.flush()",t),this.$common.isEmpty(t))return this.$db.flush();var r=this.$options.parseURL(t),i=this.$utils.isPersistUrl(r.path);return new Promise(function(t,n){if(i){var o=e.$utils.extractKeyValuesFromUrl2(i);t(e.$db.getCollectionByName(o.root).removeDataOnly())}else n(new Error("Persistence.RequestHandler.flush() given URI not configured for persistence: "+r.path))})},t.prototype.getDB=function(){return this.$db},t.prototype.get=function(t){var e=this;return new Promise(function(r){r(function(t){e.logger.info("get()"),e.isPersistentGetRequest(t);var r=e.$common.clone(t);return!r.hasOwnProperty("data")||e.$common.isEmpty(r.data)?e.$common.clone(e.handleGet(r)):e.$common.clone(e.handleGetStore(r))}(t))})},t.prototype.post=function(t,e){var r=this;return new Promise(function(i){i(function(t,e){r.logger.info("post()"),r.isPostRequest(t);var i=r.$common.clone(t);return r.$common.clone(r.handlePost(i,e))}(t,e))})},t.prototype.put=function(t,e){var r=this;return new Promise(function(i){i(function(t,e){r.logger.info("put()"),r.isPostRequest(t);var i=r.$common.clone(t);return r.$common.clone(r.handlePut(i,e))}(t,e))})},t.prototype.patch=function(t,e){var r=this;return new Promise(function(i){i(function(t,e){r.logger.info("patch()"),r.isPostRequest(t);var i=r.$common.clone(t);return r.$common.clone(r.handlePatch(i,e))}(t,e))})},t.prototype.delete=function(t){var e=this;return new Promise(function(r){r(function(t){e.logger.info("delete()"),e.isPersistentRequest(t);var r=e.$common.clone(t);return e.$common.clone(e.handleDelete(r))}(t))})},t.prototype.data=function(t){var e=this;return new Promise(function(r){r(function(t){if(e.logger.info("data()"),null==t)throw new Error("Path cannot be empty!");var r=e.$options.parseURL(t),i=e.$utils.isPersistUrl(r.path);if(!i)throw new Error("post() given URI not configured for persistence: "+r.path);var n=e.$utils.extractKeyValuesFromUrl2(i);return e.$db.getCollectionByName(n.root)}(t))})},t.prototype.router=function(t,e){var r=this;return void 0===e&&(e=!1),new Promise(function(i){if(!r.isPersistentGetRequest(t))throw r.logger.error("Passed object is not defined request for GET!",t.url),new Error("Passed object is not defined request for GET!");if(!t.hasOwnProperty("method"))throw r.logger.error("request.method was not provided!",t),new Error("request.method was not provided!");var n=r.$common.clone(t);if(n.method=r.$utils._normalizeMethod(n.method),!r[n.method])throw r.logger.error("specified router is not implemented!"),new Error("specified router is not implemented!");i(r[n.method](n,e))})},t.prototype._createDatabase=function(t){return new i.DB(this.prefix+"."+this.dbName,this.$options,t)},t}();e.RequestHandler=o},,function(t,e,r){(function(i,n){var o,s,a;s=[],void 0===(a="function"==typeof(o=function(){return function(){"use strict";var t=Object.prototype.hasOwnProperty,e={copyProperties:function(t,e){var r;for(r in t)e[r]=t[r]},resolveTransformObject:function(t,r,i){var n,o;if("number"!=typeof i&&(i=0),++i>=10)return t;for(n in t)"string"==typeof t[n]&&0===t[n].indexOf("[%lktxp]")?(o=t[n].substring(8),r.hasOwnProperty(o)&&(t[n]=r[o])):"object"==typeof t[n]&&(t[n]=e.resolveTransformObject(t[n],r,i));return t},resolveTransformParams:function(t,r){var i,n,o=[];if(void 0===r)return t;for(i=0;i<t.length;i++)n=y(t[i],"shallow-recurse-objects"),o.push(e.resolveTransformObject(n,r));return o}},o={aeq:s,lt:a,gt:l};function s(t,e){var r,i,n,o;if(t===e)return!0;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:n=1;break;case!1:n=3;break;case!0:n=4;break;case"":n=5;break;default:n=t==t?9:0}switch(e){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=e==e?9:0}if(9!==n||9!==o)return n===o}return r=Number(t),i=Number(e),r==r||i==i?r===i:(r=t.toString(),i=e.toString(),r==i)}function a(t,e,r){var i,n,o,s;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==o||9!==s)return o===s?r:o<s}return i=Number(t),n=Number(e),i==i&&n==n?i<n||!(i>n)&&r:i==i&&n!=n||(n!=n||i==i)&&(t<e||!(t>e)&&(t==e?r:(i=t.toString(),n=e.toString(),i<n||i==n&&r)))}function l(t,e,r){var i,n,o,s;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==o||9!==s)return o===s?r:o>s}return i=Number(t),n=Number(e),i==i&&n==n?i>n||!(i<n)&&r:(i!=i||n==n)&&(n==n&&i!=i||t>e||!(t<e)&&(t==e?r:(i=t.toString(),n=e.toString(),i>n||i==n&&r)))}function c(t,e,r){return o.aeq(t,e)?0:o.lt(t,e,!1)?r?1:-1:o.gt(t,e,!1)?r?-1:1:0}function h(e,r,i,n,o){var s=o||0,a=r[s];if(void 0===e||null===e||!t.call(e,a))return!1;var l=!1,c=e[a];if(s+1>=r.length)l=i(c,n);else if(Array.isArray(c))for(var u=0,p=c.length;u<p&&!0!==(l=h(c[u],r,i,n,s+1));u+=1);else l=h(c,r,i,n,s+1);return l}function u(e){return"string"==typeof e||Array.isArray(e)?function(t){return-1!==e.indexOf(t)}:"object"==typeof e&&null!==e?function(r){return t.call(e,r)}:null}function p(e,r){for(var i in r)if(t.call(r,i))return d[i](e,r[i]);return!1}var d={$eq:function(t,e){return t===e},$aeq:function(t,e){return t==e},$ne:function(t,e){return e!=e?t==t:t!==e},$dteq:function(t,e){return o.aeq(t,e)},$gt:function(t,e){return o.gt(t,e,!1)},$gte:function(t,e){return o.gt(t,e,!0)},$lt:function(t,e){return o.lt(t,e,!1)},$lte:function(t,e){return o.lt(t,e,!0)},$jgt:function(t,e){return t>e},$jgte:function(t,e){return t>=e},$jlt:function(t,e){return t<e},$jlte:function(t,e){return t<=e},$between:function(t,e){return void 0!==t&&null!==t&&o.gt(t,e[0],!0)&&o.lt(t,e[1],!0)},$jbetween:function(t,e){return void 0!==t&&null!==t&&t>=e[0]&&t<=e[1]},$in:function(t,e){return-1!==e.indexOf(t)},$nin:function(t,e){return-1===e.indexOf(t)},$keyin:function(t,e){return t in e},$nkeyin:function(t,e){return!(t in e)},$definedin:function(t,e){return void 0!==e[t]},$undefinedin:function(t,e){return void 0===e[t]},$regex:function(t,e){return e.test(t)},$containsString:function(t,e){return"string"==typeof t&&-1!==t.indexOf(e)},$containsNone:function(t,e){return!d.$containsAny(t,e)},$containsAny:function(t,e){var r=u(t);return null!==r&&(Array.isArray(e)?e.some(r):r(e))},$contains:function(t,e){var r=u(t);return null!==r&&(Array.isArray(e)?e.every(r):r(e))},$type:function(t,e){var r=typeof t;return"object"===r&&(Array.isArray(t)?r="array":t instanceof Date&&(r="date")),"object"!=typeof e?r===e:p(r,e)},$finite:function(t,e){return e===isFinite(t)},$size:function(t,e){return!!Array.isArray(t)&&("object"!=typeof e?t.length===e:p(t.length,e))},$len:function(t,e){return"string"==typeof t&&("object"!=typeof e?t.length===e:p(t.length,e))},$where:function(t,e){return!0===e(t)},$not:function(t,e){return!p(t,e)},$and:function(t,e){for(var r=0,i=e.length;r<i;r+=1)if(!p(t,e[r]))return!1;return!0},$or:function(t,e){for(var r=0,i=e.length;r<i;r+=1)if(p(t,e[r]))return!0;return!1}},f={$eq:d.$eq,$aeq:!0,$dteq:!0,$gt:!0,$gte:!0,$lt:!0,$lte:!0,$in:!0,$between:!0};function y(t,e){if(null===t||void 0===t)return null;var r,i=e||"parse-stringify";switch(i){case"parse-stringify":r=JSON.parse(JSON.stringify(t));break;case"jquery-extend-deep":r=jQuery.extend(!0,{},t);break;case"shallow":r=Object.create(t.constructor.prototype),Object.keys(t).map(function(e){r[e]=t[e]});break;case"shallow-assign":r=Object.create(t.constructor.prototype),Object.assign(r,t);break;case"shallow-recurse-objects":r=y(t,"shallow");var n=Object.keys(t);n.forEach(function(e){"object"==typeof t[e]&&"Object"===t[e].constructor.name&&(r[e]=y(t[e],"shallow-recurse-objects"))})}return r}function m(){try{return window&&void 0!==window.localStorage&&null!==window.localStorage}catch(t){return!1}}function g(){}function v(t,e){this.filename=t||"loki.db",this.collections=[],this.databaseVersion=1.5,this.engineVersion=1.5,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.throttledSaves=!0,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.throttledSavePending=!1,this.throttledCallbacks=[],this.verbose=!(!e||!e.hasOwnProperty("verbose"))&&e.verbose,this.events={init:[],loaded:[],flushChanges:[],close:[],changes:[],warning:[]},e&&e.hasOwnProperty("env")?this.ENV=e.env:this.ENV=void 0!==i&&(i.android||i.NSObject)?"NATIVESCRIPT":"undefined"==typeof window?"NODEJS":void 0!==i&&i.window&&n?"NODEJS":"undefined"!=typeof document?-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?"CORDOVA":"BROWSER":"CORDOVA","undefined"===this.ENV&&(this.ENV="NODEJS"),this.configureOptions(e,!0),this.on("init",this.clearChanges)}function b(t){this.hashStore={},this.options=t||{},this.options.hasOwnProperty("asyncResponses")||(this.options.asyncResponses=!1),this.options.hasOwnProperty("asyncTimeout")||(this.options.asyncTimeout=50)}function E(t,e){if(this.mode="reference",this.adapter=null,this.options=e||{},this.dbref=null,this.dbname="",this.pageIterator={},!t)throw new Error("LokiPartitioningAdapter requires a (non-reference mode) adapter on construction");if("reference"===t.mode)throw new Error("LokiPartitioningAdapter cannot be instantiated with a reference mode adapter");this.adapter=t,this.options.hasOwnProperty("paging")||(this.options.paging=!1),this.options.hasOwnProperty("pageSize")||(this.options.pageSize=26214400),this.options.hasOwnProperty("delimiter")||(this.options.delimiter="$<\n")}function O(){try{this.fs=r(11)}catch(t){this.fs=null}}function w(){}function P(t,e){return e=e||{},this.collection=t,this.filteredrows=[],this.filterInitialized=!1,this}function R(t,e,r){this.collection=t,this.name=e,this.rebuildPending=!1,this.options=r||{},this.options.hasOwnProperty("persistent")||(this.options.persistent=!1),this.options.hasOwnProperty("sortPriority")||(this.options.sortPriority="passive"),this.options.hasOwnProperty("minRebuildInterval")||(this.options.minRebuildInterval=1),this.resultset=new P(t),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,this.events={rebuild:[]}}function I(e,r){this.name=e,this.data=[],this.idIndex=[],this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=e,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;var i=this;(r=r||{}).hasOwnProperty("unique")&&(Array.isArray(r.unique)||(r.unique=[r.unique]),r.unique.forEach(function(t){i.uniqueNames.push(t),i.constraints.unique[t]=new j(t)})),r.hasOwnProperty("exact")&&r.exact.forEach(function(t){i.constraints.exact[t]=new k(t)}),this.adaptiveBinaryIndices=!r.hasOwnProperty("adaptiveBinaryIndices")||r.adaptiveBinaryIndices,this.transactional=!!r.hasOwnProperty("transactional")&&r.transactional,this.cloneObjects=!!r.hasOwnProperty("clone")&&r.clone,this.cloneMethod=r.hasOwnProperty("cloneMethod")?r.cloneMethod:"parse-stringify",this.asyncListeners=!!r.hasOwnProperty("asyncListeners")&&r.asyncListeners,this.disableMeta=!!r.hasOwnProperty("disableMeta")&&r.disableMeta,this.disableChangesApi=!r.hasOwnProperty("disableChangesApi")||r.disableChangesApi,this.disableDeltaChangesApi=!r.hasOwnProperty("disableDeltaChangesApi")||r.disableDeltaChangesApi,this.disableChangesApi&&(this.disableDeltaChangesApi=!0),this.autoupdate=!!r.hasOwnProperty("autoupdate")&&r.autoupdate,this.serializableIndices=!r.hasOwnProperty("serializableIndices")||r.serializableIndices,this.ttl={age:null,ttlInterval:null,daemon:null},this.setTTL(r.ttl||-1,r.ttlInterval),this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],delete:[],warning:[]},this.changes=[],this.ensureId();var n=[];if(r&&r.indices)if("[object Array]"===Object.prototype.toString.call(r.indices))n=r.indices;else{if("string"!=typeof r.indices)throw new TypeError("Indices needs to be a string or an array of strings");n=[r.indices]}for(var o=0;o<n.length;o++)this.ensureIndex(n[o]);function s(t,e){var r=null!==e&&"object"==typeof e?Object.keys(e):null;if(r&&r.length&&["string","boolean","number"].indexOf(typeof e)<0){for(var n={},o=0;o<r.length;o++){var a=r[o];if(e.hasOwnProperty(a))if(!t.hasOwnProperty(a)||i.uniqueNames.indexOf(a)>=0||"$loki"==a||"meta"==a)n[a]=e[a];else{var l=s(t[a],e[a]);void 0!==l&&l!={}&&(n[a]=l)}}return 0===Object.keys(n).length?void 0:n}return t===e?void 0:e}function a(){i.changes=[]}this.observerCallback=function(e){var r="function"==typeof Set?new Set:[];r.add||(r.add=function(t){return-1===this.indexOf(t)&&this.push(t),this}),e.forEach(function(t){r.add(t.object)}),r.forEach(function(e){if(!t.call(e,"$loki"))return i.removeAutoUpdateObserver(e);try{i.update(e)}catch(t){}})},this.getChangeDelta=function(t,e){return e?s(e,t):JSON.parse(JSON.stringify(t))},this.getObjectDelta=s,this.getChanges=function(){return i.changes},this.flushChanges=a,this.setChangesApi=function(t){i.disableChangesApi=!t,t||(i.disableDeltaChangesApi=!1)},this.on("delete",function(t){i.disableChangesApi||i.createChange(i.name,"R",t)}),this.on("warning",function(t){i.console.warn(t)}),a()}function S(t){return-1!==t.indexOf(".")}function _(t){return parseFloat(t,10)}function $(t,e){return t+e}function A(t,e){return t-e}function T(t){return t.reduce($,0)/t.length}function x(t,e,r){if(!1===r)return t[e];for(var i=e.split("."),n=t;i.length>0;)n=n[i.shift()];return n}function C(t,e,r){for(var i,n,o=0,s=t.length;o<s;){if(n=o+s>>1,0===(i=r.apply(null,[e,t[n]])))return{found:!0,index:n};i<0?s=n:o=n+1}return{found:!1,index:s}}function D(t){return function(e,r){return C(e,r,t)}}function N(){}function j(t){this.field=t,this.keyMap={},this.lokiMap={}}function k(t){this.index={},this.field=t}return g.prototype.events={},g.prototype.asyncListeners=!1,g.prototype.on=function(t,e){var r,i=this;return Array.isArray(t)?(t.forEach(function(t){i.on(t,e)}),e):((r=this.events[t])||(r=this.events[t]=[]),r.push(e),e)},g.prototype.emit=function(t){var e=this,r=Array.prototype.slice.call(arguments,1);if(!t||!this.events[t])throw new Error("No event "+t+" defined");this.events[t].forEach(function(t){e.asyncListeners?setTimeout(function(){t.apply(e,r)},1):t.apply(e,r)})},g.prototype.addListener=g.prototype.on,g.prototype.removeListener=function(t,e){var r=this;if(Array.isArray(t))t.forEach(function(t){r.removeListener(t,e)});else if(this.events[t]){var i=this.events[t];i.splice(i.indexOf(e),1)}},v.prototype=new g,v.prototype.constructor=v,v.prototype.getIndexedAdapter=function(){return r(12)},v.prototype.configureOptions=function(t,e){var r={fs:O,localStorage:w,memory:b};if(this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,void 0!==t){if(this.options=t,this.options.hasOwnProperty("persistenceMethod")&&"function"==typeof r[t.persistenceMethod]&&(this.persistenceMethod=t.persistenceMethod,this.persistenceAdapter=new r[t.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=t.adapter,this.options.adapter=null),t.autoload&&e){var i=this;setTimeout(function(){i.loadDatabase(t,t.autoloadCallback)},1)}this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.options.hasOwnProperty("autosaveCallback")?this.autosaveEnable(t,t.autosaveCallback):this.autosaveEnable()),this.options.hasOwnProperty("throttledSaves")&&(this.throttledSaves=this.options.throttledSaves)}this.options.hasOwnProperty("serializationMethod")||(this.options.serializationMethod="normal"),this.options.hasOwnProperty("destructureDelimiter")||(this.options.destructureDelimiter="$<\n"),null===this.persistenceAdapter&&(this.persistenceMethod={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage",MEMORY:"memory"}[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new r[this.persistenceMethod]))},v.prototype.copy=function(t){var e,r,i=new v(this.filename,{env:"NA"});if(t=t||{},i.loadJSONObject(this,{retainDirtyFlags:!0}),t.hasOwnProperty("removeNonSerializable")&&!0===t.removeNonSerializable)for(i.autosaveHandle=null,i.persistenceAdapter=null,e=i.collections.length,r=0;r<e;r++)i.collections[r].constraints=null,i.collections[r].ttl=null;return i},v.prototype.addCollection=function(t,e){var r,i=this.collections.length;if(e&&!0===e.disableMeta){if(!1===e.disableChangesApi)throw new Error("disableMeta option cannot be passed as true when disableChangesApi is passed as false");if(!1===e.disableDeltaChangesApi)throw new Error("disableMeta option cannot be passed as true when disableDeltaChangesApi is passed as false");if("number"==typeof e.ttl&&e.ttl>0)throw new Error("disableMeta option cannot be passed as true when ttl is enabled")}for(r=0;r<i;r+=1)if(this.collections[r].name===t)return this.collections[r];var n=new I(t,e);return this.collections.push(n),this.verbose&&(n.console=console),n},v.prototype.loadCollection=function(t){if(!t.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(t)},v.prototype.getCollection=function(t){var e,r=this.collections.length;for(e=0;e<r;e+=1)if(this.collections[e].name===t)return this.collections[e];return this.emit("warning","collection "+t+" not found"),null},v.prototype.renameCollection=function(t,e){var r=this.getCollection(t);return r&&(r.name=e),r},v.prototype.listCollections=function(){for(var t=this.collections.length,e=[];t--;)e.push({name:this.collections[t].name,type:this.collections[t].objType,count:this.collections[t].data.length});return e},v.prototype.removeCollection=function(t){var e,r=this.collections.length;for(e=0;e<r;e+=1)if(this.collections[e].name===t){var i=new I(t,{}),n=this.collections[e];for(var o in n)n.hasOwnProperty(o)&&i.hasOwnProperty(o)&&(n[o]=i[o]);return void this.collections.splice(e,1)}},v.prototype.getName=function(){return this.name},v.prototype.serializeReplacer=function(t,e){switch(t){case"autosaveHandle":case"persistenceAdapter":case"constraints":case"ttl":return null;case"throttledSavePending":case"throttledCallbacks":return;default:return e}},v.prototype.serialize=function(t){switch((t=t||{}).hasOwnProperty("serializationMethod")||(t.serializationMethod=this.options.serializationMethod),t.serializationMethod){case"normal":return JSON.stringify(this,this.serializeReplacer);case"pretty":return JSON.stringify(this,this.serializeReplacer,2);case"destructured":return this.serializeDestructured();default:return JSON.stringify(this,this.serializeReplacer)}},v.prototype.toJson=v.prototype.serialize,v.prototype.serializeDestructured=function(t){var e,r,i,n,o,s=[];if((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),!0===t.partitioned&&t.hasOwnProperty("partition")&&t.partition>=0)return this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:t.partition});for((o=new v(this.filename)).loadJSONObject(this),e=0;e<o.collections.length;e++)o.collections[e].data=[];if(!0===t.partitioned&&-1===t.partition)return o.serialize({serializationMethod:"normal"});for(s.push(o.serialize({serializationMethod:"normal"})),o=null,e=0;e<this.collections.length;e++)if(i=this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:e}),!1===t.partitioned&&!1===t.delimited){if(!Array.isArray(i))throw new Error("a nondelimited, non partitioned collection serialization did not return an expected array");for(n=i.length,r=0;r<n;r++)s.push(i[r]),i[r]=null;s.push("")}else s.push(i);return t.partitioned?(t.delimited,s):t.delimited?(s.push(""),s.join(t.delimiter)):(s.push(""),s)},v.prototype.serializeCollection=function(t){var e,r,i=[];if((t=t||{}).hasOwnProperty("delimited")||(t.delimited=!0),!t.hasOwnProperty("collectionIndex"))throw new Error("serializeCollection called without 'collectionIndex' option");for(e=this.collections[t.collectionIndex].data.length,i=[],r=0;r<e;r++)i.push(JSON.stringify(this.collections[t.collectionIndex].data[r]));return t.delimited?(i.push(""),i.join(t.delimiter)):i},v.prototype.deserializeDestructured=function(t,e){var r,i,n,o=[],s=0,a=1,l=!1;if((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.partitioned){if(e.hasOwnProperty("partition"))return-1===e.partition?r=JSON.parse(t[0]):this.deserializeCollection(t[e.partition+1],e);for(r=JSON.parse(t[0]),i=r.collections.length,s=0;s<i;s++)r.collections[s].data=this.deserializeCollection(t[s+1],e);return r}if(e.delimited){if(o=t.split(e.delimiter),t=null,0===o.length)return null}else o=t;for(r=JSON.parse(o[0]),i=r.collections.length,o[0]=null;!l;)o[a],""===o[a]?++s>i&&(l=!0):(n=JSON.parse(o[a]),r.collections[s].data.push(n)),o[a++]=null;return r},v.prototype.deserializeCollection=function(t,e){var r,i,n=[];for((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.delimited?(n=t.split(e.delimiter)).pop():n=t,i=n.length,r=0;r<i;r++)n[r]=JSON.parse(n[r]);return n},v.prototype.loadJSON=function(t,e){var r;if(0===t.length)r={};else switch(this.options.serializationMethod){case"normal":case"pretty":r=JSON.parse(t);break;case"destructured":r=this.deserializeDestructured(t);break;default:r=JSON.parse(t)}this.loadJSONObject(r,e)},v.prototype.loadJSONObject=function(t,r){var i,n,o,s,a,l,c=0,h=t.collections?t.collections.length:0;function u(t){var i,n=r[t.name];return n.proto?(i=n.inflate||e.copyProperties,function(t){var e=new n.proto;return i(t,e),e}):n.inflate}for(this.name=t.name,t.hasOwnProperty("throttledSaves")&&r&&!r.hasOwnProperty("throttledSaves")&&(this.throttledSaves=t.throttledSaves),this.collections=[];c<h;c+=1){if(i=t.collections[c],(n=this.addCollection(i.name,{disableChangesApi:i.disableChangesApi,disableDeltaChangesApi:i.disableDeltaChangesApi,disableMeta:i.disableMeta})).adaptiveBinaryIndices=!!i.hasOwnProperty("adaptiveBinaryIndices")&&!0===i.adaptiveBinaryIndices,n.transactional=i.transactional,n.asyncListeners=i.asyncListeners,n.cloneObjects=i.cloneObjects,n.cloneMethod=i.cloneMethod||"parse-stringify",n.autoupdate=i.autoupdate,n.changes=i.changes,r&&!0===r.retainDirtyFlags?n.dirty=i.dirty:n.dirty=!1,o=i.data.length,s=0,r&&r.hasOwnProperty(i.name))for(a=u(i);s<o;s++)l=a(i.data[s]),n.data[s]=l,n.addAutoUpdateObserver(l);else for(;s<o;s++)n.data[s]=i.data[s],n.addAutoUpdateObserver(n.data[s]);if(n.maxId=void 0===i.maxId?0:i.maxId,n.idIndex=i.idIndex,void 0!==i.binaryIndices&&(n.binaryIndices=i.binaryIndices),void 0!==i.transforms&&(n.transforms=i.transforms),n.ensureId(),n.uniqueNames=[],i.hasOwnProperty("uniqueNames"))for(n.uniqueNames=i.uniqueNames,s=0;s<n.uniqueNames.length;s++)n.ensureUniqueIndex(n.uniqueNames[s]);if(void 0!==i.DynamicViews){for(var p=0;p<i.DynamicViews.length;p++){var d=i.DynamicViews[p],f=n.addDynamicView(d.name,d.options);f.resultdata=d.resultdata,f.resultsdirty=d.resultsdirty,f.filterPipeline=d.filterPipeline,f.sortCriteria=d.sortCriteria,f.sortFunction=null,f.sortDirty=d.sortDirty,f.resultset.filteredrows=d.resultset.filteredrows,f.resultset.filterInitialized=d.resultset.filterInitialized,f.rematerialize({removeWhereFilters:!0})}t.databaseVersion<1.5&&(n.ensureAllIndexes(!0),n.dirty=!0)}}},v.prototype.close=function(t){this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&(this.saveDatabase(t),t=void 0)),t&&this.on("close",t),this.emit("close")},v.prototype.generateChangesNotification=function(t){function e(t){return t.name}var r=[],i=t||this.collections.map(e);return this.collections.forEach(function(t){-1!==i.indexOf(e(t))&&(r=r.concat(t.getChanges()))}),r},v.prototype.serializeChanges=function(t){return JSON.stringify(this.generateChangesNotification(t))},v.prototype.clearChanges=function(){this.collections.forEach(function(t){t.flushChanges&&t.flushChanges()})},b.prototype.loadDatabase=function(t,e){var r=this;this.options.asyncResponses?setTimeout(function(){r.hashStore.hasOwnProperty(t)?e(r.hashStore[t].value):e(null)},this.options.asyncTimeout):this.hashStore.hasOwnProperty(t)?e(this.hashStore[t].value):e(null)},b.prototype.saveDatabase=function(t,e,r){var i,n=this;this.options.asyncResponses?setTimeout(function(){i=n.hashStore.hasOwnProperty(t)?n.hashStore[t].savecount:0,n.hashStore[t]={savecount:i+1,lastsave:new Date,value:e},r()},this.options.asyncTimeout):(i=this.hashStore.hasOwnProperty(t)?this.hashStore[t].savecount:0,this.hashStore[t]={savecount:i+1,lastsave:new Date,value:e},r())},b.prototype.deleteDatabase=function(t,e){this.hashStore.hasOwnProperty(t)&&delete this.hashStore[t],"function"==typeof e&&e()},E.prototype.loadDatabase=function(t,e){var r=this;this.dbname=t,this.dbref=new v(t),this.adapter.loadDatabase(t,function(t){if(t){"string"!=typeof t&&e(new Error("LokiPartitioningAdapter received an unexpected response from inner adapter loadDatabase()"));var i=JSON.parse(t);r.dbref.loadJSONObject(i),i=null,r.dbref.collections.length,0!==r.dbref.collections.length?(r.pageIterator={collection:0,pageIndex:0},r.loadNextPartition(0,function(){e(r.dbref)})):e(r.dbref)}else e(t)})},E.prototype.loadNextPartition=function(t,e){var r=this.dbname+"."+t,i=this;if(!0===this.options.paging)return this.pageIterator.pageIndex=0,void this.loadNextPage(e);this.adapter.loadDatabase(r,function(r){var n=i.dbref.deserializeCollection(r,{delimited:!0,collectionIndex:t});i.dbref.collections[t].data=n,++t<i.dbref.collections.length?i.loadNextPartition(t,e):e()})},E.prototype.loadNextPage=function(t){var e=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,r=this;this.adapter.loadDatabase(e,function(e){var i=e.split(r.options.delimiter);e="";var n,o=i.length,s=""===i[o-1];for(s&&(i.pop(),o=i.length,""===i[o-1]&&1===o&&(i.pop(),o=i.length)),n=0;n<o;n++)r.dbref.collections[r.pageIterator.collection].data.push(JSON.parse(i[n])),i[n]=null;i=[],s?++r.pageIterator.collection<r.dbref.collections.length?r.loadNextPartition(r.pageIterator.collection,t):t():(r.pageIterator.pageIndex++,r.loadNextPage(t))})},E.prototype.exportDatabase=function(t,e,r){var i,n=e.collections.length;for(this.dbref=e,this.dbname=t,this.dirtyPartitions=[-1],i=0;i<n;i++)e.collections[i].dirty&&this.dirtyPartitions.push(i);this.saveNextPartition(function(t){r(t)})},E.prototype.saveNextPartition=function(t){var e=this,r=this.dirtyPartitions.shift(),i=this.dbname+(-1===r?"":"."+r);if(this.options.paging&&-1!==r)return this.pageIterator={collection:r,docIndex:0,pageIndex:0},void this.saveNextPage(function(r){0===e.dirtyPartitions.length?t(r):e.saveNextPartition(t)});var n=this.dbref.serializeDestructured({partitioned:!0,delimited:!0,partition:r});this.adapter.saveDatabase(i,n,function(r){r?t(r):0===e.dirtyPartitions.length?t(null):e.saveNextPartition(t)})},E.prototype.saveNextPage=function(t){var e=this,r=this.dbref.collections[this.pageIterator.collection],i=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,n=0,o=r.data.length,s=this.options.delimiter.length,a="",l="",c=!1,h=!1,u=function(r){l="",r&&t(r),c?t(null):(e.pageIterator.pageIndex++,e.saveNextPage(t))};for(0===r.data.length&&(c=!0);;)if(c||(a=JSON.stringify(r.data[this.pageIterator.docIndex]),l+=a,n+=a.length,++this.pageIterator.docIndex>=o&&(c=!0)),n>=this.options.pageSize&&(h=!0),h&&!c||(l+=this.options.delimiter,n+=s),c||h)return void this.adapter.saveDatabase(i,l,u)},O.prototype.loadDatabase=function(t,e){var r=this;this.fs.stat(t,function(i,n){!i&&n.isFile()?r.fs.readFile(t,{encoding:"utf8"},function(t,r){e(t?new Error(t):r)}):e(null)})},O.prototype.saveDatabase=function(t,e,r){var i=this,n=t+"~";this.fs.writeFile(n,e,function(e){e?r(new Error(e)):i.fs.rename(n,t,r)})},O.prototype.deleteDatabase=function(t,e){this.fs.unlink(t,function(t){t?e(new Error(t)):e()})},w.prototype.loadDatabase=function(t,e){m()?e(localStorage.getItem(t)):e(new Error("localStorage is not available"))},w.prototype.saveDatabase=function(t,e,r){m()?(localStorage.setItem(t,e),r(null)):r(new Error("localStorage is not available"))},w.prototype.deleteDatabase=function(t,e){m()?(localStorage.removeItem(t),e(null)):e(new Error("localStorage is not available"))},v.prototype.throttledSaveDrain=function(t,e){var r=this,i=(new Date).getTime();if(this.throttledSaves||t(!0),(e=e||{}).hasOwnProperty("recursiveWait")||(e.recursiveWait=!0),e.hasOwnProperty("recursiveWaitLimit")||(e.recursiveWaitLimit=!1),e.hasOwnProperty("recursiveWaitLimitDuration")||(e.recursiveWaitLimitDuration=2e3),e.hasOwnProperty("started")||(e.started=(new Date).getTime()),this.throttledSaves&&this.throttledSavePending){if(!e.recursiveWait)return void this.throttledCallbacks.push(t);this.throttledCallbacks.push(function(){return r.throttledSavePending?e.recursiveWaitLimit&&i-e.started>e.recursiveWaitLimitDuration?void t(!1):void r.throttledSaveDrain(t,e):void t(!0)})}else t(!0)},v.prototype.loadDatabaseInternal=function(t,e){var r=e||function(t,e){if(t)throw t},i=this;null!==this.persistenceAdapter?this.persistenceAdapter.loadDatabase(this.filename,function(e){if("string"==typeof e){var n=!1;try{i.loadJSON(e,t||{}),n=!0}catch(t){r(t)}n&&(r(null),i.emit("loaded","database "+i.filename+" loaded"))}else{if(!e)return r(null),void i.emit("loaded","empty database "+i.filename+" loaded");if(e instanceof Error)return void r(e);if("object"==typeof e)return i.loadJSONObject(e,t||{}),r(null),void i.emit("loaded","database "+i.filename+" loaded");r("unexpected adapter response : "+e)}}):r(new Error("persistenceAdapter not configured"))},v.prototype.loadDatabase=function(t,e){var r=this;this.throttledSaves?this.throttledSaveDrain(function(i){if(i)return r.throttledSavePending=!0,void r.loadDatabaseInternal(t,function(t){0===r.throttledCallbacks.length?r.throttledSavePending=!1:r.saveDatabase(),"function"==typeof e&&e(t)});"function"==typeof e&&e(new Error("Unable to pause save throttling long enough to read database"))},t):this.loadDatabaseInternal(t,e)},v.prototype.saveDatabaseInternal=function(t){var e=t||function(t){if(t)throw t},r=this;null!==this.persistenceAdapter?"reference"===this.persistenceAdapter.mode&&"function"==typeof this.persistenceAdapter.exportDatabase?this.persistenceAdapter.exportDatabase(this.filename,this.copy({removeNonSerializable:!0}),function(t){r.autosaveClearFlags(),e(t)}):(r.autosaveClearFlags(),this.persistenceAdapter.saveDatabase(this.filename,r.serialize(),function(t){e(t)})):e(new Error("persistenceAdapter not configured"))},v.prototype.saveDatabase=function(t){if(this.throttledSaves)if(this.throttledSavePending)this.throttledCallbacks.push(t);else{var e=this.throttledCallbacks;this.throttledCallbacks=[],e.unshift(t),this.throttledSavePending=!0;var r=this;this.saveDatabaseInternal(function(t){r.throttledSavePending=!1,e.forEach(function(e){"function"==typeof e&&setTimeout(function(){e(t)},1)}),r.throttledCallbacks.length>0&&r.saveDatabase()})}else this.saveDatabaseInternal(t)},v.prototype.save=v.prototype.saveDatabase,v.prototype.deleteDatabase=function(t,e){var r=e||function(t,e){if(t)throw t};"function"!=typeof t||e||(r=t),null!==this.persistenceAdapter?this.persistenceAdapter.deleteDatabase(this.filename,function(t){r(t)}):r(new Error("persistenceAdapter not configured"))},v.prototype.autosaveDirty=function(){for(var t=0;t<this.collections.length;t++)if(this.collections[t].dirty)return!0;return!1},v.prototype.autosaveClearFlags=function(){for(var t=0;t<this.collections.length;t++)this.collections[t].dirty=!1},v.prototype.autosaveEnable=function(t,e){this.autosave=!0;var r=5e3,i=this;void 0!==this.autosaveInterval&&null!==this.autosaveInterval&&(r=this.autosaveInterval),this.autosaveHandle=setInterval(function(){i.autosaveDirty()&&i.saveDatabase(e)},r)},v.prototype.autosaveDisable=function(){void 0!==this.autosaveHandle&&null!==this.autosaveHandle&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)},P.prototype.reset=function(){return this.filteredrows.length>0&&(this.filteredrows=[]),this.filterInitialized=!1,this},P.prototype.toJSON=function(){var t=this.copy();return t.collection=null,t},P.prototype.limit=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new P(this.collection);return e.filteredrows=this.filteredrows.slice(0,t),e.filterInitialized=!0,e},P.prototype.offset=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new P(this.collection);return e.filteredrows=this.filteredrows.slice(t),e.filterInitialized=!0,e},P.prototype.copy=function(){var t=new P(this.collection);return this.filteredrows.length>0&&(t.filteredrows=this.filteredrows.slice()),t.filterInitialized=this.filterInitialized,t},P.prototype.branch=P.prototype.copy,P.prototype.transform=function(t,r){var i,n,o=this;if("string"==typeof t&&this.collection.transforms.hasOwnProperty(t)&&(t=this.collection.transforms[t]),"object"!=typeof t||!Array.isArray(t))throw new Error("Invalid transform");for(void 0!==r&&(t=e.resolveTransformParams(t,r)),i=0;i<t.length;i++)switch((n=t[i]).type){case"find":o.find(n.value);break;case"where":o.where(n.value);break;case"simplesort":o.simplesort(n.property,n.desc||n.options);break;case"compoundsort":o.compoundsort(n.value);break;case"sort":o.sort(n.value);break;case"limit":o=o.limit(n.value);break;case"offset":o=o.offset(n.value);break;case"map":o=o.map(n.value,n.dataOptions);break;case"eqJoin":o=o.eqJoin(n.joinData,n.leftJoinKey,n.rightJoinKey,n.mapFun,n.dataOptions);break;case"mapReduce":o=o.mapReduce(n.mapFunction,n.reduceFunction);break;case"update":o.update(n.value);break;case"remove":o.remove()}return o},P.prototype.sort=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e,r,i=(e=t,r=this.collection.data,function(t,i){return e(r[t],r[i])});return this.filteredrows.sort(i),this},P.prototype.simplesort=function(t,e){var r,i=10,n=this.collection.data.length,o=this.filteredrows.length,s=this.collection.binaryIndices.hasOwnProperty(t);if(void 0!==e&&!1!==e||(e={desc:!1}),!0===e&&(e={desc:!0}),0===o){if(this.filterInitialized)return this;if(this.collection.binaryIndices.hasOwnProperty(t))return this.collection.ensureIndex(t),this.filteredrows=this.collection.binaryIndices[t].values.slice(0),e.desc&&this.filteredrows.reverse(),this;this.filteredrows=this.collection.prepareFullDocIndex()}else if(!e.disableIndexIntersect&&s&&(r=n/o,e.useJavascriptSorting&&(i=6),r<=i||e.forceIndexIntersect)){var a,l=this.filteredrows,h={};for(a=0;a<o;a++)h[l[a]]=!0;var u=this.collection.binaryIndices[t].values;return this.filteredrows=u.filter(function(t){return h[t]}),e.desc&&this.filteredrows.reverse(),this}if(e.useJavascriptSorting)return this.sort(function(e,r){return e[t]===r[t]?0:e[t]>r[t]?1:e[t]<r[t]?-1:void 0});var p,d,f,y,m,g,v=(p=t,d=e.desc,f=this.collection.data,function(t,e){return~p.indexOf(".")?(g=p.split("."),y=g.reduce(function(t,e){return t&&t[e]||void 0},f[t]),m=g.reduce(function(t,e){return t&&t[e]||void 0},f[e])):(y=f[t][p],m=f[e][p]),c(y,m,d)});return this.filteredrows.sort(v),this},P.prototype.compoundsort=function(t){if(0===t.length)throw new Error("Invalid call to compoundsort, need at least one property");var e;if(1===t.length)return e=t[0],Array.isArray(e)?this.simplesort(e[0],e[1]):this.simplesort(e,!1);for(var r=0,i=t.length;r<i;r+=1)e=t[r],Array.isArray(e)||(t[r]=[e,!1]);this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var n,o,s=(n=t,o=this.collection.data,function(t,e){return function(t,e,r){for(var i,n,o,s,a,l=0,h=0,u=t.length;h<u;h++)if(i=t[h],~(n=i[0]).indexOf(".")?(a=n.split("."),o=a.reduce(function(t,e){return t&&t[e]||void 0},e),s=a.reduce(function(t,e){return t&&t[e]||void 0},r)):(o=e[n],s=r[n]),0!==(l=c(o,s,i[1])))return l;return 0}(n,o[t],o[e])});return this.filteredrows.sort(s),this},P.prototype.findOr=function(t){for(var e=null,r=0,i=0,n=[],o=[],s=0,a=this.count(),l=0,c=t.length;l<c;l++){if(e=this.branch().find(t[l]).filteredrows,(i=e.length)===a)return this;for(r=0;r<i;r++)s=e[r],void 0===o[s]&&(o[s]=!0,n.push(s))}return this.filteredrows=n,this.filterInitialized=!0,this},P.prototype.$or=P.prototype.findOr,P.prototype.findAnd=function(t){for(var e=0,r=t.length;e<r;e++){if(0===this.count())return this;this.find(t[e])}return this},P.prototype.$and=P.prototype.findAnd,P.prototype.find=function(e,r){if(0===this.collection.data.length)return this.filteredrows=[],this.filterInitialized=!0,this;var i,n,o,s,a,l,c,u=e||"getAll",p=!1,y=[],m=[],g=null;if(r=r||!1,"object"==typeof u){for(i in u)(s={})[i]=u[i],m.push(s),t.call(u,i)&&(n=i,o=u[i]);if(m.length>1)return this.find({$and:m},r)}if(!n||"getAll"===u)return r&&(this.filteredrows=this.collection.data.length>0?[0]:[],this.filterInitialized=!0),this;if("$and"===n||"$or"===n)return this[n](o),r&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this;if(null===o||"object"!=typeof o||o instanceof Date)a="$eq",l=o;else{if("object"!=typeof o)throw new Error("Do not know what you want to do.");for(c in o)if(t.call(o,c)){a=c,l=o[c];break}}"$regex"===a&&(Array.isArray(l)?l=new RegExp(l[0],l[1]):l instanceof RegExp||(l=new RegExp(l)));var v=-1!==n.indexOf("."),b=!v&&!this.filterInitialized;b&&this.collection.binaryIndices[n]&&f[a]&&(!0!==this.collection.adaptiveBinaryIndices&&this.collection.ensureIndex(n),p=!0,g=this.collection.binaryIndices[n]);var E,O=d[a],w=this.collection.data,P=0,R=0,I=0;if(this.filterInitialized)if(E=this.filteredrows,R=E.length,v)for(n=n.split("."),P=0;P<R;P++)I=E[P],h(w[I],n,O,l)&&y.push(I);else for(P=0;P<R;P++)I=E[P],O(w[I][n],l)&&y.push(I);else if(p){var S=this.collection.calculateRange(a,n,l);if("$in"!==a){for(P=S[0];P<=S[1];P++)if(!0!==f[a]){if(f[a](w[g.values[P]][n],l)&&(y.push(g.values[P]),r))return this.filteredrows=y,this.filterInitialized=!0,this}else if(y.push(g.values[P]),r)return this.filteredrows=y,this.filterInitialized=!0,this}else for(P=0,R=S.length;P<R;P++)if(y.push(g.values[S[P]]),r)return this.filteredrows=y,this.filterInitialized=!0,this}else if(R=w.length,v){for(n=n.split("."),P=0;P<R;P++)if(h(w[P],n,O,l)&&(y.push(P),r))return this.filteredrows=y,this.filterInitialized=!0,this}else for(P=0;P<R;P++)if(O(w[P][n],l)&&(y.push(P),r))return this.filteredrows=y,this.filterInitialized=!0,this;return this.filteredrows=y,this.filterInitialized=!0,this},P.prototype.where=function(t){var e,r=[];if("function"!=typeof t)throw new TypeError("Argument is not a stored view or a function");e=t;try{if(this.filterInitialized){for(var i=this.filteredrows.length;i--;)!0===e(this.collection.data[this.filteredrows[i]])&&r.push(this.filteredrows[i]);return this.filteredrows=r,this}for(var n=this.collection.data.length;n--;)!0===e(this.collection.data[n])&&r.push(n);return this.filteredrows=r,this.filterInitialized=!0,this}catch(t){throw t}},P.prototype.count=function(){return this.filterInitialized?this.filteredrows.length:this.collection.count()},P.prototype.data=function(t){var e,r,i,n,o=[],s=this.collection.data;if((t=t||{}).removeMeta&&!t.forceClones&&(t.forceClones=!0,t.forceCloneMethod=t.forceCloneMethod||"shallow"),this.collection.disableDeltaChangesApi||(t.forceClones=!0,t.forceCloneMethod="parse-stringify"),!this.filterInitialized){if(0===this.filteredrows.length){if(this.collection.cloneObjects||t.forceClones){for(r=s.length,n=t.forceCloneMethod||this.collection.cloneMethod,i=0;i<r;i++)e=y(s[i],n),t.removeMeta&&(delete e.$loki,delete e.meta),o.push(e);return o}return s.slice()}this.filterInitialized=!0}var a=this.filteredrows;if(r=a.length,this.collection.cloneObjects||t.forceClones)for(n=t.forceCloneMethod||this.collection.cloneMethod,i=0;i<r;i++)e=y(s[a[i]],n),t.removeMeta&&(delete e.$loki,delete e.meta),o.push(e);else for(i=0;i<r;i++)o.push(s[a[i]]);return o},P.prototype.update=function(t){if("function"!=typeof t)throw new TypeError("Argument is not a function");this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());for(var e,r=this.filteredrows.length,i=this.collection.data,n=0;n<r;n++)this.collection.cloneObjects||!this.collection.disableDeltaChangesApi?(e=y(i[this.filteredrows[n]],this.collection.cloneMethod),t(e),this.collection.update(e)):(t(i[this.filteredrows[n]]),this.collection.update(i[this.filteredrows[n]]));return this},P.prototype.remove=function(){return this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex()),this.collection.removeBatchByPositions(this.filteredrows),this.filteredrows=[],this},P.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(t){throw t}},P.prototype.eqJoin=function(t,e,r,i,n){var o,s,a,l=[],c=[],h=[],u="function"==typeof e,p="function"==typeof r,d={};if(l=this.data(n),o=l.length,t instanceof I)c=t.chain().data(n);else if(t instanceof P)c=t.data(n);else{if(!Array.isArray(t))throw new TypeError("joinData needs to be an array or result set");c=t}s=c.length;for(var f=0;f<s;f++)a=p?r(c[f]):c[f][r],d[a]=c[f];i||(i=function(t,e){return{left:t,right:e}});for(var y=0;y<o;y++)a=u?e(l[y]):l[y][e],h.push(i(l[y],d[a]||{}));return this.collection=new I("joinData"),this.collection.insert(h),this.filteredrows=[],this.filterInitialized=!1,this},P.prototype.map=function(t,e){var r=this.data(e).map(t);return this.collection=new I("mappedData"),this.collection.insert(r),this.filteredrows=[],this.filterInitialized=!1,this},R.prototype=new g,R.prototype.rematerialize=function(t){var e,r,i;if(t=t||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new P(this.collection),(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple)&&(this.sortDirty=!0),t.hasOwnProperty("removeWhereFilters"))for(e=this.filterPipeline.length,r=e;r--;)"where"===this.filterPipeline[r].type&&(r!==this.filterPipeline.length-1&&(this.filterPipeline[r]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);var n=this.filterPipeline;for(this.filterPipeline=[],e=n.length,i=0;i<e;i++)this.applyFind(n[i].val);return this.data(),this.emit("rebuild",this),this},R.prototype.branchResultset=function(t,e){var r=this.resultset.branch();return void 0===t?r:r.transform(t,e)},R.prototype.toJSON=function(){var t=new R(this.collection,this.name,this.options);return t.resultset=this.resultset,t.resultdata=[],t.resultsdirty=!0,t.filterPipeline=this.filterPipeline,t.sortFunction=this.sortFunction,t.sortCriteria=this.sortCriteria,t.sortCriteriaSimple=this.sortCriteriaSimple||null,t.sortDirty=this.sortDirty,t.collection=null,t},R.prototype.removeFilters=function(t){t=t||{},this.rebuildPending=!1,this.resultset.reset(),this.resultdata=[],this.resultsdirty=!0,this.cachedresultset=null,this.filterPipeline=[],this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,!0===t.queueSortPhase&&this.queueSortPhase()},R.prototype.applySort=function(t){return this.sortFunction=t,this.sortCriteria=null,this.sortCriteriaSimple=null,this.queueSortPhase(),this},R.prototype.applySimpleSort=function(t,e){return this.sortCriteriaSimple={propname:t,options:e||!1},this.sortCriteria=null,this.sortFunction=null,this.queueSortPhase(),this},R.prototype.applySortCriteria=function(t){return this.sortCriteria=t,this.sortCriteriaSimple=null,this.sortFunction=null,this.queueSortPhase(),this},R.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},R.prototype.commit=function(){return this.cachedresultset=null,this},R.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},R.prototype._indexOfFilterWithId=function(t){if("string"==typeof t||"number"==typeof t)for(var e=0,r=this.filterPipeline.length;e<r;e+=1)if(t===this.filterPipeline[e].uid)return e;return-1},R.prototype._addFilter=function(t){this.filterPipeline.push(t),this.resultset[t.type](t.val)},R.prototype.reapplyFilters=function(){this.resultset.reset(),this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0);var t=this.filterPipeline;this.filterPipeline=[];for(var e=0,r=t.length;e<r;e+=1)this._addFilter(t[e]);return this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this},R.prototype.applyFilter=function(t){var e=this._indexOfFilterWithId(t.uid);return e>=0?(this.filterPipeline[e]=t,this.reapplyFilters()):(this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0),this._addFilter(t),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this)},R.prototype.applyFind=function(t,e){return this.applyFilter({type:"find",val:t,uid:e}),this},R.prototype.applyWhere=function(t,e){return this.applyFilter({type:"where",val:t,uid:e}),this},R.prototype.removeFilter=function(t){var e=this._indexOfFilterWithId(t);if(e<0)throw new Error("Dynamic view does not contain a filter with ID: "+t);return this.filterPipeline.splice(e,1),this.reapplyFilters(),this},R.prototype.count=function(){return this.resultsdirty&&(this.resultdata=this.resultset.data()),this.resultset.count()},R.prototype.data=function(t){return(this.sortDirty||this.resultsdirty)&&this.performSortPhase({suppressRebuildEvent:!0}),this.options.persistent?this.resultdata:this.resultset.data(t)},R.prototype.queueRebuildEvent=function(){if(!this.rebuildPending){this.rebuildPending=!0;var t=this;setTimeout(function(){t.rebuildPending&&(t.rebuildPending=!1,t.emit("rebuild",t))},this.options.minRebuildInterval)}},R.prototype.queueSortPhase=function(){if(!this.sortDirty){this.sortDirty=!0;var t=this;"active"===this.options.sortPriority?setTimeout(function(){t.performSortPhase()},this.options.minRebuildInterval):this.queueRebuildEvent()}},R.prototype.performSortPhase=function(t){(this.sortDirty||this.resultsdirty)&&(t=t||{},this.sortDirty&&(this.sortFunction?this.resultset.sort(this.sortFunction):this.sortCriteria?this.resultset.compoundsort(this.sortCriteria):this.sortCriteriaSimple&&this.resultset.simplesort(this.sortCriteriaSimple.propname,this.sortCriteriaSimple.options),this.sortDirty=!1),this.options.persistent&&(this.resultdata=this.resultset.data(),this.resultsdirty=!1),t.suppressRebuildEvent||this.emit("rebuild",this))},R.prototype.evaluateDocument=function(t,e){if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var r,i=this.resultset.filteredrows,n=e?-1:i.indexOf(+t),o=i.length,s=new P(this.collection);s.filteredrows=[t],s.filterInitialized=!0;for(var a=0,l=this.filterPipeline.length;a<l;a++)r=this.filterPipeline[a],s[r.type](r.val);var c=0===s.filteredrows.length?-1:0;return-1!==n||-1!==c?-1===n&&-1!==c?(i.push(t),this.options.persistent&&this.resultdata.push(this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==n&&-1===c?(n<o-1?(i.splice(n,1),this.options.persistent&&this.resultdata.splice(n,1)):(i.length=o-1,this.options.persistent&&(this.resultdata.length=o-1)),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==n&&-1!==c?(this.options.persistent&&(this.resultdata[n]=this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):void 0:void 0},R.prototype.removeDocument=function(t){var e,r,i,n={},o={},s=[],a=this.resultset,l=this.resultset.filteredrows,c=l.length;if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());for(Array.isArray(t)||(t=[t]),i=t.length,r=0;r<i;r++)n[t[r]]=!0;for(e=0;e<c;e++)n[l[e]]&&(o[e]=!0);Object.keys(o).length>0&&(this.resultset.filteredrows=this.resultset.filteredrows.filter(function(t,e){return!o[e]}),this.options.persistent&&(this.resultdata=this.resultdata.filter(function(t,e){return!o[e]})),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var h=function(t){return function(e){return e<a.filteredrows[t]}};for(c=a.filteredrows.length,e=0;e<c;e++)s=t.filter(h(e)),a.filteredrows[e]-=s.length},R.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(t){throw t}},I.prototype=new g,I.prototype.createChange=function(t,e,r,i){this.changes.push({name:t,operation:e,obj:"U"!=e||this.disableDeltaChangesApi?JSON.parse(JSON.stringify(r)):this.getChangeDelta(r,i)})},I.prototype.insertMeta=function(t){var e,r;if(!this.disableMeta&&t)if(Array.isArray(t))for(e=t.length,r=0;r<e;r++)t[r].hasOwnProperty("meta")||(t[r].meta={}),t[r].meta.created=(new Date).getTime(),t[r].meta.revision=0;else t.meta||(t.meta={}),t.meta.created=(new Date).getTime(),t.meta.revision=0},I.prototype.updateMeta=function(t){!this.disableMeta&&t&&(t.meta.updated=(new Date).getTime(),t.meta.revision+=1)},I.prototype.createInsertChange=function(t){this.createChange(this.name,"I",t)},I.prototype.createUpdateChange=function(t,e){this.createChange(this.name,"U",t,e)},I.prototype.insertMetaWithChange=function(t){this.insertMeta(t),this.createInsertChange(t)},I.prototype.updateMetaWithChange=function(t,e){this.updateMeta(t),this.createUpdateChange(t,e)},I.prototype.console={log:function(){},warn:function(){},error:function(){}},I.prototype.addAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.observe(t,this.observerCallback,["add","update","delete","reconfigure","setPrototype"])},I.prototype.removeAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.unobserve(t,this.observerCallback)},I.prototype.addTransform=function(t,e){if(this.transforms.hasOwnProperty(t))throw new Error("a transform by that name already exists");this.transforms[t]=e},I.prototype.getTransform=function(t){return this.transforms[t]},I.prototype.setTransform=function(t,e){this.transforms[t]=e},I.prototype.removeTransform=function(t){delete this.transforms[t]},I.prototype.byExample=function(t){var e,r,i;for(e in i=[],t)t.hasOwnProperty(e)&&i.push(((r={})[e]=t[e],r));return{$and:i}},I.prototype.findObject=function(t){return this.findOne(this.byExample(t))},I.prototype.findObjects=function(t){return this.find(this.byExample(t))},I.prototype.ttlDaemonFuncGen=function(){var t=this,e=this.ttl.age;return function(){var r=Date.now(),i=t.chain().where(function(t){var i=t.meta.updated||t.meta.created,n=r-i;return e<n});i.remove()}},I.prototype.setTTL=function(t,e){t<0?clearInterval(this.ttl.daemon):(this.ttl.age=t,this.ttl.ttlInterval=e,this.ttl.daemon=setInterval(this.ttlDaemonFuncGen(),e))},I.prototype.prepareFullDocIndex=function(){for(var t=this.data.length,e=new Array(t),r=0;r<t;r+=1)e[r]=r;return e},I.prototype.configureOptions=function(t){(t=t||{}).hasOwnProperty("adaptiveBinaryIndices")&&(this.adaptiveBinaryIndices=t.adaptiveBinaryIndices,this.adaptiveBinaryIndices&&this.ensureAllIndexes())},I.prototype.ensureIndex=function(t,e){if(void 0===e&&(e=!1),null===t||void 0===t)throw new Error("Attempting to set index without an associated property");if((!this.binaryIndices[t]||e||this.binaryIndices[t].dirty)&&(!0!==this.adaptiveBinaryIndices||!this.binaryIndices.hasOwnProperty(t)||e)){var r={name:t,dirty:!0,values:this.prepareFullDocIndex()};this.binaryIndices[t]=r;var i,n,s,a,l,c=(i=t,n=this.data,function(t,e){if(~i.indexOf(".")?(l=i.split("."),s=l.reduce(function(t,e){return t&&t[e]||void 0},n[t]),a=l.reduce(function(t,e){return t&&t[e]||void 0},n[e])):(s=n[t][i],a=n[e][i]),s!==a){if(o.lt(s,a,!1))return-1;if(o.gt(s,a,!1))return 1}return 0});r.values.sort(c),r.dirty=!1,this.dirty=!0}},I.prototype.checkAllIndexes=function(e){var r,i=this.binaryIndices,n=[];for(r in i)t.call(i,r)&&(this.checkIndex(r,e)||n.push(r));return n},I.prototype.checkIndex=function(t,e){(e=e||{}).randomSamplingFactor&&!1!==e.randomSampling&&(e.randomSampling=!0),e.randomSamplingFactor=e.randomSamplingFactor||.1,(e.randomSamplingFactor<0||e.randomSamplingFactor>1)&&(e.randomSamplingFactor=.1);var r,i,n,o,s,a=!0;if(!this.binaryIndices.hasOwnProperty(t))throw new Error("called checkIndex on property without an index: "+t);if(this.adaptiveBinaryIndices||this.ensureIndex(t),s=this.binaryIndices[t].values,(o=s.length)!==this.data.length)return e.repair&&this.ensureIndex(t,!0),!1;if(0===o)return!0;if(1===o)a=0===s[0];else if(e.randomSampling){if(d.$lte(this.data[s[0]][t],this.data[s[1]][t])||(a=!1),d.$lte(this.data[s[o-2]][t],this.data[s[o-1]][t])||(a=!1),a)for(i=Math.floor((o-1)*e.randomSamplingFactor),r=0;r<i-1;r++)if(n=Math.floor(Math.random()*(o-1)),!d.$lte(this.data[s[n]][t],this.data[s[n+1]][t])){a=!1;break}}else for(r=0;r<o-1;r++)if(!d.$lte(this.data[s[r]][t],this.data[s[r+1]][t])){a=!1;break}return!a&&e.repair&&this.ensureIndex(t,!0),a},I.prototype.getBinaryIndexValues=function(t){var e,r=this.binaryIndices[t].values,i=[];for(e=0;e<r.length;e++)i.push(this.data[r[e]][t]);return i},I.prototype.ensureUniqueIndex=function(t){var e=this.constraints.unique[t];return e||-1==this.uniqueNames.indexOf(t)&&this.uniqueNames.push(t),this.constraints.unique[t]=e=new j(t),this.data.forEach(function(t){e.set(t)}),e},I.prototype.ensureAllIndexes=function(e){var r,i=this.binaryIndices;for(r in i)t.call(i,r)&&this.ensureIndex(r,e)},I.prototype.flagBinaryIndexesDirty=function(){var e,r=this.binaryIndices;for(e in r)t.call(r,e)&&(r[e].dirty=!0)},I.prototype.flagBinaryIndexDirty=function(t){this.binaryIndices[t]&&(this.binaryIndices[t].dirty=!0)},I.prototype.count=function(t){return t?this.chain().find(t).filteredrows.length:this.data.length},I.prototype.ensureId=function(){var t=this.data.length,e=0;for(this.idIndex=[];e<t;e+=1)this.idIndex.push(this.data[e].$loki)},I.prototype.ensureIdAsync=function(t){this.async(function(){this.ensureId()},t)},I.prototype.addDynamicView=function(t,e){var r=new R(this,t,e);return this.DynamicViews.push(r),r},I.prototype.removeDynamicView=function(t){for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].name===t&&this.DynamicViews.splice(e,1)},I.prototype.getDynamicView=function(t){for(var e=0;e<this.DynamicViews.length;e++)if(this.DynamicViews[e].name===t)return this.DynamicViews[e];return null},I.prototype.findAndUpdate=function(t,e){"function"==typeof t?this.updateWhere(t,e):this.chain().find(t).update(e)},I.prototype.findAndRemove=function(t){this.chain().find(t).remove()},I.prototype.insert=function(t){if(!Array.isArray(t))return this.insertOne(t);var e,r=[];this.emit("pre-insert",t);for(var i=0,n=t.length;i<n;i++){if(!(e=this.insertOne(t[i],!0)))return;r.push(e)}return this.emit("insert",r),1===(r=this.cloneObjects?y(r,this.cloneMethod):r).length?r[0]:r},I.prototype.insertOne=function(t,e){var r,i=null;if("object"!=typeof t?i=new TypeError("Document needs to be an object"):null===t&&(i=new TypeError("Object cannot be null")),null!==i)throw this.emit("error",i),i;var n=this.cloneObjects?y(t,this.cloneMethod):t;if(this.disableMeta||void 0!==n.meta||(n.meta={revision:0,created:0}),e||this.emit("pre-insert",n),this.add(n))return this.disableChangesApi?this.insertMeta(n):this.insertMetaWithChange(n),r=this.cloneObjects?y(n,this.cloneMethod):n,e||this.emit("insert",r),this.addAutoUpdateObserver(r),r},I.prototype.clear=function(t){var e=this;if(t=t||{},this.data=[],this.idIndex=[],this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0,!0===t.removeIndices)this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[];else{var r=Object.keys(this.binaryIndices);r.forEach(function(t){e.binaryIndices[t].dirty=!1,e.binaryIndices[t].values=[]}),this.constraints={unique:{},exact:{}},this.uniqueNames.forEach(function(t){e.ensureUniqueIndex(t)})}},I.prototype.update=function(e){var r,i,n;if(Array.isArray(e)){n=e.length,(r=!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0)&&(this.adaptiveBinaryIndices=!1);try{for(i=0;i<n;i+=1)this.update(e[i])}finally{r&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}}else{if(!t.call(e,"$loki"))throw new Error("Trying to update unsynced document. Please save the document first by using insert() or addMany()");try{this.startTransaction();var o,s,a,l,c,h=this.get(e.$loki,!0),u=this;if(!h)throw new Error("Trying to update a document not in collection.");o=h[0],a=h[1],s=this.cloneObjects||!this.disableDeltaChangesApi?y(e,this.cloneMethod):e,this.emit("pre-update",e),Object.keys(this.constraints.unique).forEach(function(t){u.constraints.unique[t].update(o,s)}),this.data[a]=s,s!==e&&this.addAutoUpdateObserver(e);for(var p=0;p<this.DynamicViews.length;p++)this.DynamicViews[p].evaluateDocument(a,!1);if(this.adaptiveBinaryIndices){var d=this.binaryIndices;for(l in d)this.adaptiveBinaryIndexUpdate(a,l)}else this.flagBinaryIndexesDirty();return this.idIndex[a]=s.$loki,this.commit(),this.dirty=!0,this.disableChangesApi?this.updateMeta(s,null):this.updateMetaWithChange(s,o),c=this.cloneObjects?y(s,this.cloneMethod):s,this.emit("update",c,o),c}catch(t){throw this.rollback(),this.console.error(t.message),this.emit("error",t),t}}},I.prototype.add=function(e){if("object"!=typeof e)throw new TypeError("Object being added needs to be an object");if(void 0!==e.$loki)throw new Error("Document is already in collection, please use update()");try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1),e.$loki=this.maxId,this.disableMeta||(e.meta.version=0);var r,i=this.constraints.unique;for(r in i)t.call(i,r)&&i[r].set(e);this.idIndex.push(e.$loki),this.data.push(e);for(var n=this.data.length-1,o=this.DynamicViews.length,s=0;s<o;s++)this.DynamicViews[s].evaluateDocument(n,!0);if(this.adaptiveBinaryIndices){var a=this.binaryIndices;for(r in a)this.adaptiveBinaryIndexInsert(n,r)}else this.flagBinaryIndexesDirty();return this.commit(),this.dirty=!0,this.cloneObjects?y(e,this.cloneMethod):e}catch(t){throw this.rollback(),this.console.error(t.message),this.emit("error",t),t}},I.prototype.updateWhere=function(t,e){var r,i=this.where(t),n=0;try{for(;n<i.length;n++)r=e(i[n]),this.update(r)}catch(t){this.rollback(),this.console.error(t.message)}},I.prototype.removeWhere=function(t){var e;"function"==typeof t?(e=this.data.filter(t),this.remove(e)):this.chain().find(t).remove()},I.prototype.removeDataOnly=function(){this.remove(this.data.slice())},I.prototype.removeBatchByPositions=function(t){var e,r,i,n=t.length,o={},s=Object.keys(this.binaryIndices).length,a=this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0;try{for(this.startTransaction(),i=0;i<n;i++)o[this.idIndex[t[i]]]=!0;if((e=this.DynamicViews.length)>0||s>0){if(e>0)for(r=0;r<e;r++)this.DynamicViews[r].removeDocument(t);if(this.adaptiveBinaryIndices&&!a){var l,c=this.binaryIndices;for(l in c)this.adaptiveBinaryIndexRemove(t,l)}else this.flagBinaryIndexesDirty()}if(!this.disableChangesApi||this.events.delete.length>1)for(i=0;i<n;i++)this.emit("delete",this.data[t[i]]);this.data=this.data.filter(function(t){return!o[t.$loki]}),this.idIndex=this.idIndex.filter(function(t){return!o[t]}),this.adaptiveBinaryIndices&&a&&(this.adaptiveBinaryIndices=!1,this.ensureAllIndexes(!0),this.adaptiveBinaryIndices=!0),this.commit(),this.dirty=!0}catch(t){return this.rollback(),a&&(this.adaptiveBinaryIndices=!0),this.console.error(t.message),this.emit("error",t),null}},I.prototype.removeBatch=function(t){var e,r=t.length,i=this.data.length,n={},o=[];for(e=0;e<i;e++)n[this.data[e].$loki]=e;for(e=0;e<r;e++)"object"==typeof t[e]?o.push(n[t[e].$loki]):o.push(n[t[e]]);this.removeBatchByPositions(o)},I.prototype.remove=function(e){if("number"==typeof e&&(e=this.get(e)),"object"!=typeof e)throw new Error("Parameter is not an object");if(Array.isArray(e))this.removeBatch(e);else{if(!t.call(e,"$loki"))throw new Error("Object is not a document stored in the collection");try{this.startTransaction();var r=this.get(e.$loki,!0),i=r[1],n=this;Object.keys(this.constraints.unique).forEach(function(t){null!==e[t]&&void 0!==e[t]&&n.constraints.unique[t].remove(e[t])});for(var o=0;o<this.DynamicViews.length;o++)this.DynamicViews[o].removeDocument(i);if(this.adaptiveBinaryIndices){var s,a=this.binaryIndices;for(s in a)this.adaptiveBinaryIndexRemove(i,s)}else this.flagBinaryIndexesDirty();return this.data.splice(i,1),this.removeAutoUpdateObserver(e),this.idIndex.splice(i,1),this.commit(),this.dirty=!0,this.emit("delete",r[0]),delete e.$loki,delete e.meta,e}catch(t){return this.rollback(),this.console.error(t.message),this.emit("error",t),null}}},I.prototype.get=function(t,e){var r=e||!1,i=this.idIndex,n=i.length-1,o=0,s=o+n>>1;if(t="number"==typeof t?t:parseInt(t,10),isNaN(t))throw new TypeError("Passed id is not an integer");for(;i[o]<i[n];)i[s=o+n>>1]<t?o=s+1:n=s;return n===o&&i[o]===t?r?[this.data[o],o]:this.data[o]:null},I.prototype.getBinaryIndexPosition=function(t,e){var r=this.data[t][e],i=this.binaryIndices[e].values,n=this.calculateRange("$eq",e,r);if(0===n[0]&&-1===n[1])return null;for(var o=n[0],s=n[1],a=o;a<=s;a++)if(i[a]===t)return a;return null},I.prototype.adaptiveBinaryIndexInsert=function(t,e){var r=this.binaryIndices[e].values,i=this.data[t][e];!0===this.serializableIndices&&i instanceof Date&&(this.data[t][e]=i.getTime(),i=this.data[t][e]);var n=0===r.length?0:this.calculateRangeStart(e,i,!0);this.binaryIndices[e].values.splice(n,0,t)},I.prototype.adaptiveBinaryIndexUpdate=function(t,e){var r,i=this.binaryIndices[e].values,n=i.length;for(r=0;r<n&&i[r]!==t;r++);this.binaryIndices[e].values.splice(r,1),this.adaptiveBinaryIndexInsert(t,e)},I.prototype.adaptiveBinaryIndexRemove=function(t,e,r){var i,n,o,s,a,l,c,h=this.binaryIndices[e],u={};if(Array.isArray(t)){if(1!==(s=t.length)){for(o=0;o<s;o++)u[t[o]]=!0;if(h.values=h.values.filter(function(t){return!u[t]}),!0===r)return;var p=t.slice();for(p.sort(function(t,e){return t-e}),i=h.values.length,n=0;n<i;n++){for(a=h.values[n],l=0,o=0;o<s&&a>p[o];o++)l++;h.values[n]-=l}return}t=t[0]}if(null===(c=this.getBinaryIndexPosition(t,e)))return null;if(h.values.splice(c,1),!0!==r)for(i=h.values.length,n=0;n<i;n++)h.values[n]>t&&h.values[n]--},I.prototype.calculateRangeStart=function(t,e,r){var i=this.data,n=this.binaryIndices[t].values,s=0,a=n.length-1,l=0;if(0===n.length)return-1;for(i[n[s]][t],i[n[a]][t];s<a;)l=s+a>>1,o.lt(i[n[l]][t],e,!1)?s=l+1:a=l;var c=s;return o.aeq(e,i[n[c]][t])?c:o.lt(e,i[n[c]][t],!1)?r?c:c-1:r?c+1:c},I.prototype.calculateRangeEnd=function(t,e){var r=this.data,i=this.binaryIndices[t].values,n=0,s=i.length-1,a=0;if(0===i.length)return-1;for(r[i[n]][t],r[i[s]][t];n<s;)a=n+s>>1,o.lt(e,r[i[a]][t],!1)?s=a:n=a+1;var l=s;return o.aeq(e,r[i[l]][t])?l:o.gt(e,r[i[l]][t],!1)?l+1:o.aeq(e,r[i[l-1]][t])?l-1:l},I.prototype.calculateRange=function(t,e,r){var i,n,s,a=this.data,l=this.binaryIndices[e].values,c=l.length-1;if(0===a.length)return[0,-1];var h=a[l[0]][e],u=a[l[c]][e];switch(t){case"$eq":case"$aeq":case"$dteq":if(o.lt(r,h,!1)||o.gt(r,u,!1))return[0,-1];break;case"$gt":if(o.gt(r,u,!0))return[0,-1];if(o.gt(h,r,!1))return[0,c];break;case"$gte":if(o.gt(r,u,!1))return[0,-1];if(o.gt(h,r,!0))return[0,c];break;case"$lt":if(o.lt(r,h,!0))return[0,-1];if(o.lt(u,r,!1))return[0,c];break;case"$lte":if(o.lt(r,h,!1))return[0,-1];if(o.lt(u,r,!0))return[0,c];break;case"$between":return o.gt(r[0],u,!1)?[0,-1]:o.lt(r[1],h,!1)?[0,-1]:(i=this.calculateRangeStart(e,r[0]),s=this.calculateRangeEnd(e,r[1]),i<0&&i++,s>c&&s--,o.gt(a[l[i]][e],r[0],!0)||i++,o.lt(a[l[s]][e],r[1],!0)||s--,s<i?[0,-1]:[i,s]);case"$in":for(var p=[],d=[],f=0,y=r.length;f<y;f++)for(var m=this.calculateRange("$eq",e,r[f]),g=m[0];g<=m[1];g++)void 0===p[g]&&(p[g]=!0,d.push(g));return d}switch(t){case"$eq":case"$aeq":case"$dteq":case"$gte":case"$lt":i=this.calculateRangeStart(e,r),n=a[l[i]][e]}switch(t){case"$eq":case"$aeq":case"$dteq":case"$lte":case"$gt":s=this.calculateRangeEnd(e,r),a[l[s]][e]}switch(t){case"$eq":case"$aeq":case"$dteq":return o.aeq(n,r)?[i,s]:[0,-1];case"$gt":return o.aeq(a[l[s]][e],r)?[s+1,c]:[s,c];case"$gte":return o.aeq(a[l[i]][e],r)?[i,c]:[i+1,c];case"$lt":return o.aeq(a[l[i]][e],r)?[0,i-1]:[0,i];case"$lte":return o.aeq(a[l[s]][e],r)?[0,s]:[0,s-1];default:return[0,a.length-1]}},I.prototype.by=function(t,e){var r;if(void 0===e)return r=this,function(e){return r.by(t,e)};var i=this.constraints.unique[t].get(e);return this.cloneObjects?y(i,this.cloneMethod):i},I.prototype.findOne=function(t){t=t||{};var e=this.chain().find(t,!0).data();return Array.isArray(e)&&0===e.length?null:this.cloneObjects?y(e[0],this.cloneMethod):e[0]},I.prototype.chain=function(t,e){var r=new P(this);return void 0===t?r:r.transform(t,e)},I.prototype.find=function(t){return this.chain().find(t).data()},I.prototype.findOneUnindexed=function(t,e){for(var r=this.data.length;r--;)if(this.data[r][t]===e)return this.data[r];return null},I.prototype.startTransaction=function(){if(this.transactional){this.cachedData=y(this.data,this.cloneMethod),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].startTransaction()}},I.prototype.commit=function(){if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndex=null;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].commit()}},I.prototype.rollback=function(){if(this.transactional){null!==this.cachedData&&null!==this.cachedIndex&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex);for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].rollback()}},I.prototype.async=function(t,e){setTimeout(function(){if("function"!=typeof t)throw new TypeError("Argument passed for async execution is not a function");t(),e()},0)},I.prototype.where=function(t){return this.chain().where(t).data()},I.prototype.mapReduce=function(t,e){try{return e(this.data.map(t))}catch(t){throw t}},I.prototype.eqJoin=function(t,e,r,i,n){return new P(this).eqJoin(t,e,r,i,n)},I.prototype.stages={},I.prototype.getStage=function(t){return this.stages[t]||(this.stages[t]={}),this.stages[t]},I.prototype.commitLog=[],I.prototype.stage=function(t,e){var r=JSON.parse(JSON.stringify(e));return this.getStage(t)[e.$loki]=r,r},I.prototype.commitStage=function(t,e){var r,i=this.getStage(t),n=(new Date).getTime();for(r in i)this.update(i[r]),this.commitLog.push({timestamp:n,message:e,data:JSON.parse(JSON.stringify(i[r]))});this.stages[t]={}},I.prototype.no_op=function(){},I.prototype.extract=function(t){for(var e=0,r=this.data.length,i=S(t),n=[];e<r;e+=1)n.push(x(this.data[e],t,i));return n},I.prototype.max=function(t){return Math.max.apply(null,this.extract(t))},I.prototype.min=function(t){return Math.min.apply(null,this.extract(t))},I.prototype.maxRecord=function(t){for(var e,r=0,i=this.data.length,n=S(t),o={index:0,value:void 0};r<i;r+=1)void 0!==e?e<x(this.data[r],t,n)&&(e=x(this.data[r],t,n),o.index=this.data[r].$loki):(e=x(this.data[r],t,n),o.index=this.data[r].$loki);return o.value=e,o},I.prototype.minRecord=function(t){for(var e,r=0,i=this.data.length,n=S(t),o={index:0,value:void 0};r<i;r+=1)void 0!==e?e>x(this.data[r],t,n)&&(e=x(this.data[r],t,n),o.index=this.data[r].$loki):(e=x(this.data[r],t,n),o.index=this.data[r].$loki);return o.value=e,o},I.prototype.extractNumerical=function(t){return this.extract(t).map(_).filter(Number).filter(function(t){return!isNaN(t)})},I.prototype.avg=function(t){return T(this.extractNumerical(t))},I.prototype.stdDev=function(t){return e=this.extractNumerical(t),r=T(e),i=T(e.map(function(t){var e=t-r,i=e*e;return i})),Math.sqrt(i);var e,r,i},I.prototype.mode=function(t){var e,r,i,n={},o=this.extract(t);for(r in o.forEach(function(t){n[t]?n[t]+=1:n[t]=1}),n)e?e<n[r]&&(i=r):(i=r,e=n[r]);return i},I.prototype.median=function(t){var e=this.extractNumerical(t);e.sort(A);var r=Math.floor(e.length/2);return e.length%2?e[r]:(e[r-1]+e[r])/2},N.prototype={keys:[],values:[],sort:function(t,e){return t<e?-1:t>e?1:0},setSort:function(t){this.bs=new D(t)},bs:function(){return new D(this.sort)},set:function(t,e){var r=this.bs(this.keys,t);r.found?this.values[r.index]=e:(this.keys.splice(r.index,0,t),this.values.splice(r.index,0,e))},get:function(t){return this.values[C(this.keys,t,this.sort).index]}},j.prototype.keyMap={},j.prototype.lokiMap={},j.prototype.set=function(t){var e=t[this.field];if(null!==e&&void 0!==e){if(this.keyMap[e])throw new Error("Duplicate key for property "+this.field+": "+e);this.keyMap[e]=t,this.lokiMap[t.$loki]=e}},j.prototype.get=function(t){return this.keyMap[t]},j.prototype.byId=function(t){return this.keyMap[this.lokiMap[t]]},j.prototype.update=function(t,e){if(this.lokiMap[t.$loki]!==e[this.field]){var r=this.lokiMap[t.$loki];this.set(e),this.keyMap[r]=void 0}else this.keyMap[t[this.field]]=e},j.prototype.remove=function(t){var e=this.keyMap[t];if(null===e||void 0===e)throw new Error("Key is not in unique index: "+this.field);this.keyMap[t]=void 0,this.lokiMap[e.$loki]=void 0},j.prototype.clear=function(){this.keyMap={},this.lokiMap={}},k.prototype={set:function(t,e){this.index[t]?this.index[t].push(e):this.index[t]=[e]},remove:function(t,e){var r=this.index[t];for(var i in r)r[i]==e&&r.splice(i,1);r.length<1&&(this.index[t]=void 0)},get:function(t){return this.index[t]},clear:function(t){this.index={}}},v.LokiOps=d,v.Collection=I,v.KeyValueStore=N,v.LokiMemoryAdapter=b,v.LokiPartitioningAdapter=E,v.LokiLocalStorageAdapter=w,v.LokiFsAdapter=O,v.persistenceAdapters={fs:O,localStorage:w},v.aeq=s,v.lt=a,v.gt=l,v.Comparators=o,v}()})?o.apply(e,s):o)||(t.exports=a)}).call(this,r(14),r(13))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),n=r(8),o=function(){function t(t,e,r){this.name=t,this.$options=e,this.lokiStorageAdapter=r,this._db=null,this.options={autosave:!0,autosaveInterval:500,autoload:!0,adapter:null},this.logger=new i.Logger("DB"),!0!==this.$options.off&&!0!==this.$options.isTest||(this.options={autosave:!1,autosaveInterval:31104e6,autoload:!1,adapter:null}),this.options.adapter=r;var o=this.name||t||this.$options.offlineDBName||"offline";this._db=new n(o,this.options),this._db.loadDatabase()}return t.prototype.getCollectionByName=function(t){var e=this._db.getCollection(t);if(!e){e=this._db.addCollection(t,{clone:!0,disableChangesApi:!0,transactional:!0})}return e},t.prototype.getCollection=function(t){var e=this;return new Promise(function(r){e._db.loadDatabase({},function(){var i=e._db.getCollection(t);if(!i){i=e._db.addCollection(t)}r(i)})})},t.prototype.saveDatabase=function(){this._db.save()},t.prototype.getCollections=function(){return this._db.listCollections()},t.prototype.internalDB=function(){return this._db},t.prototype.close=function(t){this._db.close(t)},t.prototype.flush=function(){var t=this;return new Promise(function(e){for(var r=t.getCollections(),i=0;i<r.length;i++)t.getCollectionByName(r[i].name).removeDataOnly();e(!0)})},t}();e.DB=o},,function(t,e){},function(t,e,r){var i,n,o;n=[],void 0===(o="function"==typeof(i=function(){return function(){function t(t){if(this.app="loki",void 0!==t&&(this.app=t),this.catalog=null,!this.checkAvailability())throw new Error("indexedDB does not seem to be supported for your environment")}function e(t){this.db=null,this.initializeLokiCatalog(t)}return t.prototype.checkAvailability=function(){return!("undefined"==typeof indexedDB||!indexedDB)},t.prototype.loadDatabase=function(t,r){var i=this.app,n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(i,t,function(t){if("function"==typeof r){if(0===t.id)return void r(null);r(t.val)}else console.log(t.val)}):this.catalog=new e(function(e){n.catalog=e,n.loadDatabase(t,r)})},t.prototype.loadKey=t.prototype.loadDatabase,t.prototype.saveDatabase=function(t,r,i){var n=this.app,o=this;function s(t){t&&!0===t.success?i(null):i(new Error("Error saving database"))}null!==this.catalog&&null!==this.catalog.db?this.catalog.setAppKey(n,t,r,s):this.catalog=new e(function(e){o.catalog=e,e.setAppKey(n,t,r,s)})},t.prototype.saveKey=t.prototype.saveDatabase,t.prototype.deleteDatabase=function(t,r){var i=this.app,n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(i,t,function(t){var e=t.id;0!==e?n.catalog.deleteAppKey(e,r):"function"==typeof r&&r({success:!0})}):this.catalog=new e(function(e){n.catalog=e,n.deleteDatabase(t,r)})},t.prototype.deleteKey=t.prototype.deleteDatabase,t.prototype.deleteDatabasePartitions=function(t){var e=this;this.getDatabaseList(function(r){r.forEach(function(r){r.startsWith(t)&&e.deleteDatabase(r)})})},t.prototype.getDatabaseList=function(t){var r=this.app,i=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKeys(r,function(e){for(var r=[],i=0;i<e.length;i++)r.push(e[i].key);"function"==typeof t?t(r):r.forEach(function(t){console.log(t)})}):this.catalog=new e(function(e){i.catalog=e,i.getDatabaseList(t)})},t.prototype.getKeyList=t.prototype.getDatabaseList,t.prototype.getCatalogSummary=function(t){this.app;var r=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAllKeys(function(e){for(var r,i,n,o,s,a=[],l=0;l<e.length;l++)r=e[l],n=r.app||"",o=r.key||"",s=r.val||"",i=2*n.length+2*o.length+s.length+1,a.push({app:r.app,key:r.key,size:i});"function"==typeof t?t(a):a.forEach(function(t){console.log(t)})}):this.catalog=new e(function(e){r.catalog=e,r.getCatalogSummary(t)})},e.prototype.initializeLokiCatalog=function(t){var e=indexedDB.open("LokiCatalog",1),r=this;e.onupgradeneeded=function(t){var e=t.target.result;if(e.objectStoreNames.contains("LokiAKV")&&e.deleteObjectStore("LokiAKV"),!e.objectStoreNames.contains("LokiAKV")){var r=e.createObjectStore("LokiAKV",{keyPath:"id",autoIncrement:!0});r.createIndex("app","app",{unique:!1}),r.createIndex("key","key",{unique:!1}),r.createIndex("appkey","appkey",{unique:!0})}},e.onsuccess=function(e){r.db=e.target.result,"function"==typeof t&&t(r)},e.onerror=function(t){throw t}},e.prototype.getAppKey=function(t,e,r){var i,n,o=this.db.transaction(["LokiAKV"],"readonly"),s=o.objectStore("LokiAKV"),a=s.index("appkey"),l=t+","+e,c=a.get(l);c.onsuccess=(i=r,function(t){var e=t.target.result;null!==e&&void 0!==e||(e={id:0,success:!1}),"function"==typeof i?i(e):console.log(e)}),c.onerror=(n=r,function(t){if("function"!=typeof n)throw t;n({id:0,success:!1})})},e.prototype.getAppKeyById=function(t,e,r){var i,n,o=this.db.transaction(["LokiAKV"],"readonly"),s=o.objectStore("LokiAKV"),a=s.get(t);a.onsuccess=(i=r,n=e,function(t){"function"==typeof n?n(t.target.result,i):console.log(t.target.result)})},e.prototype.setAppKey=function(t,e,r,i){var n,o=this.db.transaction(["LokiAKV"],"readwrite"),s=o.objectStore("LokiAKV"),a=s.index("appkey"),l=t+","+e,c=a.get(l);c.onsuccess=function(n){var o=n.target.result;null===o||void 0===o?o={app:t,key:e,appkey:t+","+e,val:r}:o.val=r;var a,l,h=s.put(o);h.onerror=(a=i,function(t){"function"==typeof a?a({success:!1}):(console.error("LokiCatalog.setAppKey (set) onerror"),console.error(c.error))}),h.onsuccess=(l=i,function(t){"function"==typeof l&&l({success:!0})})},c.onerror=(n=i,function(t){"function"==typeof n?n({success:!1}):(console.error("LokiCatalog.setAppKey (get) onerror"),console.error(c.error))})},e.prototype.deleteAppKey=function(t,e){var r,i,n=this.db.transaction(["LokiAKV"],"readwrite"),o=n.objectStore("LokiAKV"),s=o.delete(t);s.onsuccess=(r=e,function(t){"function"==typeof r&&r({success:!0})}),s.onerror=(i=e,function(t){"function"==typeof i?i({success:!1}):(console.error("LokiCatalog.deleteAppKey raised onerror"),console.error(s.error))})},e.prototype.getAppKeys=function(t,e){var r,i,n,o=this.db.transaction(["LokiAKV"],"readonly"),s=o.objectStore("LokiAKV"),a=s.index("app"),l=IDBKeyRange.only(t),c=a.openCursor(l);c.onsuccess=(r=[],i=e,function(t){var e=t.target.result;if(e){var n=e.value;r.push(n),e.continue()}else"function"==typeof i?i(r):console.log(r)}),c.onerror=(n=e,function(t){"function"==typeof n?n(null):(console.error("LokiCatalog.getAppKeys raised onerror"),console.error(t))})},e.prototype.getAllKeys=function(t){var e,r,i,n=this.db.transaction(["LokiAKV"],"readonly"),o=n.objectStore("LokiAKV"),s=o.openCursor();s.onsuccess=(e=[],r=t,function(t){var i=t.target.result;if(i){var n=i.value;e.push(n),i.continue()}else"function"==typeof r?r(e):console.log(e)}),s.onerror=(i=t,function(t){"function"==typeof i&&i(null)})},t}()})?i.apply(e,n):i)||(t.exports=o)},function(t,e){var r,i,n=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(t){r=o}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var l,c=[],h=!1,u=-1;function p(){h&&l&&(h=!1,l.length?c=l.concat(c):u=-1,c.length&&d())}function d(){if(!h){var t=a(p);h=!0;for(var e=c.length;e;){for(l=c,c=[];++u<e;)l&&l[u].run();u=-1,e=c.length}l=null,h=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function y(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new f(t,e)),1!==c.length||h||a(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=y,n.addListener=y,n.once=y,n.off=y,n.removeListener=y,n.removeAllListeners=y,n.emit=y,n.prependListener=y,n.prependOnceListener=y,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,r,i,n){return t.call(this,"mcs-request",e,r,i,n)||this}return n(e,t),e.prototype.buildResponseObject=function(t){return t},e.prototype.getResponsePayload=function(t){return t.data},e.prototype.getModuleName=function(){return"MCS"},e.prototype.isPersistentGetRequest=function(r){t.prototype.isPersistentGetRequest.call(this,r);var i=e.HEADER_RESOURCE_TYPE in r||r.headers[e.HEADER_RESOURCE_TYPE];if("collection"===i){if(this.$common.isEmpty(r.data))throw new Error("cannot proceed with empty payload");if(!("items"in r.data))throw new Error("items is not in the payload returned from MCS, probably not Sync Custom Code");if(!("uris"in r.data))throw new Error("url is not in the payload returned from MCS, probably not Sync Custom Code");if(!("etags"in r.data))throw new Error("etags is not in the payload returned from MCS, probably not Sync Custom Code")}else if("item"!==i)throw new Error("oracle-mobile-sync-resource-type is not in the headers returned from MCS, probably not Sync Custom Code");return!0},e.prototype.handleMcsGetCollectionPayload=function(t,r){for(var i=t.items,n=Date.now(),o=0;o<i.length;o++){var s=i[o];s[e.URI_KEY]=this.normalizeURI(t.uris[o]),s[e.ETAG_KEY]=t.etags[o];var a=s[e.URI_KEY],l=this.collectionFindOneByUri(r,a);l?(this.$common.extendOwn(l,s),r.update(l)):r.insert(s)}return r.removeWhere(function(t){return(t.meta.updated||t.meta.created)<n}),r.find()},e.prototype.handleMcsGetItemPayload=function(t,r,i){var n=this.collectionFindOneByUri(t,i);if(n){var o=r;return this.$common.extendOwn(n,o),t.update(n)}return(o=r)[e.URI_KEY]=i,t.insert(o)},e.prototype.handleGet=function(t){var r=this.$options.isPersistentUrl(t.url);if(!1===r)throw new Error("Persistence.handleMcsGet()-> URI was not configured for persistence:"+t.url);var i=this.$db.getCollectionByName(r.root);if(this.$common.isEmpty(r.params)){var n=i.find(),o={items:[],uris:[],etags:[]};for(var s in n){n[s].hasOwnProperty(e.URI_KEY)&&(o.uris.push(n[s][e.URI_KEY]),delete n[s][e.URI_KEY]),n[s].hasOwnProperty(e.ETAG_KEY)&&(o.etags.push(n[s][e.ETAG_KEY]),delete n[s][e.ETAG_KEY]);var a=this.$common.cleanObject(n[s]);o.items.push(a)}return o}var l=this.collectionFindOneByPersistentPath(i,r);return this.$common.cleanObject(l)},e.prototype.handleGetStore=function(t){var r=this.$options.isPersistentUrl(t.url);if(!1===r)throw new Error("Persistence.handleMcsGetStore()-> URI was not configured for persistence:"+t.url);var i=this.$db.getCollectionByName(r.root),n=t.data,o=e.HEADER_RESOURCE_TYPE in t||t.headers[e.HEADER_RESOURCE_TYPE];if("collection"===o)return this.handleMcsGetCollectionPayload(n,i);if("item"===o)return this.handleMcsGetItemPayload(i,n,r.path);throw o?(this.logger.error("unknown Oracle-Mobile-Sync-Resource-Type (%s)",o),new Error("unknown Oracle-Mobile-Sync-Resource-Type")):(this.logger.error("this is not MCS response, unable to handle the payload, no MCS header was specified: ",t),new Error("this is not MCS response, unable to handle the payload, no MCS header was specified"))},e.prototype.handlePost=function(t,r){var i=this.$options.isPersistentUrl(t.url);if(!1===i)throw new Error("Persistence.handleMcsPost()-> URI was not configured for persistence:"+t.url);var n=this.$db.getCollectionByName(i.root),o=t.data;if(!this.$common.isEmpty(i.params))throw new Error("you can add new objects only against the root REST resource endpoint");if(this.$common.isArray(o))throw new Error("the payload cannot be array");if(this.$common.isObject(o)&&!this.$common.isNull(o)&&!this.$common.isFunction(o)){if(t.data&&t.data[e.URI_KEY])return this.updatePayloadWithNewUri(n,t);var s=null;t&&t.headers&&t.headers[e.HEADER_LOCATION]&&(s=this.$common.stringStartsWith(t.headers[e.HEADER_LOCATION],"/")?t.headers[e.HEADER_LOCATION]:"/"+t.headers[e.HEADER_LOCATION]);var a=null;if(s&&(a=this.collectionFindOneByUri(n,s)),a?this.$common.extendOwn(a,t.data):(o[e.ETAG_KEY]='"0-1B2M2Y8AsgTpgAmY7PhCfg"',a=n.insert(o),this.markObjAsOfflineIfForced(a,r)),!s){var l=i.tokens.length>0&&/^\w+$/.test(i.tokens[0].name)?i.tokens[0].name:null,c=null;l&&(c=t.data.hasOwnProperty(l)?t.data[l]:this.$common.getUID()),s=null===c?i.root+"/"+this.$common.getUID():i.root+"/"+c}return a[e.URI_KEY]=s,n.update(a)}throw new Error("don't know what to do with the payload")},e.prototype.updatePayloadWithNewUri=function(t,r){var i=r.data[e.URI_KEY],n=this.collectionFindOneByUri(t,i);if(n)return this.$common.extendOwn(n,r.data),n[e.URI_KEY]=this.normalizeURI(r.headers[e.HEADER_LOCATION]),t.update(n);throw new Error("the payload was not found in collection:"+i)},e.prototype.handlePut=function(t,e){var r=this.$options.isPersistentUrl(t.url);if(!1===r)throw new Error("Persistence.handleMcsPut()-> URI was not configured for persistence:"+t.url);var i=this.$db.getCollectionByName(r.root),n=t.data;if(!this.$common.isEmpty(r.params)){if(this.$common.isArray(n))throw new Error("the payload cannot be array");if(this.$common.isObject(n)&&!this.$common.isNull(n)&&!this.$common.isFunction(n)){var o=this.collectionFindOneByPersistentPath(i,r);if(o)return this.$common.extendOwn(o,n),this.markObjAsOfflineIfForced(o,e),i.update(o)}}throw new Error("you can execute update operations only against existing items in the offline database!")},e.prototype.collectionFindOneByPersistentPath=function(t,r){var i=r.path+"$",n={};return n[e.URI_KEY]={$regex:new RegExp(i)},t.findOne(n)},e.prototype.collectionFindOneByUri=function(t,r){var i={};return i[e.URI_KEY]=r,t.findOne(i)},e.prototype.handleDelete=function(t){var e=this.$options.isPersistentUrl(t.url);if(!1===e)throw new Error("Persistence.handleMcsDelete()-> URI was not configured for persistence:"+t.url);var r=this.$db.getCollectionByName(e.root);if(!this.$common.isEmpty(e.params)){var i=this.collectionFindOneByPersistentPath(r,e);if(i)return r.remove(i);throw new Error("unable to find object with the given ID("+e.path+") in the database")}},e.prototype.postSuccessOperations=function(t){if("POST"===t.syncObj.method){var r=this.$common.clone(t),i=this.$options.parseURL(r.syncObj.url),n=this.$utils.isPersistUrl(i.path);if(!1===n)return this.logger.debug("sync post success operation exist"),t;var o=this.$utils.extractKeyValuesFromUrl2(n),s=this.$db.getCollectionByName(o.root),a=r.syncObj.data,l=r.response;if(this.$common.isArray(a))return this.logger.error("The payload cannot be array"),t;if(this.$common.isObject(a)&&!this.$common.isNull(a)&&!this.$common.isFunction(a)){if(l.data&&l.data[e.URI_KEY])return this.updatePayloadWithNewUri(s,l);var c=null;if(r.headers){var h=this.$utils.parseResponseHeaders(r.headers);if(h[e.HEADER_LOCATION]){var u=h[e.HEADER_LOCATION];c=this.normalizeURI(u)}}var p=a[e.URI_KEY],d=this.collectionFindOneByUri(s,p);if(d?this.$common.extendOwn(d,l.data):(a[e.ETAG_KEY]='"0-1B2M2Y8AsgTpgAmY7PhCfg"',d=s.insert(a)),!c){var f=n.uri.tokens.length>0&&/^\w+$/.test(n.uri.tokens[0].name)?n.uri.tokens[0].name:null,y=null;f&&(y=l.data.hasOwnProperty(f)?l.data[f]:this.$common.getUID()),c=null===y?n.root+"/"+this.$common.getUID():n.root+"/"+y}return d[e.URI_KEY]=c,s.update(d)}}return t},e.prototype.normalizeURI=function(t){return this.$common.stringStartsWith(t,"/")||this.$common.stringStartsWith(t,"http")?t:"/"+t},e.prototype.data=function(t){return new Promise(function(e){return e(function(t){var e=this.$options.isPersistentUrl(t);if(!e)throw new Error("Persistence.BaseModule.data() given URI not configured for persistence: "+t);return this.$db.getCollectionByName(e.root)}(t))})},e.prototype.router=function(t,e){var r=this;return void 0===e&&(e=!1),new Promise(function(i){if(!r.$common.isObject(t))throw console.error("Passed object is not defined request!",t),new Error("Passed object is not defined request!");if(!t.hasOwnProperty("method"))throw r.logger.error("request.method was not provided!",t),new Error("request.method was not provided!");var n=r.$common.clone(t);if(n.method=r.$utils._normalizeMethod(n.method),!r[n.method])throw r.logger.error("specified router is not implemented!"),new Error("specified router is not implemented!");i(r[n.method](n,e))})},e.prototype.get=function(t){var e=this;return new Promise(function(r){r(function(t){e.logger.info("get()"),e.isPersistentRequest(t);var r=e.$common.clone(t);return!r.hasOwnProperty("data")||e.$common.isEmpty(r.data)?e.$common.clone(e.handleGet(r)):(e.isPersistentGetRequest(t),e.$common.clone(e.handleGetStore(r)))}(t))})},e.URI_KEY="$mcs$mcsPersistenceURI",e.ETAG_KEY="$mcs$etag",e.HEADER_LOCATION="location",e.HEADER_RESOURCE_TYPE="oracle-mobile-sync-resource-type",e}(r(6).RequestHandler);e.McsRequestHandler=o},,,,function(t,e){for(var r=[],i=0;i<256;++i)r[i]=(i+256).toString(16).substr(1);t.exports=function(t,e){var i=e||0,n=r;return n[t[i++]]+n[t[i++]]+n[t[i++]]+n[t[i++]]+"-"+n[t[i++]]+n[t[i++]]+"-"+n[t[i++]]+n[t[i++]]+"-"+n[t[i++]]+n[t[i++]]+"-"+n[t[i++]]+n[t[i++]]+n[t[i++]]+n[t[i++]]+n[t[i++]]+n[t[i++]]}},function(t,e){var r="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(r){var i=new Uint8Array(16);t.exports=function(){return r(i),i}}else{var n=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),n[e]=t>>>((3&e)<<3)&255;return n}}},,,,,,,,,,,,,,,,,,,,,,,,function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),n=function(){function t(t,e){this.$common=t,this.$options=e,this.isPersistUrlCache={},this.keyValuesFromPersistentUrlCache={},this.methods=["delete","get","head","options","post","put","patch"],this.logger=new i.Logger("Utils")}return t.prototype.pathMatch=function(t){t=t||{};var e=this;return function(r){var i=[],n=pathToRegexp(r,i,t);return function(t,r){var o=n.exec(t);if(!o)return!1;r=r||[];for(var s,a,l={},c=0;c<i.length;c++)s=i[c],(a=o[c+1])&&(l={name:s.name,value:e.decodeParam(a)},r.push(l),s.repeat&&(r[r.length-1].name=r[r.length-1].name.split(s.delimiter)));return r}}},t.prototype.getXHRResponse=function(t){var e=""===t.responseType||"text"===t.responseType?t.responseText:t.response;return"string"==typeof e?e.length>0?JSON.parse(e):null:e},t.prototype.decodeParam=function(t){try{return decodeURIComponent(t)}catch(e){throw Error('failed to decode param "'+t+'"')}},t.prototype.isPersistUrl=function(t){if(null==t||"string"!=typeof t)return this.logger.warn("isPersistentUrl -> path can be only string"),!1;if(t in this.isPersistUrlCache)return this.isPersistUrlCache[t];for(var e=this.$options.persistUris.length,r=0;r<e;r++){var i=this.$options.persistUris[r].reg.exec(t);if(i)return this.isPersistUrlCache[t]={match:i,uri:this.$options.persistUris[r]}}return this.isPersistUrlCache[t]=!1},t.prototype.isUrlRegexInteger=function(t){return t.indexOf("d")>=0},t.prototype.nestedUrlPropertyToValue=function(t){return t||t.value?t.isInteger?parseInt(t.value,10):t.value:""},t.prototype.extractKeyValuesFromUrl2=function(t){if(t.match[0]in this.keyValuesFromPersistentUrlCache)return this.keyValuesFromPersistentUrlCache[t.match[0]];for(var e={root:t.uri.tokens[0],attr:[]},r=t.uri.tokens,i=1,n=1;n<r.length;n++)if(this.$common.isObject(t.uri.tokens[n])){var o=i++,s=t.uri.tokens[n];t.match[o]&&e.attr.push({name:this.$common.stringStartsWith(s.name,"/")||this.$common.stringStartsWith(s.name,"_")?s.name.substring(1):s.name,value:t.match[o],pattern:s.pattern,is:!(!this.$common.stringStartsWith(s.name,"/")&&!this.$common.stringStartsWith(s.name,"_")),isInteger:this.isUrlRegexInteger(s.pattern)})}else{(s=t.uri.tokens[n])&&e.attr.push({name:s,value:this.$common.stringStartsWith(s,"/")||this.$common.stringStartsWith(s,"_")?s.substring(1):s,is:!1,isInteger:this.isUrlRegexInteger(s)})}return this.keyValuesFromPersistentUrlCache[t.match[0]]=e},t.prototype.transformQueryParams=function(t){var e=[];for(var r in t)e.push(encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e.join("&")},t.prototype.setValueToObject=function(t,e){if(this.$common.isFunction(e))throw new Error("unknown payload object, cannot assign function to payload!");return Array.isArray(t)&&Array.isArray(e)?t=e:Array.isArray(t)&&!Array.isArray(e)&&this.$common.isObject(e)?t.push(e):t=e,t},t.prototype.setData=function(t,e,r){r||(r={});var i=t.split(/\./);i.length<2?r[i[0]]=e:(r[i[0]]||(r[i[0]]={}),r=r[i.shift()],this.setData(i.join("."),e,r))},t.prototype._setData2=function(t,e,r){r||(r={});var i=t.split(/\./);i.length<2?r[i[0]]?Array.isArray(r[i[0]])&&Array.isArray(e)?r[i[0]]=e:Array.isArray(r[i[0]])&&!Array.isArray(e)&&this.$common.isObject(e)?r[i[0]].push(e):r[i[0]]=e:r[i[0]]=e:(r[i[0]]||(r[i[0]]={}),r=r[i.shift()],this.setData(i.join("."),e,r))},t.prototype._getData=function(t,e){if(!e)return{};var r=t.split(/\./);return r.length<2?e[r[0]]:e[r[0]]?(e=e[r.shift()],void this._getData(r.join("."),e)):{}},t.prototype.isOfflinePersistObj=function(t){return!!("meta"in t&&t.meta.hasOwnProperty("offline-persist"))},t.prototype.setNestedProperty=function(t,e,r){var i=this;if(t&&"object"==typeof t){if("string"==typeof e&&""!==e){var n=e.split(".");return n.reduce(function(t,e,o){var s,a={name:null,value:null},l=e.match(/\[(.*?)\]/);return l?(a.name=e.substr(0,e.indexOf("[")),a.value=l[1]):t[e]=t[e]||{},n.length==o+1?l?Array.isArray(t)?(s=t.findIndex(function(t){return t[a.name]==a.value}))>-1?i.$common.deepExtend(r,t[s]):t.push(r):t[a.name]==a.value?i.$common.deepExtend(r,t[a.name]):(t[a.name]=a.value,i.$common.deepExtend(r,t)):t[e]=r:l?Array.isArray(t)?(s=t.findIndex(function(t){return t[a.name]===a.value}))>-1?t[s]:{}:t[a.name]==a.value?t[a.name]:t[a.name]=a.value:t[e]},t)}return t}return t},t.prototype.setNestedProperty2=function(t,e,r,i){var n=this;return t&&"object"==typeof t&&this.$common.isArray(e)&&e.length>0?e.reduce(function(t,o,s){if(o.isProperty&&(t[o.name]=t[o.name]||[]),e.length===s+1){if(o.isProperty){if(Array.isArray(r))return t[o.name]=r,r;if(i)for(var a=t[o.name],l=0,c=Object.keys(a);l<c.length;l++){if(a[c[l]][i.key.name]===i.value){n.$common.deepExtend(a[s],r);break}}else t[o.name].push(r);return r}return Array.isArray(t)?((h=t.findIndex(function(t){return t[o.name]==n.nestedUrlPropertyToValue(o)}))>-1?n.$common.deepExtend(t[h],r):(r[o.name]=n.nestedUrlPropertyToValue(o),t.push(r)),r):t[o.name]==n.nestedUrlPropertyToValue(o)?(n.$common.deepExtend(t,r),r):(t[o.name]=n.nestedUrlPropertyToValue(o),n.$common.deepExtend(t,r),r)}if(o.isProperty)return t[o.name];if(Array.isArray(t)){var h,u=n;return(h=t.findIndex(function(t){return t[o.name]===u.nestedUrlPropertyToValue(o)}))>-1?t[h]:{}}return t[o.name]==n.nestedUrlPropertyToValue(o)?t:t[o.name]=n.nestedUrlPropertyToValue(o)},t):t},t.prototype.getNestedProperty=function(t,e){var r=this;return t&&"object"==typeof t&&this.$common.isArray(e)&&0!==e.length?e.reduce(function(t,e){if(e.isProperty)return t&&t[e.name];var i=e.name,n=r.nestedUrlPropertyToValue(e);if(Array.isArray(t)&&!e.isProperty){var o=t.findIndex(function(t){return t[i]==n});return o>-1?t[o]:t[i]&&t}return e.isProperty?t&&t[i]:t[i]==n?t:t[i]&&t},t):t},t.prototype.matchUri=function(t,e){return new RegExp("^"+e.replace("*",".*")+"$").test(t)},t.prototype.parseResponseHeaders=function(t){var e={};if(!t)return e;for(var r=t.split("\r\n"),i=0,n=r.length;i<n;i++){var o=r[i],s=o.indexOf(": ");s>0&&(e[o.substring(0,s).toLowerCase()]=o.substring(s+2))}return e},t.prototype.isPersistentURL=function(t){var e=this.$options.parseURL(t);return this.isPersistUrl(e.path)},t.prototype._isURLConfiguredForPersistence=function(t,e){var r=this.isPersistentURL(t);if(this.$common.isEmpty(r)||!1===r)throw new Error("give url was configured for persistence:"+t);return e?r:this.extractKeyValuesFromUrl2(r)},t.prototype.cleanSyncLogObjectFromDBSpecificProperties=function(t,e){var r=e?JSON.parse(JSON.stringify(t)):t;return r.hasOwnProperty("$loki")&&"number"==typeof r.$loki&&!isNaN(r.$loki)&&delete r.$loki,r.hasOwnProperty("meta")&&delete r.meta,r},t.prototype._isWebView=function(){return!!(window.cordova||window.PhoneGap||window.phonegap||window.forge)},t.prototype._isMcsSyncResourceType=function(t){return!0},t.prototype.isSupportedHTTPMethod=function(t,e){return"function"==typeof t[this._normalizeMethod(e)]},t.prototype._normalizeMethod=function(t){var e=t.toLowerCase();return this.methods.indexOf(e)>-1?e:t},t.prototype._isLokiDbObj=function(t){return"$loki"in t&&"number"==typeof t.$loki&&!isNaN(t.$loki)},t}();e.SyncUtils=n},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,r,i,n){return t.call(this,"oracle-rest-request",e,r,i,n)||this}return n(e,t),e.prototype.getResponsePayload=function(t){return t.data.items||t.data},e.prototype.getModuleName=function(){return"OracleRest"},e.prototype.buildResponseObject=function(t){return this.$common.isArray(t)?{items:t}:t},e.prototype.isPersistentGetRequest=function(e){if(t.prototype.isPersistentGetRequest.call(this,e),e.data&&this.$common.isEmpty(e.data))throw new Error("cannot proceed with empty payload");return!0},e}(r(6).RequestHandler);e.OracleRestRequestHandler=o},function(t,e,r){var i=r(20),n=r(19);t.exports=function(t,e,r){var o=e&&r||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var s=(t=t||{}).random||(t.rng||i)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e)for(var a=0;a<16;++a)e[o+a]=s[a];return e||n(s)}},function(t,e,r){var i,n,o=r(20),s=r(19),a=0,l=0;t.exports=function(t,e,r){var c=e&&r||0,h=e||[],u=(t=t||{}).node||i,p=void 0!==t.clockseq?t.clockseq:n;if(null==u||null==p){var d=o();null==u&&(u=i=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==p&&(p=n=16383&(d[6]<<8|d[7]))}var f=void 0!==t.msecs?t.msecs:(new Date).getTime(),y=void 0!==t.nsecs?t.nsecs:l+1,m=f-a+(y-l)/1e4;if(m<0&&void 0===t.clockseq&&(p=p+1&16383),(m<0||f>a)&&void 0===t.nsecs&&(y=0),y>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,l=y,n=p;var g=(1e4*(268435455&(f+=122192928e5))+y)%4294967296;h[c++]=g>>>24&255,h[c++]=g>>>16&255,h[c++]=g>>>8&255,h[c++]=255&g;var v=f/4294967296*1e4&268435455;h[c++]=v>>>8&255,h[c++]=255&v,h[c++]=v>>>24&15|16,h[c++]=v>>>16&255,h[c++]=p>>>8|128,h[c++]=255&p;for(var b=0;b<6;++b)h[c+b]=u[b];return e||s(h)}},function(t,e,r){var i=r(47),n=r(46),o=n;o.v1=i,o.v4=n,t.exports=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),n=r(48),o=function(){function t(e,r,n,o,s,a,l){var c=this;this.$options=r,this.$handler=n,this.$sync=o,this.$common=s,this.$utils=a,this.$events=l,this._req={url:"",headers:{"Content-Type":t.defaultContentTypeHeader},data:void 0,method:"",username:"",password:"",responseType:void 0,SYNCID:void 0},this.logger=new i.Logger("SyncXMLHttpRequest"),this.logger.debug("sync express","create SyncXMLHttpRequest"),this.originalXHR=new e,this.isDbFirst=r.isDbFirst();var h=t.PROPERTIES;[h.UPLOAD].forEach(function(t){Object.defineProperty(c,t,{get:function(){return c.xhr[t]}})}),[h.ABORT].forEach(function(t){Object.defineProperty(c,t,{value:function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return c.xhr[t].apply(c.xhr,e)}})}),[h.ON_TIMEOUT,h.TIMEOUT,h.WITH_CREDENTIALS,h.ON_PROGRESS,h.ON_ABORT,h.ON_LOAD_START,h.ON_LOAD_END,h.DONE,h.UNSENT,h.HEADERS_RECEIVED,h.LOADING,h.OPENED].forEach(function(t){Object.defineProperty(c,t,{get:function(){return c.xhr[t]},set:function(e){return c.xhr[t]=e}})})}return Object.defineProperty(t.prototype,"xhr",{get:function(){return this.originalXHR},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onerror",{get:function(){return this.xhr.onerror},set:function(t){var e=this;!1!==this.persistentPath?(this.originalOnError=t,this.xhr.onerror=function(){e.syncOnError(),t.call(e)}):this.xhr.onerror=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onload",{get:function(){return this.xhr.onload},set:function(t){var e=this;!1!==this.persistentPath?(this.originalOnLoad=t,this.xhr.onload=function(){e.onreadystatechangefunction(),t.call(e)}):this.xhr.onload=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onreadystatechange",{get:function(){return this.xhr.onreadystatechange},set:function(t){var e=this;!1!==this.persistentPath?(this.originalOnReadyState=t,this.xhr.onreadystatechange=function(){4===e.xhr.readyState?e.onreadystatechangefunction():(e.readyState=e.xhr.readyState,e.response=e.xhr.response,""!==e.xhr.responseType&&"text"!==e.xhr.responseType||(e.responseText=e.xhr.responseText),e.responseXML=e.xhr.responseXML,e.status=e.xhr.status,e.statusText=e.xhr.statusText,e.responseType=e.xhr.responseType),t.call(e)}):this.xhr.onreadystatechange=function(){t.call(e.xhr)}},enumerable:!0,configurable:!0}),t.prototype.addEventListener=function(t,e){!1!==this.persistentPath?"load"===t?this.onload=e:"error"===t?this.onerror=e:this.xhr.addEventListener(t,e):this.xhr.addEventListener.apply(this.xhr,arguments)},t.prototype.overrideMimeType=function(t){!1!==this.persistentPath?(this._req.headers||(this._req.headers={}),"string"==typeof t&&(this.forceMimeType=t.toLowerCase(),this._req.headers["Content-Type"]=this.forceMimeType),this.xhr.overrideMimeType(t)):this.xhr.overrideMimeType.apply(this.xhr,arguments)},t.prototype.setRequestHeader=function(e,r){if(!1!==this.persistentPath){if(t.UNSAFE_HEADERS[e]||/^(Sec-|Proxy-)/.test(e))throw new Error('Refused to set unsafe header "'+e+'"');this.xhr.setRequestHeader(e,r),this._req.headers||(this._req.headers={}),this._req.headers[e]=r}else this.xhr.setRequestHeader.apply(this.xhr,arguments)},t.prototype._setResponseHeaders=function(e){for(var r in this.responseHeaders={},e)e.hasOwnProperty(r)&&(this.responseHeaders[r]=e[r]);this.forceMimeType&&(this.responseHeaders["Content-Type"]=this.forceMimeType),this.readyState=this[t.PROPERTIES.HEADERS_RECEIVED]},t.prototype.uniqueID=function(){return this.uniqueIDMemo||(this.uniqueIDMemo=n?n.v4():this.$common.getUID()),this.uniqueIDMemo},t.prototype.open=function(t,e,r,i,n){return this.persistentPath=this.$options.isPersistentUrl(e),this.logger.debug("open:",e,this.persistentPath),!1===this.persistentPath?(this.logger.debug("open","defake and continue with the original object, non of the proxy methods will be used!"),this.defake(),this.xhr.open(t,e,!0,i,n)):(this.logger.debug("open","PROXY use the proxy"),this._req.method=t,this._req.url=e,this._req.username=i,this._req.password=n,this.xhr.open.apply(this.xhr,arguments))},t.prototype.getAllResponseHeaders=function(){if(this.readyState<this[t.PROPERTIES.HEADERS_RECEIVED])return"";for(var e="",r=0,i=this.responseHeaders;r<i.length;r++){var n=i[r];/^Set-Cookie2?$/i.test(n)||(e+=n+": "+this.responseHeaders[n]+"\r\n")}return e},t.prototype.getResponseHeader=function(e){if(this.readyState<this[t.PROPERTIES.HEADERS_RECEIVED])return null;if(/^Set-Cookie2?$/i.test(e))return null;e=e.toLowerCase();for(var r=0,i=this.responseHeaders;r<i.length;r++){var n=i[r];if(n.toLowerCase()==e)return this.responseHeaders[n]}return null},t.prototype.send=function(e){var r=this;this.logger.info("SyncXMLHttpRequest.send",e),this[t.PROPERTIES.RESPONSE_TYPE]&&(this._req.responseType=this[t.PROPERTIES.RESPONSE_TYPE]);try{e&&(this._req.data="string"==typeof e?JSON.parse(e):JSON.parse(JSON.stringify(e)))}catch(t){throw new Error("persistence library could execute only JSON payload!")}var i=function(t,e){return r.persistentPath.isPolicy(t,e)};this.$options.isOnline()?setTimeout(function(){r.logger.debug("Sync XHR in ON-LINE MODE"),(i("fetchPolicy","FETCH_FROM_CACHE_SCHEDULE_REFRESH")||r.isDbFirst)&&s(r._req,!1),function(){if(!this.$common.isEmpty(e)&&this.$common.isObject(e))if(e.hasOwnProperty("meta")&&e.meta.hasOwnProperty("offline-persist")){if("GET"===this._req.method)return!1}else e.hasOwnProperty("$loki")&&delete e.$loki,e.hasOwnProperty("meta")&&delete e.meta;return!0}.bind(r)()&&function(){var t=this,e=this.uniqueID()+"-SYNC-"+Math.floor(1e3*Math.random());this._req.SYNCID=e,this.$sync.router(this._req).then(function(){t.$handler.addListener(e,function(e){(function(t){var e=this,r=this.$options.module,s=this.$utils.getXHRResponse(t);if(4===t.readyState){this.$common.isEmpty(s)&&(s="");var a=this.$utils.parseResponseHeaders(t.getAllResponseHeaders());if(a["Request-ID"]=this.uniqueID(),t.status>=200&&t.status<300){this.$events.$emit("success",{data:s,status:t.status,headers:t.getAllResponseHeaders(),requestID:this.uniqueID()});var l=t.getResponseHeader("Content-Type");if(null===l){if("DELETE"!==this._req.method)throw new Error("XHR did not return any HTTP headers!")}else if(null==(l=l&&l.split(";",1)[0])||"application/json"!==l){if("DELETE"!==this._req.method)throw new Error("persistence library could handle only JSON responses!")}else"string"==typeof s&&s.length>0&&(s=JSON.parse(s));this._req.headers=a,i("noCache",!1)&&this.$utils.isSupportedHTTPMethod(r,this._req.method)?(this._req.data=s,"POST"!==this._req.method&&"PUT"!==this._req.method&&"PATCH"!==this._req.method||void 0!==this._req.data.meta&&this._req.data.meta.hasOwnProperty("offline-persist")&&delete this._req.data.meta["offline-persist"],r.router(this._req).then(function(){return o(t.status,a,s)}).catch(function(t){e.logger.error(t),o(400,a,t)})):o(t.status,a,s)}else t.status>=300&&304!=t.status?(this.$events.$emit("error",{event:t}),this._req.headers=a,i("noCache",!1)&&this.$utils.isSupportedHTTPMethod(r,this._req.method)?("GET"===this._req.method&&(this._req.data=[]),r.router(this._req).then(function(e){o(t.status,a,e||s)}).catch(function(t){o(400,a,"Error while executing operation against the offline database: "+t)})):o(t.status,a,s)):o(t.status,a,s)}else o(t.status,n,s)}).bind(t)(e.detail.data)},!1),t.$sync.operations.runSync(!0)}).catch(function(e){t.logger.error(e),o(400,n,e)})}.bind(r)()},1):setTimeout(function(){r.logger.debug("Sync XHR in OFF-LINE MODE"),s(r._req,!0)},1);var n={"Content-Type":"application/json; charset=utf-8","Request-ID":this.uniqueID()},o=function(e,n,o){i("fetchPolicy","FETCH_FROM_CACHE_SCHEDULE_REFRESH")||r.isDbFirst?r.$handler.dispatchEvent(e,t.HTTP_STATUS_CODES[e],o,r.uniqueID()):r.respond2(e,n,o)},s=function(t,e){var o=r.$options.module;if("GET"===t.method&&delete t.data,i("noCache",!1)&&r.$utils.isSupportedHTTPMethod(o,t.method))return o.router(t).then(function(i){return t.hasOwnProperty("method")&&"GET"!==t.method&&!0===e&&(r._req.data=i,r.$sync.router(r._req)),i}).then(function(t){r.$common.isEmpty(t)?r.respond2(404,n,"Offline Not Found"):r.respond2(200,n,t)}).catch(function(t){r.logger.error(t),r.respond2(400,n,t)});t.hasOwnProperty("method")&&r.$utils.isSupportedHTTPMethod(r.$sync,t.method)?"GET"!==t.method&&!0===e?(r._req.data=t.data,r.$sync.router(t).then(function(t){r.respond2(200,n,null)}).catch(function(t){return r.respond2(400,n,null)})):r.respond2(0,n,null):r.respond2(400,n,null)}},t.prototype.syncOnError=function(){var e=t.PROPERTIES;this.readyState=this.xhr.readyState,""!==this.xhr.responseType&&"text"!==this.xhr.responseType||(this[e.RESPONSE_TEXT]=this.xhr.responseText),this[e.RESPONSE_TYPE]=this.xhr.responseType,this[e.RESPONSE]=this.xhr.response,this[e.RESPONSE_XML]=this.xhr.responseXML,this[e.STATUS]=this.xhr.status,this[e.STATUS_TEXT]=this.xhr.statusText},t.prototype.respond2=function(e,r,i){var n=t.PROPERTIES;if(this._setResponseHeaders(r),this.readyState=this[n.DONE],this[n.STATUS]=e,this[n.STATUS_TEXT]=t.HTTP_STATUS_CODES[e],null!=i?"string"==typeof i?this[n.RESPONSE_TEXT]=i:"object"==typeof i?this[n.RESPONSE_TYPE]&&"json"===this[n.RESPONSE_TYPE]?this[n.RESPONSE]=i:this[n.RESPONSE_TEXT]=JSON.stringify(i):(this[n.RESPONSE_TEXT]=null,this[n.RESPONSE]=this[n.RESPONSE_TEXT]):(this[n.RESPONSE_TEXT]=null,this[n.RESPONSE]=this[n.RESPONSE_TEXT]),0!==e)if(this.originalOnLoad)this.originalOnLoad.call(this);else{if(!this.originalOnReadyState)throw new Error("no response XHR method was implemented!");this.originalOnReadyState.call(this)}else if(this.originalOnError)this.originalOnError.call(this);else if(this.originalOnLoad)this.originalOnLoad.call(this);else{if(!this.originalOnReadyState)throw new Error("no response XHR method was implemented!");this.originalOnReadyState.call(this)}},t.prototype.onreadystatechangefunction=function(){var e=t.PROPERTIES,r=this.$utils.parseResponseHeaders(this.xhr.getAllResponseHeaders());this._setResponseHeaders(r),this.readyState=this[t.PROPERTIES.DONE],this[e.STATUS]=this.xhr.status,this[e.STATUS_TEXT]=this.xhr.statusText,""!==this.xhr.responseType&&"text"!==this.xhr.responseType||(this[e.RESPONSE_TEXT]=this.xhr.responseText),!1!==this.persistentPath&&(this[e.RESPONSE]=this.xhr.response,this[e.RESPONSE_XML]=this.xhr.responseXML)},t.prototype.defake=function(){var e=this;this.logger.debug("sync-express.defake","process request by original XMLHttpRequest");var r=t.PROPERTIES,i=t.METHODS;return[i.SEND,i.REMOVE_EVENT_LISTENER,i.GET_RESPONSE_HEADER,i.GET_ALL_RESPONSE_HEADERS,i.DISPATCH_EVENT,i.OVERRIDE_MIME_TYPE].forEach(function(t){Object.defineProperty(e,t,{value:function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return e.xhr[t].apply(e.xhr,r)}})}),[r.READY_STATE,r.RESPONSE_TEXT,r.RESPONSE,r.RESPONSE_TYPE,r.RESPONSE_XML,r.STATUS,r.STATUS_TEXT].forEach(function(t){Object.defineProperty(e,t,{get:function(){return e.xhr[t]},set:function(r){return e.xhr[t]=r}})}),this},t.PROPERTIES={HEADERS_RECEIVED:"HEADERS_RECEIVED",UPLOAD:"upload",ABORT:"abort",ON_TIMEOUT:"ontimeout",TIMEOUT:"timeout",WITH_CREDENTIALS:"withCredentials",ON_PROGRESS:"onprogress",ON_LOAD_START:"onloadstart",ON_LOAD_END:"onloadend",DONE:"DONE",UNSENT:"UNSENT",LOADING:"LOADING",OPENED:"OPENED",ON_LOAD:"onload",ON_READY_STATE_CHANGE:"onreadystatechange",ON_ERROR:"onerror",ON_ABORT:"onabort",READY_STATE:"readyState",RESPONSE_TEXT:"responseText",RESPONSE:"response",RESPONSE_TYPE:"responseType",RESPONSE_XML:"responseXML",STATUS:"status",STATUS_TEXT:"statusText"},t.METHODS={SET_REQUEST_HEADER:"setRequestHeader",SEND:"send",ADD_EVENT_LISTENER:"addEventListener",REMOVE_EVENT_LISTENER:"removeEventListener",GET_RESPONSE_HEADER:"getResponseHeader",GET_ALL_RESPONSE_HEADERS:"getAllResponseHeaders",DISPATCH_EVENT:"dispatchEvent",OVERRIDE_MIME_TYPE:"overrideMimeType"},t.defaultContentTypeHeader="application/json; charset=utf-8",t.HTTP_STATUS_CODES={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"},t.UNSAFE_HEADERS={"Accept-Charset":!0,"Accept-Encoding":!0,Connection:!0,"Content-Length":!0,Cookie:!0,Cookie2:!0,"Content-Transfer-Encoding":!0,Date:!0,Expect:!0,Host:!0,"Keep-Alive":!0,Referer:!0,TE:!0,Trailer:!0,"Transfer-Encoding":!0,Upgrade:!0,"User-Agent":!0,Via:!0},t}();e.SyncXMLHttpRequest=o,e.xmlHttpRequestInstall=function(t,e,r,i,n,s,a,l){var c=t;window.XMLHttpRequest=function(h){if(l.debug("XMLHttpRequest.intercept",h),"boolean"==typeof h){if(!0===h)return new o(t,i,s,e,n,r,a);if(!1===h)return new c}return!i.isOn()||i.off?new c:new o(t,i,s,e,n,r,a)},window.XMLHttpRequest.originalXMLHttpRequest=c},e.xmlHttpRequestUninstall=function(){if(!window.XMLHttpRequest.originalXMLHttpRequest)throw"Sync Express is not installed.";window.XMLHttpRequest=window.XMLHttpRequest.originalXMLHttpRequest}},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,r,i,n){return t.call(this,"generic-request",e,r,i,n)||this}return n(e,t),e.prototype.buildResponseObject=function(t){return t},e.prototype.getResponsePayload=function(t){return t.data},e.prototype.getModuleName=function(){return"Generic"},e.prototype.setPayloadSingleObject=function(t,e){this.$common.isArray(e)?this.$common.extendOwn(t,e[0]):this.$common.isObject(e)&&!this.$common.isFunction(e)&&this.$common.extendOwn(t,e)},e.prototype.createObjFromUrlParameters=function(t,e,r){var i=t;if(e.attr.length>1)for(var n="",o=1;o<e.attr.length;o++)e.attr[o].is?this.$utils.setData(e.attr[o].name,e.attr[o].value,i):(n.length>0?n+="."+e.attr[o].value:n+=e.attr[o].value,this.$utils.setData(n,{},i));return this.setPayloadSingleObject(i,r),i},e.prototype.createObjFromUrlParametersForEdit=function(t,e,r){var i=t;if(e.attr.length>1){for(var n="",o=1;o<e.attr.length;o++)e.attr[o].is?this.$utils.setData(e.attr[o].name,e.attr[o].value,i):(n.length>0?n+="."+e.attr[o].value:n+=e.attr[o].value,this.$utils.setData(n,{},i));return n.length>0&&this.$utils.setData(n,r,i),i}return r},e}(r(6).RequestHandler);e.GenericRequestHandler=o},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(9),s=r(1),a=function(){function t(){this.events={"pre-put":[],"pre-patch":[],"pre-post":[],"pre-get":[],"pre-delete":[],"pre-sync":[],"post-sync":[],"error-sync":[],"end-sync":[]}}return t.prototype.emit=function(t,e){},t}();e.InternEventEmitter=a;!function(t){function e(e,r,i,n){var o=t.call(this,e||"Error during XHR2 execution")||this;return o.name="XhrError",o.status=r||0,o.response=i||"",o.headers=n||{},o}n(e,t)}(Error);var l=function(){function t(t,e,r){this.sync=t,this.syncProcess=e,this.$options=r,this.$queue=[],this.$index=0,this.$stopSync=!1,this.$isRunning=!1,this.$forceRun=!1,this.logger=new s.Logger("SyncQueue"),this.$defaultDelay=r.syncTimeOut}return t.prototype.process=function(t){var e=this;return new Promise(function(r,i){try{e.syncProcess.process(t).then(function(){return r(!0)}).catch(function(t){return i(t)})}catch(t){e.logger.error(t),i(t)}})},t.prototype.next=function(){var t=this;if(!this.$stopSync){var e=this.sync.checkAndWaitUntilDbTransactionFinish();if(-1===e)return this.logger.warn("sync db lock not released, restart the sync process!"),void this.next();if(0!==e){var r=this.$index++,i=this.$queue[this.$index];this.sync._syncObj=this.$queue[r],this.logger.debug(this.$queue),this.sync._syncObj?this.process(this.sync._syncObj).then(function(){return t.doNext(i,t.sync._syncObj)&&setTimeout(t.next.bind(t),1)}).catch(function(e){t.logger.debug("unknown sync process error",e),t.rerun()}):this.rerun()}else this.next()}},t.prototype.runSync=function(t){var e=this;void 0===t&&(t=!1),this.$options.off||(t||"boolean"==typeof t||(t=!1),!1===this.$options.autoSync&&!1===t||(this.$options.isOnline()?this.$isRunning?this.$forceRun=!0:setTimeout(function(){e.$isRunning=!0,e.$stopSync=!1,e.sync.startSyncTransaction(),e.$queue=e.sync.getSyncLog().find();try{e.next()}catch(t){e.logger.debug(t),e.rerun()}},this.getDelay(t)):this.rerun()))},t.prototype.doNext=function(t,e){return!!t||(this.rerun(),this.sync._moduleEventEmitter.emit("end-sync",e),!1)},t.prototype.rerun=function(){this.sync._syncObj={},this.reset(),setTimeout(this.runSync.bind(this),this.getDelay())},t.prototype.stop=function(){this.sync.stopSyncTransaction(),this.$stopSync=!0,this.$isRunning=!1},t.prototype.reset=function(){this.stop(),this.$isRunning=!1,this.$index=0,this.$queue.length=0},t.prototype.status=function(){return{current:this.$index,obj:this.$queue[this.$index],size:this.$queue.length,isRunning:this.$isRunning}},t.prototype.getDelay=function(t){return void 0===t&&(t=!1),t?1:this.$forceRun?(this.$isRunning=!1,this.$forceRun=!1,1):this.sync._syncLogDirty?(this.sync._syncLogDirty=!1,1):this.$defaultDelay},t}();e.SyncQueue=l;var c=function(){function t(t,e,r,i){this.sync=t,this.$options=e,this.$handler=r,this.$utils=i,this.logger=new s.Logger("SyncProcess")}return t.prototype.storeError=function(t,e,r,i){Array.isArray(this.sync._syncObj.$error)||(t.$error=[]),t.$error.length>this.$options.maxSyncAttempts&&t.$error.shift(),t.$error.push({status:r||0,response:i||[],message:e||"Unknown error"}),t.$errorcounter=t.$error.length,this.sync.getSyncLog().update(t)},t.prototype.onError=function(t,e){try{if(this.logger.error(t,e),!(t instanceof XMLHttpRequest))return"SYNCID"in e&&this.$handler.dispatchInternEvent(400,"Bad Request",t,e.SYNCID),this.logger.error("unknown XHR error during the sync process"),!0;"SYNCID"in e&&this.$handler.dispatchInternEvent(t.status,t.statusText,t,e.SYNCID);var r=this.$utils.getXHRResponse(t)||[];this.sync._moduleEventEmitter.emit("error-sync",{response:r,status:t.status||0,message:t.statusText||"Unknown error"}),this.storeError(e,t.statusText,t.status,r)}catch(t){this.logger.error(t)}finally{return!0}},t.prototype.removeAfterReachHighCount=function(t){var e=this;!0===this.$options.autoRemoveAfterReachMaxAttemps&&new Promise(function(r){return r(e.sync.removeSyncEntry(t))}).catch(function(t){return e.onError(t.message,0)})},t.prototype.onSuccess=function(t,e){var r={status:e.status,statusText:e.statusText,response:this.$utils.getXHRResponse(e),headers:e.getAllResponseHeaders(),syncObj:t};return this.sync._moduleEventEmitter.emit("post-sync",r),"SYNCID"in t&&this.$handler.dispatchInternEvent(r.status,r.statusText,e,t.SYNCID),r},t.prototype.process=function(t){var e=this;return new Promise(function(r){if(0===e.$options.maxSyncAttempts||(t.$errorcounter||0)<=e.$options.maxSyncAttempts){e.logger.debug("process",t),e.sync._moduleEventEmitter.emit("pre-sync",t);var i=e.sync.cleanSyncLogObjectFromDBSpecificProperties(t,!0);e.sync.syncXhr2(i.method,i.url,i.headers,i.data,i.responseType,e.$options.syncTimeOut).then(e.onSuccess.bind(e,t)).then(function(r){return e.sync.removeSyncEntry(t),r}).then(e.$options.module.postSuccessOperations.bind(e.$options.module)).catch(function(r){return e.onError(r,t)}).then(function(){return r(!0)})}else e.removeAfterReachHighCount(t),r(!0)})},t}();e.SyncProcess=c;var h=function(){function t(t,e,r,i,n,h){var u=this;this.$events=t,this.$common=e,this.$options=r,this.$utils=i,this.$handler=n,this._syncRuns=!1,this._isDBTransaction=!1,this._defaultDBDelay=2e3,this._syncLogDirty=!1,this.dbname="sync",this._moduleEventEmitter=new a,this._dbTransactionLockCounter=0,this.logger=new s.Logger("Sync"),this.logHTTP=!1,this.logger.info("Sync.constructor"),this.prefix=r.dbPrefix,this.$db=new o.DB(this.prefix+"."+this.dbname,r,h),r.onDbPrefixChange=function(t,e){u.$db=new o.DB(e+"."+u.dbname,u.$options,h)};var p=new c(this,this.$options,this.$handler,this.$utils);this.operations=new l(this,p,this.$options)}return t.prototype._setLogHTTP=function(t){this.logHTTP=t},t.prototype.getSyncLog=function(t){return this.$db.getCollectionByName(t)},t.prototype.startDBTransaction=function(){return this._isDBTransaction=!0},t.prototype.commitDBTransaction=function(t){return t||(this._syncLogDirty=!0),this._isDBTransaction=!1},t.prototype.isDBTransaction=function(){return this._isDBTransaction},t.prototype.checkAndWaitUntilDbTransactionFinish=function(){return this._dbTransactionLockCounter+=this._dbTransactionLockCounter,!0===this.isDBTransaction()?this._dbTransactionLockCounter>10?(this._dbTransactionLockCounter=0,-1):0:(this._dbTransactionLockCounter=0,1)},t.prototype.isSyncRequest=function(t){if(this.$common.isEmpty(t))throw new Error("sync options is empty object, cannot be synced!");if(!t.hasOwnProperty("url"))throw new Error("options.url was not specified!");if(this.$common.isEmpty(t.url))throw new Error("options.url cannot be empty!");if(!t.hasOwnProperty("headers"))throw new Error("options.headers were not specified!");if(!this.$common.isObject(t.headers))throw new Error("options.headers is not a objects!");if(!t.hasOwnProperty("data"))throw new Error("options.data was not specified!");if(this.$common.isEmpty(t.data))throw new Error("options.data cannot be empty object!");if(!this.$common.isObject(t.data))throw new Error("options.data is not a object!");return!0},t.prototype.isDeleteSyncRequest=function(t){if(this.$common.isEmpty(t))throw new Error("sync options is empty object, cannot be synced!");if(!t.hasOwnProperty("url"))throw new Error("options.url was not specified!");if(this.$common.isEmpty(t.url))throw new Error("options.url cannot be empty!");if(!t.hasOwnProperty("headers"))throw new Error("options.headers were not specified!");if(!this.$common.isObject(t.headers))throw new Error("options.headers is not a objects!");return!0},t.prototype.buildDBObjectFindQuery=function(t){var e=this.isURLConfiguredForPersistence(t.url,!0),r={};if(this.$common.isEmpty(e.params)||"MCS"===this.$options.Module.getModuleName())if(e.tokens.length>0&&"MCS"!==this.$options.Module.getModuleName()){var i=e.tokens[0].name;if("data"in t&&i in t.data)r[n="data."+i]={$eq:t.data[i]}}else if("data"in t&&"$loki"in t.data&&"number"==typeof t.data.$loki&&!isNaN(t.data.$loki)){r[n="data.$loki"]={$eq:t.data.$loki}}else"$loki"in t&&"number"==typeof t.$loki&&!isNaN(t.$loki)&&(r={$loki:{$eq:t.$loki}});else{var n="data."+e.params[0].name,o=e.tokens[0].pattern.indexOf("d")>=0?parseInt(e.params[0].value,10):e.params[0].value+"";r[n]={$eq:o}}return{dbquery:r,url:e.path,queryUrl:e}},t.prototype.isURLConfiguredForPersistence=function(t,e){void 0===e&&(e=!1);var r=this.$options.isPersistentUrl(t);if(!1===r)throw this.logger.error("give url not configured for persistence",t),new Error("give url not configured for persistence:"+t);return r},t.prototype.handleGet=function(t){if(this.logger.info("handleGet",t),this.$common.isEmpty(t))throw new Error("sync options is empty object, cannot be synced!");if(!t.hasOwnProperty("url"))throw new Error("options.url was not specified!");if(this.$common.isEmpty(t.url))throw new Error("options.url cannot be empty!");if(!t.hasOwnProperty("headers"))throw new Error("request headers were not specified!");return this.$common.isEmpty(t.data)||(t.data={}),t.method="GET",this._moduleEventEmitter.emit("pre-get",t),this.getSyncLog().insert(t)},t.prototype.handlePost=function(t){this.logger.info("Sync.handlePost",t),this.isSyncRequest(t);var e=this.isURLConfiguredForPersistence(t.url);return"$loki"in t&&"number"==typeof t.$loki&&!isNaN(t.$loki)&&delete t.$loki,t.method="POST",t.URI=e.root,this._moduleEventEmitter.emit("pre-post",t),this.getSyncLog().insert(t)},t.prototype.handlePut=function(t){this.logger.info("Sync.handlePut",t),this.isSyncRequest(t);var e=this.buildDBObjectFindQuery(t),r=this.getSyncLog();if(this._moduleEventEmitter.emit("pre-put",t),this.$common.isEmpty(e.dbquery))return t.method="PUT",t.URI=e.queryUrl.root,r.insert(t);var i=r.findOne({$and:[e.dbquery,{method:"POST"},{URI:e.queryUrl.root}]});return i?(this._syncObj&&!this.$common.isEmpty(this._syncObj)&&"$loki"in this._syncObj&&this._syncObj.$loki===i.$loki&&setTimeout(this.handlePut.bind(this,t),this._defaultDBDelay),this.$common.extendOwn(i.data,t.data),this.$common.extendOwn(i.headers,t.headers),i.$errorcounter=0,r.update(i)):(i=r.findOne({$and:[e.dbquery,{method:"PUT"},{URI:e.queryUrl.root}]}))?(this._syncObj&&!this.$common.isEmpty(this._syncObj)&&"$loki"in this._syncObj&&this._syncObj.$loki===i.$loki&&setTimeout(this.handlePut.bind(this,t),this._defaultDBDelay),this.$common.extendOwn(i,t),i.$errorcounter=0,r.update(i)):(t.method="PUT",t.URI=e.queryUrl.root,r.insert(t))},t.prototype.handlePatch=function(t){this.logger.info("Sync.handlePatch",t),this.isSyncRequest(t);var e=this.buildDBObjectFindQuery(t),r=this.getSyncLog();if(this._moduleEventEmitter.emit("pre-patch",t),this.$common.isEmpty(e.dbquery))return t.method="PATCH",t.URI=e.queryUrl.root,r.insert(t);var i=r.findOne({$and:[e.dbquery,{method:"POST"},{URI:e.queryUrl.root}]});return i?(this._syncObj&&!this.$common.isEmpty(this._syncObj)&&"$loki"in this._syncObj&&this._syncObj.$loki===i.$loki&&setTimeout(this.handlePut.bind(this,t),this._defaultDBDelay),this.$common.extendOwn(i.data,t.data),this.$common.extendOwn(i.headers,t.headers),i.$errorcounter=0,r.update(i)):(i=r.findOne({$and:[e.dbquery,{method:"PATCH"},{URI:e.queryUrl.root}]}))?(this._syncObj&&!this.$common.isEmpty(this._syncObj)&&"$loki"in this._syncObj&&this._syncObj.$loki===i.$loki&&setTimeout(this.handlePatch.bind(this,t),this._defaultDBDelay),this.$common.extendOwn(i,t),i.$errorcounter=0,r.update(i)):(t.method="PATCH",t.URI=e.queryUrl.root,r.insert(t))},t.prototype.handleDelete=function(t){this.logger.info("Sync.handleDelete",t),this.isDeleteSyncRequest(t);var e=this.buildDBObjectFindQuery(t);this._moduleEventEmitter.emit("pre-delete",t);var r=this.getSyncLog();if(this.$common.isEmpty(e.dbquery))return t.method="DELETE",t.URI=e.queryUrl.root,r.insert(t);var i=r.findOne({$and:[e.dbquery,{URI:e.queryUrl.root},{method:{$eq:"POST"}}]});return i?(this._syncObj&&!this.$common.isEmpty(this._syncObj)&&"$loki"in this._syncObj&&this._syncObj.$loki===i.$loki&&setTimeout(this.handleDelete.bind(this,t),this._defaultDBDelay),r.remove(i)):(i=r.findOne({$and:[e.dbquery,{URI:e.queryUrl.root},{method:{$eq:"PUT"}}]}))?(this._syncObj&&!this.$common.isEmpty(this._syncObj)&&"$loki"in this._syncObj&&this._syncObj.$loki===i.$loki&&setTimeout(this.handleDelete.bind(this,t),this._defaultDBDelay),i.url=t.url,i.method="DELETE",i.URI=e.queryUrl.root,"data"in t&&(i.data=t.data),i.$errorcounter=0,r.update(i)):(t.method="DELETE",t.URI=e.queryUrl.root,r.insert(t))},t.prototype.removeSyncEntry=function(t){if(this.$common.isEmpty(t))throw new Error("removeSync(request) is empty cannot be removed from the sync log!");if(!this.$common.isObject(t))throw new Error("removeSync(request) is not a object!");if(!t.hasOwnProperty("url"))throw new Error("request.url was not specified!");if(this.$common.isEmpty(t.url))throw new Error("request.url cannot be empty!");if(!("$loki"in t&&"number"==typeof t.$loki)||isNaN(t.$loki))throw new Error("removeSync(request.$loki) does not exist to be able to be removed from the sync table!");var e=this.getSyncLog(),r=e.findOne({$loki:t.$loki});if(r)return e.remove(r)},t.prototype.syncXhr2=function(t,e,r,i,n,o){var s=this;return new Promise(function(a,l){s.$options.oneOff();var c=new XMLHttpRequest;for(var h in"withCredentials"in c&&(c.withCredentials=!0),n&&(c.responseType=n),c.open(t,e,!0),r)if(r.hasOwnProperty(h)){var u=r[h];c.setRequestHeader(h,u)}if(!r["Oracle-Mobile-Client-SDK-Info"]){var p=s.$options.isCordova?"Cordova":"Web";p+=" 18.3.3.0",p+=" [SyncExpress]",c.setRequestHeader("Oracle-Mobile-Client-SDK-Info",p)}if(c.timeout=o||s.$options.timeout,c.ontimeout=function(t){s.logger.error("sync.xhr.ontimeout",t),s.$events.$emit("timeout",{event:t}),l(new TypeError("Timeout during XHR load"))},c.onload=function(){if(c.status>=200&&c.status<400){if(s.logHTTP){var r={headers:c.getAllResponseHeaders(),body:""===c.responseType||"text"===c.responseType?c.responseText:c.response};s.logger.debug("Received "+t+" response from "+e,r)}a(c)}else l(c)},c.onerror=function(){s.logger.debug("sync.xhr.onerror",c),s.$events.$emit("error",{event:c}),l(c)},s.logHTTP){var d={headers:r,body:i};s.logger.debug("Sent "+t+" request to "+e,d)}c.send(i&&void 0!==i&&null!=i&&"DELETE"!==t?JSON.stringify(i):null)})},t.prototype.cleanSyncLogObjectFromDBSpecificProperties=function(t,e){var r=e?JSON.parse(JSON.stringify(t)):t;if("data"in r&&null!=r.data&&this.$common.isObject(r.data)&&!this.$common.isEmpty(r.data)){"$loki"in r.data&&"number"==typeof r.data.$loki&&!isNaN(r.data.$loki)&&delete r.data.$loki,"meta"in r.data&&delete r.data.meta;for(var i=0,n=r.data;i<n.length;i++){var o=n[i];this.$common.stringStartsWith(o,"$mcs$")&&delete r.data[o]}}return r},t.prototype.flushCollection=function(t){var e=this;if(this.logger.info("Persistence.Sync.flush()",t),this.$common.isEmpty(t))return this.$db.flush();var r=this.isURLConfiguredForPersistence(t);return new Promise(function(t,i){!0===e._syncRuns?i(new Error("unable to proceed with this operation, sync is in process")):t(e.getSyncLog(r.root).removeDataOnly())})},t.prototype.startSyncTransaction=function(){this._syncRuns=!0},t.prototype.stopSyncTransaction=function(){this._syncRuns=!1},t.prototype.statusSyncTransaction=function(){return this._syncRuns},t.prototype.responsePromise=function(t,e,r){var i=this;r.then(function(e){i.commitDBTransaction(!1),t(e)}).catch(function(t){i.commitDBTransaction(!0),i.logger.error(t),e(t)})},t.prototype.getDB=function(){return this.$db},t.prototype.getHistory=function(t){var e=this;return new Promise(function(r){return r(e.getSyncLog(t))})},t.prototype.get=function(t){var e=this;return new Promise(function(r,i){e.startDBTransaction();var n=new Promise(function(r){r(e.handleGet(t))});e.responsePromise(r,i,n)})},t.prototype.post=function(t){var e=this;return new Promise(function(r,i){e.startDBTransaction();var n=new Promise(function(r){r(e.handlePost(t))});e.responsePromise(r,i,n)})},t.prototype.put=function(t){var e=this;return new Promise(function(r,i){e.startDBTransaction();var n=new Promise(function(r){r(e.handlePut(t))});e.responsePromise(r,i,n)})},t.prototype.patch=function(t){var e=this;return new Promise(function(r,i){e.startDBTransaction();var n=new Promise(function(r){r(e.handlePatch(t))});e.responsePromise(r,i,n)})},t.prototype.delete=function(t){var e=this;return new Promise(function(r,i){e.startDBTransaction();var n=new Promise(function(r){r(e.handleDelete(t))});e.responsePromise(r,i,n)})},t.prototype.router=function(t){var e=this;return new Promise(function(r,i){new Promise(function(r){r(function(t){if(e.$common.isEmpty(t))throw e.logger.error("sync router request was not provided!",t),new Error("sync router request was not provided!");if(!t.hasOwnProperty("method")&&!e.$common.isEmpty(t.method))throw e.logger.error("sync router method was not provided!",t),new Error("sync router method was not provided!");var r=e.$common.clone(t);if(r.method=e.$utils._normalizeMethod(r.method),!e[r.method])throw e.logger.error("specified router is not implemented!"),new Error("specified router is not implemented!");return new Promise(function(t){t(e[r.method](r))})}(t))}).then(function(t){r(t)}).catch(function(t){return i(t)})})},t.prototype.removeSync=function(t){var e=this;return new Promise(function(t){t(e.removeSyncEntry(e.$options))})},t}();e.Sync=h},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(1),s=function(){function t(){this.i=0,this.listeners={},this.ttl=3e4,this.ttlInterval=12e4,this.daemon=null,this.logger=new o.Logger("Handler")}return t.prototype.addListener=function(t,e,r){if(this.cleanEventsJob(),null==t)throw new Error("event name cannot be null or undefined");if(null==e||"function"!=typeof e)throw new Error("event handler cannot be null or undefined function");var i=window;return null!=r||"boolean"==typeof r?i.addEventListener(t,e,r):i.addEventListener(t,e),this.listeners[t]={event:t,element:i,handler:e,capture:r,timestamp:(new Date).getTime()},this.listeners[t]},t.prototype.removeInternListener=function(t){null!=t&&this.listeners.hasOwnProperty(t)&&(this.listeners[t].element.removeEventListener(this.listeners[t].event,this.listeners[t].handler,this.listeners[t].capture),delete this.listeners[t])},t.prototype.removeAllListeners=function(){for(var t in this.listeners)this.listeners.hasOwnProperty(t)&&"object"==typeof this.listeners[t]&&(this.listeners[t].element.removeEventListener(this.listeners[t].event,this.listeners[t].handler,this.listeners[t].capture),delete this.listeners[t])},t.prototype.showAll=function(){for(var t in this.listeners)this.listeners.hasOwnProperty(t)&&this.logger.debug("showAll","event details: ",this.listeners[t])},t.prototype.getInternAllEvents=function(){return this.listeners},t.prototype.getInternListener=function(t){if(this.listeners.hasOwnProperty(t)&&"object"==typeof this.listeners[t])return this.listeners[t]},t.prototype.dispatchInternEvent=function(t,e,r,i){var n=this;if(window.CustomEvent&&(this.listeners.hasOwnProperty(i)||"object"!=typeof this.listeners[i])){var o=new CustomEvent(i,{detail:{status:t,statusText:e,data:r,requestid:i,time:(new Date).getTime()},bubbles:!0,cancelable:!0});setTimeout(function(){try{window.dispatchEvent(o)}catch(t){n.logger.error(t)}finally{setTimeout(function(){n.removeInternListener(i)},0)}},0)}},t.prototype.cleanEventsJob=function(){var t=this.ttl,e=Date.now(),r=this.getInternAllEvents();for(var i in r){if(r.hasOwnProperty(i))t<e-this.listeners[i].timestamp&&this.removeInternListener(i)}},t.prototype.setTTL=function(t,e){t<0?null!=this.daemon&&clearInterval(this.daemon):0==t?this.cleanEventsJob():(this.ttl=t||this.ttl,this.ttlInterval=e||this.ttlInterval,this.daemon=setInterval(this.cleanEventsJob,this.ttlInterval))},t}();e.Handler=s;var a=function(){function t(){this.observers={success:[],error:[],timeout:[]}}return t.prototype.$on=function(t,e){null!==t&&"string"==typeof t&&this.observers.hasOwnProperty(t)&&"function"==typeof e&&this.observers[t].push(e)},t.prototype.$emit=function(t,e){if(null!==t&&"string"==typeof t&&this.observers.hasOwnProperty(t)&&null!==e)for(var r=0;r<this.observers[t].length;r++)this.observers[t][r](e)},t.prototype.$flush=function(t){if(null!==t&&"string"==typeof t&&this.observers.hasOwnProperty(t))for(var e=this.observers[t].length-1;e>=0;e--)this.observers[t].splice(0,1)},t.prototype.$show=function(t){throw new Error("not implemented")},t}();e.Events=a;var l=function(){function t(){this.events={},this.asyncListeners=!1}return t.prototype.on=function(t,e){var r=this.events[t];return r||(r=this.events[t]=[]),r.push(e),e},t.prototype.emit=function(t,e){var r=this;if(!t||!this.events[t])throw new Error("No event "+t+" defined");this.events[t].forEach(function(t){r.asyncListeners?setTimeout(function(){return t(e)},1):t(e)})},t.prototype.removeListener=function(t,e){if(this.events[t]){var r=this.events[t];r.splice(r.indexOf(e),1)}},t}();e.EventsEmitter=l;var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.events={},e.asyncListeners=!1,e}return n(e,t),e}(l);e.PersistenceEventEmitter=c},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.ArrayProto=Array.prototype,this.ObjProto=Object.prototype,this.FuncProto=Function.prototype,this.push=this.ArrayProto.push,this.slice=this.ArrayProto.slice,this.toString=this.ObjProto.toString,this.hasOwnProperty=this.ObjProto.hasOwnProperty,this.nativeIsArray=Array.isArray,this.nativeKeys=Object.keys,this.nativeBind=this.FuncProto.bind,this.nativeCreate=Object.create,this.extendOwn=this.extender(!1),this.extend=this.extender(!0),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.findIndex||(Array.prototype.findIndex=function(t){if(null===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,r=Object(this),i=r.length>>>0,n=arguments[1],o=0;o<i;o++)if(e=r[o],t.call(n,e,o,r))return o;return-1}.bind(this)),Array.prototype.filter||(Array.prototype.filter=function(t){if(void 0===this||null===this)throw new TypeError;var e=Object(this),r=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var i=[],n=arguments.length>=2?arguments[1]:void 0,o=0;o<r;o++)if(o in e){var s=e[o];t.call(n,s,o,e)&&i.push(s)}return i}.bind(this))}return t.prototype.type=function(t){return Object.prototype.toString.call(t).replace(/^\[object (.+)\]$/,"$1").toLowerCase()},t.prototype.stringStartsWith=function(t,e){return"string"===this.type(t)&&t.slice(0,e.length)===e},t.prototype.stringEndsWith=function(t,e){return"string"===this.type(t)&&(""===e||t.slice(-e.length)===e)},t.prototype.clone=function(t){t=t||{};return JSON.parse(JSON.stringify(t))},t.prototype.cleanObjects=function(t){var e=[];for(var r in t)if(t.hasOwnProperty(r)){var i=this.cleanObject(t[r]);e.push(i)}return e},t.prototype.cleanObject=function(t){var e=this.clone(t);return delete e.$loki,delete e.meta,e},t.prototype.getUID=function(){return Math.floor(4294967296*Math.random())+""},t.prototype.isTypeOf=function(t,e){return toString.call(e)==="[object "+t+"]"},t.prototype.isDate=function(t){return this.isTypeOf("Date",t)},t.prototype.isString=function(t){return this.isTypeOf("String",t)},t.prototype.isUndefined=function(t){return void 0===t},t.prototype.has=function(t,e){return null!=t&&this.hasOwnProperty.call(t,e)},t.prototype.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},t.prototype.isNaN=function(t){return this.isNumber(t)&&t!==+t},t.prototype.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===toString.call(t)},t.prototype.isEmpty=function(t){if(null===t)return!0;if(this.isArrayLike(t)&&(this.isArray(t)||"string"==typeof t||this.isFunction(t.splice)||this.isFunction(t.callee)))return!t.length;if(t&&"object"==typeof t){var e=t.toString();if("[object Map]"==e||"[object Set]"==e)return!t.size}for(var r in t)if(t.hasOwnProperty(r))return!1;return!t||!this.isNumber(t)},t.prototype.isArrayLike=function(t){return t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&t.length%1==0},t.prototype.isArray=function(t){return Array.isArray(t)},t.prototype.isFunction=function(t){return"function"==typeof t||!1},t.prototype.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},t.prototype.isNull=function(t){return null===t},t.prototype.isNumber=function(t){return"number"==typeof t||"[object Number]"==t.toString()},t.prototype.extender=function(t){return function(e){var r=arguments.length;if(null==e||r<2)return e;for(var i=1;i<r;i++){var n=arguments[i];if(n&&this.isObject(n))for(var o in n)(t||n.hasOwnProperty(o))&&(e[o]=n[o])}return e}},t.prototype.identity=function(t){return t},t.prototype.deepExtend=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r,i,n,o,s,a,l=arguments[0]||{},c=1,h=arguments.length,u=!1,p=Object.prototype.toString,d=Object.prototype.hasOwnProperty,f=(Array.prototype.push,Array.prototype.slice,String.prototype.trim,Array.prototype.indexOf,{"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"}),y={isFunction:function(t){return"function"===y.type(t)},isArray:Array.isArray||function(t){return"array"===y.type(t)},isWindow:function(t){return null!=t&&t==t.window},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},type:function(t){return null==t?String(t):f[p.call(t)]||"object"},isPlainObject:function(t){if(!t||"object"!==y.type(t)||t.nodeType)return!1;try{if(t.constructor&&!d.call(t,"constructor")&&!d.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var e;for(e in t);return void 0===e||d.call(t,e)}};for("boolean"==typeof l&&(u=l,l=arguments[1]||{},c=2),"object"==typeof l||y.isFunction(l)||(l={}),h===c&&(l=this,--c);c<h;c++)if(null!=(r=arguments[c]))for(i in r)n=l[i],l!==(o=r[i])&&(u&&o&&(y.isPlainObject(o)||(s=y.isArray(o)))?(s?(s=!1,a=n&&y.isArray(n)?n:[]):a=n&&y.isPlainObject(n)?n:{},l[i]=this.deepExtend(u,a,o)):void 0!==o&&(l[i]=o));return l},t}();e.Common=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,r){this.$options=t,this.$common=e,this.$handler=r}return t.prototype.run=function(t){this.$options.oneOn(),t()},t.prototype.runWithoutReadInBackground=function(t){this.$options.dbFirstFalseForNextCall(),t()},t.prototype.listener=function(t,e){void 0!==this.$handler&&t&&this.$handler.addListener(t,function(t){e(t.detail)},!1)},t.prototype.registerRequestCompletedCallback=function(e,r){void 0!==this.$handler&&null!==e&&(this.$common.isNumber(e)?this.$handler.addListener(e,function(t){r(t.detail.data,t.detail.status,t.detail.statusText,t.detail.requestid,t.detail.time)},!1):this.$common.isObject(e)&&(e.hasOwnProperty(t.REQUEST_ID)?this.$handler.addListener(e[t.REQUEST_ID],function(t){r(t.detail.data,t.detail.status,t.detail.statusText,t.detail.requestid,t.detail.time)},!1):"function"==typeof e.getResponseHeader&&null!=e.getResponseHeader(t.REQUEST_ID)&&this.$handler.addListener(e.getResponseHeader(t.REQUEST_ID),function(t){r(t.detail.data,t.detail.status,t.detail.statusText,t.detail.requestid,t.detail.time)},!1)))},t.REQUEST_ID="Request-ID",t}();e.Process=i},function(t,e,r){"use strict";t.exports=function(t,e){e=e||{};for(var r={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},i=r.parser[e.strictMode?"strict":"loose"].exec(t),n={},o=14;o--;)n[r.key[o]]=i[o]||"";return n[r.q.name]={},n[r.key[12]].replace(r.q.parser,function(t,e,i){e&&(n[r.q.name][e]=i)}),n}},function(t,e){t.exports=h,t.exports.parse=o,t.exports.compile=function(t,e){return s(o(t,e))},t.exports.tokensToFunction=s,t.exports.tokensToRegExp=c;var r="/",i="./",n=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function o(t,e){for(var o,s,l=[],c=0,h=0,u="",p=e&&e.delimiter||r,d=e&&e.delimiters||i,f=!1;null!==(o=n.exec(t));){var y=o[0],m=o[1],g=o.index;if(u+=t.slice(h,g),h=g+y.length,m)u+=m[1],f=!0;else{var v="",b=t[h],E=o[2],O=o[3],w=o[4],P=o[5];if(!f&&u.length){var R=u.length-1;d.indexOf(u[R])>-1&&(v=u[R],u=u.slice(0,R))}u&&(l.push(u),u="",f=!1);var I=""!==v&&void 0!==b&&b!==v,S="+"===P||"*"===P,_="?"===P||"*"===P,$=v||p,A=O||w;l.push({name:E||c++,prefix:v,delimiter:$,optional:_,repeat:S,partial:I,pattern:A?(s=A,s.replace(/([=!:$/()])/g,"\\$1")):"[^"+a($)+"]+?"})}}return(u||h<t.length)&&l.push(u+t.substr(h)),l}function s(t){for(var e=new Array(t.length),r=0;r<t.length;r++)"object"==typeof t[r]&&(e[r]=new RegExp("^(?:"+t[r].pattern+")$"));return function(r,i){for(var n="",o=i&&i.encode||encodeURIComponent,s=0;s<t.length;s++){var a=t[s];if("string"!=typeof a){var l,c=r?r[a.name]:void 0;if(Array.isArray(c)){if(!a.repeat)throw new TypeError('Expected "'+a.name+'" to not repeat, but got array');if(0===c.length){if(a.optional)continue;throw new TypeError('Expected "'+a.name+'" to not be empty')}for(var h=0;h<c.length;h++){if(l=o(c[h],a),!e[s].test(l))throw new TypeError('Expected all "'+a.name+'" to match "'+a.pattern+'"');n+=(0===h?a.prefix:a.delimiter)+l}}else if("string"!=typeof c&&"number"!=typeof c&&"boolean"!=typeof c){if(!a.optional)throw new TypeError('Expected "'+a.name+'" to be '+(a.repeat?"an array":"a string"));a.partial&&(n+=a.prefix)}else{if(l=o(String(c),a),!e[s].test(l))throw new TypeError('Expected "'+a.name+'" to match "'+a.pattern+'", but got "'+l+'"');n+=a.prefix+l}}else n+=a}return n}}function a(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function l(t){return t&&t.sensitive?"":"i"}function c(t,e,n){for(var o=(n=n||{}).strict,s=!1!==n.end,c=a(n.delimiter||r),h=n.delimiters||i,u=[].concat(n.endsWith||[]).map(a).concat("$").join("|"),p="",d=0===t.length,f=0;f<t.length;f++){var y=t[f];if("string"==typeof y)p+=a(y),d=f===t.length-1&&h.indexOf(y[y.length-1])>-1;else{var m=a(y.prefix),g=y.repeat?"(?:"+y.pattern+")(?:"+m+"(?:"+y.pattern+"))*":y.pattern;e&&e.push(y),y.optional?y.partial?p+=m+"("+g+")?":p+="(?:"+m+"("+g+"))?":p+=m+"("+g+")"}}return s?(o||(p+="(?:"+c+")?"),p+="$"===u?"$":"(?="+u+")"):(o||(p+="(?:"+c+"(?="+u+"))?"),d||(p+="(?="+c+"|"+u+")")),new RegExp("^"+p,l(n))}function h(t,e,r){return t instanceof RegExp?function(t,e){if(!e)return t;var r=t.source.match(/\((?!\?)/g);if(r)for(var i=0;i<r.length;i++)e.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,pattern:null});return t}(t,e):Array.isArray(t)?function(t,e,r){for(var i=[],n=0;n<t.length;n++)i.push(h(t[n],e,r).source);return new RegExp("(?:"+i.join("|")+")",l(r))}(t,e,r):(i=e,c(o(t,n=r),i,n));var i,n}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),n=r(56),o=r(55),s=function(){function t(t){this.$common=t,this.$db=null,this.dbFirst=!0,this._isCordova=void 0!==window.cordova,this.timeout=3e4,this.syncTimeout=3e4,this.isPersistUri={},this.persistUri=[],this.isPersistUrlCache={},this.parseUrlCache={},this.on=null,this.passOne=!1,this.alwayson=!0,this.alwaysoff=!1,this.dbFirstFalseForNextCallBool=!1,this.maxsyncattempts=0,this.autoremoveafterreachmaxattemps=!1,this.autoSync=!1,this.offlinedbname="offline",this.synclogdbname="synclog",this.dbprefix="persist",this.isTest=!1,this.logger=new i.Logger("Options"),this.periodicRefreshPolicy={PERIODIC_REFRESH_POLICY_REFRESH_NONE:"PERIODIC_REFRESH_POLICY_REFRESH_NONE",PERIODIC_REFRESH_POLICY_REFRESH_EXPIRED_ITEM_ON_STARTUP:"PERIODIC_REFRESH_POLICY_REFRESH_EXPIRED_ITEM_ON_STARTUP",PERIODIC_REFRESH_POLICY_PERIODICALLY_REFRESH_EXPIRED_ITEMS:"PERIODIC_REFRESH_POLICY_PERIODICALLY_REFRESH_EXPIRED_ITEMS"},this.fetchPolicy={FETCH_FROM_CACHE:"FETCH_FROM_CACHE",FETCH_FROM_SERVICE:"FETCH_FROM_SERVICE",FETCH_FROM_SERVICE_IF_ONLINE:"FETCH_FROM_SERVICE_IF_ONLINE",FETCH_FROM_SERVICE_ON_CACHE_MISS:"FETCH_FROM_SERVICE_ON_CACHE_MISS",FETCH_FROM_SERVICE_ON_CACHE_MISS_OR_EXPIRY:"FETCH_FROM_SERVICE_ON_CACHE_MISS_OR_EXPIRY",FETCH_FROM_CACHE_SCHEDULE_REFRESH:"FETCH_FROM_CACHE_SCHEDULE_REFRESH",FETCH_WITH_REFRESH:"FETCH_WITH_REFRESH"},this.expirationPolicy={EXPIRE_ON_RESTART:"EXPIRE_ON_RESTART",EXPIRE_AFTER:"EXPIRE_AFTER",NEVER_EXPIRE:"NEVER_EXPIRE"},this.evictionPolicy={EVICT_ON_EXPIRY_AT_STARTUP:"EVICT_ON_EXPIRY_AT_STARTUP",MANUAL_EVICTION:"MANUAL_EVICTION"},this.updatePolicy={UPDATE_IF_ONLINE:"UPDATE_IF_ONLINE",QUEUE_IF_OFFLINE:"QUEUE_IF_OFFLINE"},this.conflictPolicy={CLIENT_WINS:"CLIENT_WINS",PRESERVE_CONFLICT:"PRESERVE_CONFLICT",SERVER_WINS:"SERVER_WINS"},this.clientPolicies={periodicRefreshPolicy:this.periodicRefreshPolicy.PERIODIC_REFRESH_POLICY_REFRESH_NONE,periodicRefreshInterval:120,policies:[]},this.defaultPolicy={periodicRefreshPolicy:this.periodicRefreshPolicy.PERIODIC_REFRESH_POLICY_REFRESH_NONE,conflictResolutionPolicy:this.conflictPolicy.PRESERVE_CONFLICT,evictionPolicy:this.evictionPolicy.MANUAL_EVICTION,expirationPolicy:this.expirationPolicy.EXPIRE_ON_RESTART,expireAfter:Number.MAX_VALUE,fetchPolicy:this.fetchPolicy.FETCH_FROM_SERVICE_IF_ONLINE,noCache:!1,updatePolicy:this.updatePolicy.UPDATE_IF_ONLINE},this.clientPolicies.default=this.defaultPolicy}return Object.defineProperty(t.prototype,"syncTimeOut",{get:function(){return this.syncTimeout},set:function(t){"number"==typeof t&&(this.syncTimeout=t||this.syncTimeout)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"persistUris",{get:function(){return this.persistUri},set:function(t){this.parsePathConfig(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onTimeOut",{set:function(t){"function"==typeof t&&(this.ontimeout=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onError",{set:function(t){"function"==typeof t&&(this.onerror=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onSuccess",{set:function(t){"function"==typeof t&&(this.onsuccess=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isonline",{set:function(t){"function"==typeof t&&(this.isOnline=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alwaysOn",{set:function(t){this.alwayson=!!t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"off",{get:function(){return this.alwaysoff},set:function(t){this.alwaysoff="boolean"==typeof t&&t},enumerable:!0,configurable:!0}),t.prototype.switchOff=function(t){void 0===t&&(t=!0),this.alwaysoff="boolean"==typeof t&&t},Object.defineProperty(t.prototype,"maxSyncAttempts",{get:function(){return this.maxsyncattempts},set:function(t){this.setMaxSyncAttempts(t)},enumerable:!0,configurable:!0}),t.prototype.setMaxSyncAttempts=function(t){"number"==typeof t&&(this.maxsyncattempts=t||this.maxsyncattempts)},Object.defineProperty(t.prototype,"autoRemoveAfterReachMaxAttemps",{get:function(){return this.autoremoveafterreachmaxattemps},set:function(t){this.setAutoRemoveAfterReachMaxAttempts(t)},enumerable:!0,configurable:!0}),t.prototype.setAutoRemoveAfterReachMaxAttempts=function(t){"boolean"==typeof t&&(this.autoremoveafterreachmaxattemps=t||this.autoremoveafterreachmaxattemps)},t.prototype.ondbprefixchange=function(t,e){this.dbprefixchangehandler(t,e)},Object.defineProperty(t.prototype,"onDbPrefixChange",{set:function(t){"function"==typeof t&&(this.ondbprefixchange=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dbPrefix",{get:function(){return this.dbprefix},set:function(t){if("string"==typeof t){var e=this.dbprefix;this.dbprefix=t,this.ondbprefixchange(e,this.dbprefix)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offlineDBName",{get:function(){return this.offlinedbname},set:function(t){"string"==typeof t&&(this.offlinedbname=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"module",{get:function(){return this._module},set:function(t){this.setModule(t)},enumerable:!0,configurable:!0}),t.prototype.setModule=function(t){if(!t)throw new Error("provide module implementation");this._module=t},Object.defineProperty(t.prototype,"Module",{get:function(){return this._module},set:function(t){if(!t)throw new Error("provide module implementation");this._module=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"syncLogDBName",{get:function(){return this.synclogdbname},set:function(t){"string"==typeof t&&(this.synclogdbname=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Policies",{get:function(){return this.clientPolicies},set:function(t){this.setPolicies(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DefaultPolicies",{get:function(){return this.defaultPolicy},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCordova",{get:function(){return this._isCordova},enumerable:!0,configurable:!0}),t.prototype.dbprefixchangehandler=function(t,e){return this.logger.debug(" changed from "+t+" to "+e),e},t.prototype.setPolicies=function(t){if(!t)throw this.logger.error("config cannot be empty object"),new Error("config cannot be empty object");if(!this.$common.isObject(t))throw this.logger.error("policy is not object"),new Error("policy is not object");var e,r=!1;for(e in t)if(t.hasOwnProperty(e)){r=!0;break}if(!r)throw this.logger.error("policy object does not contain any properties!"),new Error("policy object does not contain any properties!");this.setDefaultPolicies(t),this.setUrlPolicies(t)},t.prototype.setDefaultPolicies=function(t){t.hasOwnProperty("default")&&(this.logger.debug("apply new default policies"),t.default.conflictResolutionPolicy in this.conflictPolicy&&(this.defaultPolicy.conflictResolutionPolicy=t.default.conflictResolutionPolicy||this.conflictPolicy.PRESERVE_CONFLICT),t.default.evictionPolicy in this.evictionPolicy&&(this.defaultPolicy.evictionPolicy=t.default.evictionPolicy||this.evictionPolicy.MANUAL_EVICTION),t.default.expirationPolicy in this.expirationPolicy&&(this.defaultPolicy.expirationPolicy=t.default.expirationPolicy||this.expirationPolicy.EXPIRE_ON_RESTART),"number"==typeof t.default.expireAfter&&(this.defaultPolicy.expireAfter=t.default.expireAfter||Number.MAX_VALUE),t.default.fetchPolicy in this.fetchPolicy&&(this.defaultPolicy.fetchPolicy=t.default.fetchPolicy||this.fetchPolicy.FETCH_FROM_SERVICE_IF_ONLINE),"boolean"==typeof t.default.noCache&&(this.defaultPolicy.noCache=t.default.noCache||!1),t.default.updatePolicy in this.updatePolicy&&(this.defaultPolicy.updatePolicy=t.default.updatePolicy||this.updatePolicy.UPDATE_IF_ONLINE))},t.prototype.setUrlPolicies=function(t){if(t.hasOwnProperty("periodicRefreshPolicy")&&this.periodicRefreshPolicy.hasOwnProperty(t.periodicRefreshPolicy)&&(this.clientPolicies.periodicRefreshPolicy=t.periodicRefreshPolicy||this.periodicRefreshPolicy.PERIODIC_REFRESH_POLICY_REFRESH_NONE),t.hasOwnProperty("periodicRefreshInterval")&&"number"==typeof t.periodicRefreshInterval&&(this.clientPolicies.periodicRefreshInterval=t.periodicRefreshInterval||12e4),!t.hasOwnProperty("policies"))throw this.logger.error("synchronisation configuration requires path policies"),new Error("synchronisation configuration requires path policies");this.parsePathConfig(t.policies)},t.prototype.setPolicyForURL=function(t){var e=JSON.parse(JSON.stringify(this.defaultPolicy));return"conflictResolutionPolicy"in t&&t.conflictResolutionPolicy in this.conflictPolicy&&(e.conflictResolutionPolicy=t.conflictResolutionPolicy||this.conflictPolicy.PRESERVE_CONFLICT),"evictionPolicy"in t&&t.evictionPolicy in this.evictionPolicy&&(e.evictionPolicy=t.evictionPolicy||this.evictionPolicy.MANUAL_EVICTION),"expirationPolicy"in t&&t.expirationPolicy in this.expirationPolicy&&(e.expirationPolicy=t.expirationPolicy||this.expirationPolicy.EXPIRE_ON_RESTART),"expireAfter"in t&&"number"==typeof t.expireAfter&&(e.expireAfter=t.expireAfter||Number.MAX_VALUE),"fetchPolicy"in t&&t.fetchPolicy in this.fetchPolicy&&(e.fetchPolicy=t.fetchPolicy||this.fetchPolicy.FETCH_FROM_SERVICE_IF_ONLINE),"noCache"in t&&"boolean"==typeof t.noCache&&(e.noCache=t.noCache||!1),"updatePolicy"in t&&t.updatePolicy in this.updatePolicy&&(e.updatePolicy=t.updatePolicy||this.updatePolicy.UPDATE_IF_ONLINE),e},t.prototype.parsePathConfig=function(t){if(!Array.isArray(t))throw this.logger.error("Persistence.Options.persistUris","param should be array!"),new Error("Persistence.Options.persistUris");var e=this.pathMatch({sensitive:!0,strict:!1,end:!0}),r=[];if(this.clientPolicies.policies=t,null!=t&&Array.isArray(t)){for(var i=t.length,o=0;o<i;o++){var s={};t[o].hasOwnProperty("path")&&(s.uri=t[o].path,s.reg=n(s.uri,[],{sensitive:!0}),s.tokens=n.parse(s.uri),s.matchURI=e(s.uri),s.policies=this.setPolicyForURL(t[o]),this.clientPolicies.policies[o]=s.policies,this.clientPolicies.policies[o].path=s.uri,this.persistUri.push(s),r.push(s.uri))}this.isPersistUri=n(r,[],{sensitive:!0})}},t.prototype.pathMatch=function(t){var e=this;return t=t||{},function(r){var i=[],o=n(r,i,t);return function(t,r){var n,s,a=o.exec(t);if(!a)return!1;r=r||[];for(var l={},c=0;c<i.length;c++)n=i[c],(s=a[c+1])&&(l={name:n.name,value:e.decodeParam(s)},r.push(l),n.repeat&&(r[r.length-1].name=r[r.length-1].name.split(n.delimiter)));return r}}},t.prototype.decodeParam=function(t){try{return decodeURIComponent(t)}catch(e){throw Error('failed to decode param "'+t+'"')}},t.prototype.setUrlCache=function(t){if(this.$common.isObject(t)&&t.hasOwnProperty("url")&&t.hasOwnProperty("mcs")){var e=this.isPersistentUrl(t.url);if(!1===e)throw new Error("Persistence.Options.setUrlCache()-> URI was not configured for persistence:"+t.url);t.url=e.root;var r=this.$db.getCollectionByName("options"),i=r.findOne({url:e.root});return i?(this.$common.extendOwn(i,t),r.update(i)):r.insert(t)}},t.prototype.isPersistentUrl=function(t){if("string"!=typeof t)return this.logger.warn("isPersistentUrl -> path can be only string"),!1;if((t=this.parseURL(t).path)in this.isPersistUrlCache)return this.isPersistUrlCache[t];for(var e=this.persistUri.length,r=function(e){try{var r=i.persistUri[e].matchURI(t);if(!1===r)return"continue";var n={params:r,path:t,root:i.persistUri[e].tokens[0],tokens:i.persistUri[e].tokens.slice(1),policies:i.persistUri[e].policies,isPolicy:null};return n.isPolicy=function(t,e){if("string"==typeof t)return!(!n.policies||!n.policies.hasOwnProperty(t))&&(void 0===e||n.policies[t]===e)},{value:i.isPersistUrlCache[t]=n}}catch(e){return i.logger.error(e),{value:i.isPersistUrlCache[t]=!1}}},i=this,n=0;n<e;n++){var o=r(n);if("object"==typeof o)return o.value}return this.isPersistUrlCache[t]=!1},t.prototype.getUrlCache=function(t){return{mcs:!0}},t.prototype.parseURL=function(t){if("string"!=typeof t)throw this.logger.error("Persistence.Options.parseURL -> path can be only string"),new Error("Persistence.Options.parseURL -> path can be only string");return t in this.parseUrlCache?this.parseUrlCache[t]:this.parseUrlCache[t]=o(t)},t.prototype.ontimeout=function(t){this.logger.error("xhr.ontimeout",t)},t.prototype.onerror=function(t){this.logger.error("xhr.onerror!",t)},t.prototype.onsuccess=function(t,e,r,i){this.logger.debug("xhr.onsuccess",t,e,r,i)},t.prototype.isOnline=function(){var t=navigator&&navigator.connection?navigator.connection.type:"NULL";return""===t||"NULL"===t?!this._isCordova&&navigator.onLine:"unknown"!==t&&"none"!==t},t.prototype.isOn=function(){return!(!this.alwayson||this.passOne)||(!0===this.passOne&&(this.passOne=!1),this.on?(this.on=null,!0):!!this.on)},t.prototype.oneOn=function(){return this.on=!this.on,!0},t.prototype.oneOff=function(){this.passOne=!0},t.prototype.dbFirstFalseForNextCall=function(){!0===this.dbFirst&&(this.dbFirstFalseForNextCallBool=!0)},t.prototype.isDbFirst=function(){return(!1!==this.dbFirst||!1!==this.dbFirstFalseForNextCallBool)&&(!0===this.dbFirst&&!1===this.dbFirstFalseForNextCallBool||(!0===this.dbFirst&&!0===this.dbFirstFalseForNextCallBool?(this.dbFirstFalseForNextCallBool=!1,!1):this.dbFirst))},t.prototype.reset=function(){this.persistUri=[],this.clientPolicies.policies=[]},t}();e.Options=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(57),n=r(54),o=r(53),s=r(52),l=r(1),c=r(51),h=r(50),u=r(49),p=r(45),d=r(15),f=r(0),y=r(8),m=r(44),g=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=!0),this.logHTTP=e,this._logger=new l.Logger("MCSSyncModule"),this.SYNC_REQUEST_HANDLER_TYPE=f.SyncRequestHandlerTypes,this.common=new o.Common,this.options=new i.Options(this.common),this._utils=new m.SyncUtils(this.common,this.options),this._handler=new s.Handler,this._events=new s.Events,this._lokiStorageAdapter=t||this.getLokiStorageAdapter(),this._sync=new c.Sync(this._events,this.common,this.options,this._utils,this._handler,this._lokiStorageAdapter),this.process=new n.Process(this.options,this.common,this._handler),this.options.module=new d.McsRequestHandler(this.options,this.common,this._utils,this._lokiStorageAdapter),this._install()}return t.prototype.getLokiStorageAdapter=function(){if(this.options.isCordova){if("function"==typeof LokiCordovaFSAdapter)return new LokiCordovaFSAdapter({prefix:"loki"});this._logger.warn("LokiCordovaFSAdapter is not installed")}return new y.persistenceAdapters.localStorage},t.prototype.setHandler=function(t){var e;switch(t){case f.SyncRequestHandlerTypes.GENERIC:e=new h.GenericRequestHandler(this.options,this.common,this._utils,this._lokiStorageAdapter);break;case f.SyncRequestHandlerTypes.MCS:e=new d.McsRequestHandler(this.options,this.common,this._utils,this._lokiStorageAdapter);break;case f.SyncRequestHandlerTypes.ORACLE_REST:e=new p.OracleRestRequestHandler(this.options,this.common,this._utils,this._lokiStorageAdapter)}this.options.module=e},t.prototype._flush=function(t){return this.options.module.flush(t).then(this._sync.flushCollection.bind(this._sync))},t.prototype._install=function(){u.xmlHttpRequestInstall(XMLHttpRequest,this._sync,this._utils,this.options,this.common,this._handler,this._events,this._logger)},t.prototype._uninstall=function(){u.xmlHttpRequestUninstall()},t.prototype._setTestMode=function(){this.options.isTest=!0},t.prototype._setLogLevel=function(t){l.Logger.logLevel=t},t.prototype._setLogHTTP=function(t){this._sync._setLogHTTP(t)},t}();e.MCSSyncModule=g,a=g}]),(l=void 0!==i?i:void 0!==n?n:void 0!==o?o:s).mcs=l.mcs||{},l.mcs.sync=new a}("undefined"==typeof module||module,"undefined"==typeof exports||exports,"undefined"==typeof define||define,"undefined"==typeof window?void 0:window,"undefined"==typeof global?void 0:global,"undefined"==typeof self?void 0:self,this);